{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap 39168fde80d8b2857aa8","webpack:///./externalModules.js","webpack:///./events.js","webpack:///./stateManagement/toolState.js","webpack:///./util/triggerEvent.js","webpack:///./toolOptions.js","webpack:///./tools/base/index.js","webpack:///./util/isMouseButtonEnabled.js","webpack:///./stateManagement/toolColors.js","webpack:///./stateManagement/toolStyle.js","webpack:///./util/drawTextBox.js","webpack:///./manipulators/drawHandles.js","webpack:///./stateManagement/loadHandlerManager.js","webpack:///./manipulators/anyHandlesOutsideImage.js","webpack:///./stateManagement/textStyle.js","webpack:///./util/convertToVector3.js","webpack:///./stateManagement/imageIdSpecificStateManager.js","webpack:///./util/pointInsideBoundingBox.js","webpack:///./manipulators/getHandleNearImagePoint.js","webpack:///./util/getMaxSimultaneousRequests.js","webpack:///./util/calculateSUV.js","webpack:///./requestPool/requestPoolManager.js","webpack:///./util/pointInEllipse.js","webpack:///./manipulators/moveHandle.js","webpack:///./manipulators/moveNewHandle.js","webpack:///./manipulators/moveNewHandleTouch.js","webpack:///./util/pointProjector.js","webpack:///./util/scrollToIndex.js","webpack:///./util/scroll.js","webpack:///./util/roundToDecimal.js","webpack:///./util/getRGBPixels.js","webpack:///./stateManagement/toolCoordinates.js","webpack:///./manipulators/handleActivator.js","webpack:///./manipulators/moveAllHandles.js","webpack:///./tools/image/displayTool.js","webpack:///./orientation/index.js","webpack:///./orientation/getOrientationString.js","webpack:///./orientation/invertOrientationString.js","webpack:///./util/getLuminance.js","webpack:///./util/drawEllipse.js","webpack:///./util/drawCircle.js","webpack:///./util/drawArrow.js","webpack:///./util/calculateEllipseStatistics.js","webpack:///./manipulators/touchMoveAllHandles.js","webpack:///./manipulators/touchMoveHandle.js","webpack:///./tools/timeSeries/incrementTimePoint.js","webpack:///./tools/painting/brushTool.js","webpack:///./tools/painting/getCircle.js","webpack:///./tools/painting/drawBrush.js","webpack:///./tools/index.js","webpack:///./tools/image/angleTool.js","webpack:///./tools/base/doubleTapTool.js","webpack:///./tools/base/keyboardTool.js","webpack:///./tools/base/mouseButtonTool.js","webpack:///./tools/base/mouseButtonRectangleTool.js","webpack:///./tools/base/mouseWheelTool.js","webpack:///./tools/base/multiTouchDragTool.js","webpack:///./tools/base/simpleMouseButtonTool.js","webpack:///./tools/base/touchDragTool.js","webpack:///./tools/base/touchPinchTool.js","webpack:///./tools/base/touchTool.js","webpack:///./tools/image/arrowAnnotate.js","webpack:///./tools/image/crosshairs.js","webpack:///./tools/image/doubleTapZoom.js","webpack:///./tools/image/dragProbe.js","webpack:///./tools/image/ellipticalRoi.js","webpack:///./tools/image/freehand.js","webpack:///./tools/image/highlight.js","webpack:///./tools/image/imageStats.js","webpack:///./tools/image/length.js","webpack:///./tools/image/magnify.js","webpack:///./tools/image/orientationMarkers.js","webpack:///./tools/image/pan.js","webpack:///./tools/image/panMultiTouch.js","webpack:///./tools/image/probe.js","webpack:///./tools/image/rectangleRoi.js","webpack:///./tools/image/rotate.js","webpack:///./tools/image/rotateTouch.js","webpack:///./tools/image/seedAnnotate.js","webpack:///./tools/image/simpleAngle.js","webpack:///./tools/image/textMarker.js","webpack:///./tools/image/wwwc.js","webpack:///./tools/image/wwwcRegion.js","webpack:///./tools/image/zoom.js","webpack:///./tools/stack/playClip.js","webpack:///./tools/stack/scrollIndicator.js","webpack:///./tools/stack/stackPrefetch.js","webpack:///./tools/stack/stackRenderers.js","webpack:///./tools/stack/fusionRenderer.js","webpack:///./tools/stack/stackScrollKeyboard.js","webpack:///./tools/stack/stackScroll.js","webpack:///./tools/timeSeries/probeTool4D.js","webpack:///./measurementManager/measurementManager.js","webpack:///./measurementManager/lineSampleMeasurement.js","webpack:///./tools/timeSeries/timeSeriesPlayer.js","webpack:///./tools/timeSeries/timeSeriesScroll.js","webpack:///./tools/painting/adaptiveBrush.js","webpack:///./tools/painting/brush.js"],"names":["cornerstone","window","cornerstoneMath","Hammer","cs","cm","module","EVENTS","IMAGE_RENDERED","NEW_IMAGE","IMAGE_CACHE_PROMISE_REMOVED","ELEMENT_DISABLED","MOUSE_DOWN","MOUSE_UP","MOUSE_DOWN_ACTIVATE","MOUSE_DRAG","MOUSE_MOVE","MOUSE_CLICK","MOUSE_DOUBLE_CLICK","MOUSE_WHEEL","TOUCH_START","TOUCH_START_ACTIVE","TOUCH_END","TOUCH_DRAG","TOUCH_DRAG_END","TOUCH_PINCH","TOUCH_ROTATE","TOUCH_PRESS","TAP","DOUBLE_TAP","MULTI_TOUCH_START","MULTI_TOUCH_START_ACTIVE","MULTI_TOUCH_DRAG","KEY_DOWN","KEY_UP","KEY_PRESS","MEASUREMENT_ADDED","MEASUREMENT_MODIFIED","MEASUREMENT_REMOVED","TOOL_DEACTIVATED","CLIP_STOPPED","STACK_SCROLL","LINE_SAMPLE_UPDATED","getElementToolStateManager","element","enabledImage","getEnabledElement","toolStateManager","undefined","addToolState","toolType","measurementData","add","eventType","eventData","getToolState","get","removeToolState","data","toolData","indexOfData","i","length","splice","clearToolState","setElementToolStateManager","triggerEvent","el","type","detail","event","CustomEvent","cancelable","document","createEvent","initCustomEvent","dispatchEvent","elementToolOptions","getToolOptions","toolOptions","optionsObject","find","toolOptionObject","options","setToolOptions","index","findIndex","push","elementOptions","Object","assign","clearToolOptions","filter","clearToolOptionsByToolType","clearToolOptionsByElement","default","which","mouseButtonMask","mouseButton","defaultColor","activeColor","fillColor","setFillColor","color","getFillColor","setToolColor","getToolColor","setActiveColor","getActiveColor","getColorIfActive","active","toolColors","defaultWidth","activeWidth","setToolWidth","width","getToolWidth","setActiveWidth","getActiveWidth","toolStyle","context","textLines","x","y","prototype","toString","call","padding","font","getFont","fontSize","getFontSize","backgroundColor","getBackgroundColor","save","textBaseline","strokeStyle","maxWidth","forEach","text","measureText","Math","max","fillStyle","boundingBox","height","centering","left","top","debug","fillRect","fillText","restore","renderData","handles","keys","name","handle","drawnIndependently","drawHandlesIfActive","beginPath","lineWidth","handleCanvasCoords","pixelToCanvas","arc","handleRadius","PI","fill","stroke","defaultStartLoadHandler","defaultEndLoadHandler","defaultErrorLoadingHandler","setStartLoadHandler","handler","getStartLoadHandler","setEndLoadHandler","getEndLoadHandler","setErrorLoadingHandler","getErrorLoadingHandler","loadHandlerManager","image","imageRect","handleOutsideImage","allowedOutsideImage","point","insideRect","defaultFontSize","defaultFont","defaultBackgroundColor","setFont","setFontSize","setBackgroundColor","textStyle","convertToVector3","arrayOrVector3","Vector3","newImageIdSpecificToolStateManager","toolState","saveImageIdToolState","imageId","restoreImageIdToolState","imageIdToolState","saveToolState","restoreToolState","savedToolState","addImageIdSpecificToolState","hasOwnProperty","getImageIdSpecificToolState","clearImageIdSpecificToolStateManager","clear","globalImageIdSpecificToolStateManager","coords","distanceThreshold","nearbyHandle","pointNearHandle","hasBoundingBox","handleCanvas","distance","configMaxSimultaneousRequests","maxSimultaneousRequests","IE","Firefox","Opera","Chrome","Safari","getBrowserInfo","ua","navigator","userAgent","M","match","tem","test","exec","slice","join","replace","appName","appVersion","setMaxSimultaneousRequests","newMaxSimultaneousRequests","getMaxSimultaneousRequests","getDefaultSimultaneousRequests","infoString","info","split","browserName","browserVersion","browserData","isMobileDevice","pattern","RegExp","storedPixelValue","patientStudyModule","metaData","seriesModule","modality","modalityPixelValue","slope","intercept","patientWeight","petSequenceModule","radiopharmaceuticalInfo","startTime","radiopharmaceuticalStartTime","totalDose","radionuclideTotalDose","halfLife","radionuclideHalfLife","seriesAcquisitionTime","seriesTime","acquisitionTimeInSeconds","fracToDec","fractionalSeconds","seconds","minutes","hours","injectionStartTimeInSeconds","durationInSeconds","correctedDose","exp","log","suv","fractionalValue","parseFloat","requestPool","interaction","thumbnail","prefetch","numRequests","maxNumRequests","awake","grabDelay","addRequest","preventCache","doneCallback","failCallback","addToBeginning","Error","requestDetails","imageLoadObject","imageCache","getImageLoadObject","promise","then","error","unshift","clearRequestStack","startAgain","setTimeout","startGrabbing","sendRequest","requestTypeToLoadPriority","priority","loader","loadImage","loadAndCacheImage","currentRequests","requestsToSend","getNextRequest","shift","getRequestPool","ellipse","location","xRadius","yRadius","center","normalized","inEllipse","mouseEventData","doneMovingCallback","preventHandleOutsideImage","distanceFromTool","currentPoints","mouseDragCallback","e","hasMoved","min","updateImage","modifiedEventData","addEventListener","mouseUpCallback","removeEventListener","moveCallback","whichMovement","moveEndCallback","measurementRemovedCallback","toolDeactivatedCallback","imageCoords","pageToPixel","page","distanceFromTouch","stopImmediatePropagation","projectPatientPointToImagePlane","imagePointToPatientPoint","planePlaneIntersection","patientPoint","imagePlane","rowCosines","columnCosines","imagePositionPatient","clone","sub","dot","columnPixelSpacing","rowPixelSpacing","imagePoint","multiplyScalar","getRectangleFromImagePlane","topLeft","topRight","columns","bottomLeft","rows","bottomRight","rect","Line3","right","bottom","lineRectangleIntersection","line","intersections","side","segment","intersection","intersectLine","targetImagePlane","referenceImagePlane","targetRowCosines","targetColumnCosines","targetImagePositionPatient","referenceRowCosines","referenceColumnCosines","referenceImagePositionPatient","targetNormal","cross","targetPlane","Plane","setFromNormalAndCoplanarPoint","referenceNormal","referencePlane","originDirection","intersectPlane","origin","direction","distanceTo","start","end","newImageIdIndex","stackRenderer","stackRendererData","stackData","imageIds","startLoadingHandler","endLoadingHandler","errorLoadingHandler","currentImageIdIndex","render","displayImage","newImageId","Boolean","imagePromise","images","loop","allowSkipping","pending","nbImages","pendingEvent","scrollWithoutSkipping","indexOf","newImageHandler","value","precision","multiplier","pow","round","enabledElement","storedPixelData","pixelData","getPixelData","spIndex","row","column","red","green","blue","alpha","coordsData","setCoords","canvas","getCoords","toolCoordinates","canvasPoint","activeHandle","getActiveHandle","movesIndependently","deltaPoints","preventDefault","stopPropagation","invalidated","deleteIfHandleOutsideImage","onImageRendered","configuration","disable","enable","getConfiguration","setConfiguration","config","orientation","getOrientationString","invertOrientationString","vector","vec3","orientationX","orientationY","orientationZ","z","abs","string","inverted","toUpperCase","luminance","w","h","kappa","ox","oy","xe","ye","xm","ym","moveTo","bezierCurveTo","closePath","headLength","angle","atan2","lineTo","cos","sin","sp","sum","sumSquared","count","mean","variance","stdDev","sqrt","touchEventData","touchDragCallback","touchEndCallback","handlesOutsideImage","runAnimation","time","Date","getTime","fingerDistance","aboveFinger","targetLocation","touchEndEvents","handlePressed","animate","lastTime","distanceRemaining","linearDistEachFrame","requestAnimationFrame","timePoints","wrap","timeSeriesData","currentStack","stacks","currentStackIndex","newStackIndex","viewport","getViewport","newStack","brushTool","TOOL_STATE_TOOL_TYPE","brushLayerId","brushToolInterface","mouseMoveCallback","onMouseMove","onMouseUp","dragCallback","onDrag","mouseDownActivateCallback","onMouseDown","Uint8ClampedArray","layer","getLayer","setPixelData","invalid","activate","colormapId","colormap","colors","getColormap","setNumberOfColors","setColor","labelMapImage","minPixelValue","maxPixelValue","rgba","labelmap","invert","sizeInBytes","pixelReplication","addLayer","deactivate","getCircle","radius","xCoord","yCoord","x0","y0","circleArray","drawBrushPixels","pointerArray","storedPixels","brushPixelValue","getPixelIndex","drawBrushOnCanvas","canvasContext","canvasPtTL","canvasPtBR","sizeX","sizeY","canvasPt","angleTouch","arrowAnnotate","arrowAnnotateTouch","crosshairs","crosshairsTouch","dragProbe","dragProbeTouch","ellipticalRoi","ellipticalRoiTouch","freehand","highlight","highlightTouch","lengthTouch","magnify","magnifyTouchDrag","pan","panTouchDrag","probe","probeTouch","rectangleRoi","rectangleRoiTouch","rotate","rotateTouchDrag","seedAnnotate","seedAnnotateTouch","simpleAngle","simpleAngleTouch","textMarker","textMarkerTouch","wwwc","wwwcTouchDrag","wwwcRegion","wwwcRegionTouch","zoom","zoomWheel","zoomTouchPinch","zoomTouchDrag","playClip","stopClip","stackScroll","stackScrollWheel","stackScrollTouchDrag","stackScrollMultiTouch","timeSeriesScroll","timeSeriesScrollWheel","timeSeriesScrollTouchDrag","adaptiveBrush","brush","createNewMeasurement","angleData","visible","start2","end2","pointNearTool","lineSegment","distanceToPoint","currentTarget","getContext","setTransform","shadow","shadowColor","shadowOffsetX","shadowOffsetY","handleStartCanvas","handleEndCanvas","dx1","ceil","dy1","dx2","dy2","acos","rAngle","str","String","fromCharCode","parseInt","textX","textY","doubleTapCallback","keyDownCallback","mouseToolInterface","addNewMeasurement","imageNeedsUpdate","mouseDownCallback","handleDoneMove","mouseMove","startPoints","opt","mouseDown","mouseDownActivate","mouseDoubleClick","mouseDoubleClickCallback","handleMover","statusChangeEventData","toolInterface","pointInsideRect","distanceSq","mouseWheelCallback","events","fireOnTouchStart","activateCallback","disableCallback","enableCallback","deactivateCallback","touchPinchCallback","deactivateAllHandles","deactivateAllToolInstances","touchTool","touchToolInterface","touchDownActivateCallback","tapCallback","touchStartCallback","lastEvent","lastEventData","pressCallback","getTextCallback","doneChangingTextCallback","prompt","changeTextCallback","drawHandles","drawHandlesOnHover","arrowFirst","textBox","handleOptions","textWidth","textHeight","textCoords","transform","internal","getTransform","transformPoint","link","midpointCanvas","points","findClosestPoint","boundingBoxPoints","setLineDash","addNewMeasurementTouch","doubleClickCallback","updatedText","deleteTool","console","chooseLocation","sourceElement","sourceEnabledElement","sourceImageId","sourceImagePlane","sourceImagePoint","syncContext","synchronizationContext","enabledElements","getSourceElements","targetElement","minDistance","Number","MAX_VALUE","stackToolDataSource","imagePosition","normal","dragEndCallback","dragStartCallback","enableTouch","disableTouch","fitToWindowStrategy","fitToWindow","doubleTapZoom","strategy","strategies","dragEventData","defaultStrategy","fontHeight","getStoredPixels","mo","toFixed","minimalStrategy","toolCoords","isTouchEvent","modalityPixelValueText","translation","imageRenderedCallback","minimal","pointNearEllipse","startCanvas","endCanvas","minorEllipse","majorEllipse","pointInMinorEllipse","pointInMajorEllipse","pointNearToolTouch","numberWithCommas","parts","leftCanvas","topCanvas","widthCanvas","heightCanvas","area","meanStdDev","meanStdDevSUV","pixels","getPixels","isNaN","moSuffix","meanText","stdDevText","SUVtext","suffix","areaText","ellipsePoints","mouseLocation","modifying","currentHandle","currentTool","addPoint","handleData","lines","toolIndex","mousePoint","pointNearHandleAllTools","handleNearby","shiftKey","lastLineIndex","lastLine","startDrawing","endDrawing","nearby","handleStart","j","k","lineCanvas","mouseLocationCanvas","existingToolData","insideBox","clientWidth","clientHeight","strokeRect","stats","key","imageStats","colPixelSpacing","rowImagePixelSpacing","colImagePixelSpacing","dx","dy","magnifySize","magnificationLevel","newImageCallback","hideTool","querySelector","style","display","body","cursor","drawMagnificationTool","magnifyCanvas","createMagnificationCanvas","zoomCtx","getSize","canvasLocation","clearRect","copyFrom","scaledMagnify","drawImage","createElement","classList","position","appendChild","removeMagnificationCanvas","removeChild","getOrientationMarkers","imagePlaneMetaData","rowString","columnString","oppositeRowString","oppositeColumnString","getOrientationMarkerPositions","markers","textWidths","orientationMarkers","drawAllMarkers","widthScale","scale","heightScale","setViewport","touchPanCallback","panMultiTouch","testPointers","numPointers","calculateMeanStdDev","getBoundingClientRect","client","pointsFromCenter","rotationRadians","rotationDegrees","rotation","horizontalStrategy","verticalStrategy","horizontal","vertical","touchRotateCallback","rotateTouch","doneGetTextCallback","currentLetter","currentNumber","showCoordinates","countUp","realCoords","canvasWidth","textPlusCoords","middle","handleMiddleCanvas","sideA","sideB","sideC","sideALength","sideBLength","sideCLength","touchMoveCallback","current","currentIndex","ascending","insideBoundingBox","touchPressCallback","maxVOI","minVOI","imageDynamicRange","deltaX","deltaY","voi","windowWidth","windowCenter","dragData","minWindowWidth","calculateMinMaxMean","storedPixelLuminanceData","globalMin","globalMax","numPixels","spv","endPoint","applyWWWCRegion","startPoint","floor","pixelLuminanceData","minMaxMean","recordStartPoint","startPointCanvas","endPointCanvas","disableTouchDrag","activateTouchDrag","changeViewportScale","ticks","oldFactor","factor","maxScale","minScale","boundPosition","correctShift","hflip","vflip","cosA","sinA","newX","newY","newCoords","translateStrategy","translateSpeed","outwardsMinScaleToTranslate","minTranslation","preventZoomOutsideImage","desiredTranslation","distanceToDesired","zoomToCenterStrategy","scaleChange","translate","zoomToCenter","getPlayClipTimeouts","speed","sample","delay","limit","timeouts","isTimeVarying","stopClipWithData","playClipData","id","intervalId","usingFrameTimeVector","clearTimeout","clearInterval","triggerStopEvent","eventDetail","framesPerSecond","playClipTimeouts","stackToolData","playClipToolData","lastFrameTimeStamp","frameRate","frameTimeVector","ignoreFrameTimeVector","reverse","playClipAction","imageCount","playClipTimeoutHandler","setInterval","scrollBarHeight","scrollIndicator","cursorWidth","cursorHeight","xPosition","yPosition","requestType","maxImagesToPrefetch","Infinity","resetPrefetchTimeout","resetPrefetchDelay","range","lowEnd","highEnd","arr","c","apply","nearestIndex","l","v","low","high","stack","stackPrefetchData","stackPrefetch","indicesToRequest","enabled","removeFromList","imageIdIndex","sort","a","b","indicesToRequestCopy","nearest","nextImageIdIndex","lowerIndex","higherIndex","shouldSkipLower","shouldSkipHigher","shouldLoadLower","shouldLoadHigher","getPromiseRemovedHandler","onImageUpdated","target","stackPrefetchDataArray","warn","indexOfCurrentImage","promiseRemovedHandler","stackRenderers","FusionRenderer","layerIds","findImageFn","imageStacks","isInteger","baseImageObject","currentImageId","overlayImageStacks","baseImage","baseLayerId","setLayerImage","imgObj","overlayLayerIndex","layerIndex","currentLayerId","setActiveLayer","UP","DOWN","keyCode","stackScrollKeyboard","toolTypeTouchDrag","pixelsPerImage","offsetHeight","stackScrollSpeed","imageIdIndexOffset","multiTouchDragCallback","updateLineSample","samples","timeSeries","offset","lineSample","set","timeSeriestoolData","probeTool4D","MeasurementManager","that","measurements","measurement","remove","manager","timeSeriesToolData","timeSeriesPlayer","stop","pixelsPerTimeSeries","timeSeriesScrollSpeed","timeSeriesDelta","timeSeriesDeltaMod","mouseMoveData","originalEvent","draw","tolerance","minRadius","hoverColor","dragColor","lastImageCoords","thrMax","thrMin","currentRadius","dragging","getGreyValues","imageColumns","minValue","maxValue","pixelIndex","greyValue","paintAdaptiveBrush","imagePixelData","brushPixelData","mouseX","mouseY","numPixelsOutsideThresholdWindow","pixelValue","paint","baseLayer","getLayers","brushData","erase"],"mappings":"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","file":"tools.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"tools\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"tools\"] = factory();\n\telse\n\t\troot[\"tools\"] = factory();\n})(typeof self !== 'undefined' ? self : this, function() {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 75);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 39168fde80d8b2857aa8","let cornerstone = window.cornerstone;\nlet cornerstoneMath = window.cornerstoneMath;\nlet Hammer = window.Hammer;\n\nexport default {\n  set cornerstone (cs) {\n    cornerstone = cs;\n  },\n  get cornerstone () {\n    return cornerstone;\n  },\n  set cornerstoneMath (cm) {\n    cornerstoneMath = cm;\n  },\n  get cornerstoneMath () {\n    return cornerstoneMath;\n  },\n  set Hammer (module) {\n    Hammer = module;\n  },\n  get Hammer () {\n    return Hammer;\n  }\n};\n\n\n\n// WEBPACK FOOTER //\n// ./externalModules.js","const EVENTS = {\n  // Events from Cornerstone Core\n  IMAGE_RENDERED: 'cornerstoneimagerendered',\n  NEW_IMAGE: 'cornerstonenewimage',\n  IMAGE_CACHE_PROMISE_REMOVED: 'cornerstoneimagecachepromiseremoved',\n  ELEMENT_DISABLED: 'cornerstoneelementdisabled',\n\n  // Mouse events\n  MOUSE_DOWN: 'cornerstonetoolsmousedown',\n  MOUSE_UP: 'cornerstonetoolsmouseup',\n  MOUSE_DOWN_ACTIVATE: 'cornerstonetoolsmousedownactivate',\n  MOUSE_DRAG: 'cornerstonetoolsmousedrag',\n  MOUSE_MOVE: 'cornerstonetoolsmousemove',\n  MOUSE_CLICK: 'cornerstonetoolsmouseclick',\n  MOUSE_DOUBLE_CLICK: 'cornerstonetoolsmousedoubleclick',\n  MOUSE_WHEEL: 'cornerstonetoolsmousewheel',\n\n  // Touch events\n  TOUCH_START: 'cornerstonetoolstouchstart',\n  TOUCH_START_ACTIVE: 'cornerstonetoolstouchstartactive',\n  TOUCH_END: 'cornerstonetoolstouchend',\n  TOUCH_DRAG: 'cornerstonetoolstouchdrag',\n  TOUCH_DRAG_END: 'cornerstonetoolstouchdragend',\n  TOUCH_PINCH: 'cornerstonetoolstouchpinch',\n  TOUCH_ROTATE: 'cornerstonetoolstouchrotate',\n  TOUCH_PRESS: 'cornerstonetoolstouchpress',\n  TAP: 'cornerstonetoolstap',\n  DOUBLE_TAP: 'cornerstonetoolsdoubletap',\n  MULTI_TOUCH_START: 'cornerstonetoolsmultitouchstart',\n  MULTI_TOUCH_START_ACTIVE: 'cornerstonetoolsmultitouchstartactive',\n  MULTI_TOUCH_DRAG: 'cornerstonetoolsmultitouchdrag',\n\n  // Keyboard events\n  KEY_DOWN: 'cornerstonetoolskeydown',\n  KEY_UP: 'cornerstonetoolskeyup',\n  KEY_PRESS: 'cornerstonetoolskeypress',\n\n  // Measurement / tool events\n  MEASUREMENT_ADDED: 'cornerstonetoolsmeasurementadded',\n  MEASUREMENT_MODIFIED: 'cornerstonetoolsmeasurementmodified',\n  MEASUREMENT_REMOVED: 'cornerstonemeasurementremoved',\n  TOOL_DEACTIVATED: 'cornerstonetoolstooldeactivated',\n  CLIP_STOPPED: 'cornerstonetoolsclipstopped',\n  STACK_SCROLL: 'cornerstonestackscroll', // Should be renamed\n\n  LINE_SAMPLE_UPDATED: 'cornerstonelinesampleupdated'\n};\n\nexport default EVENTS;\n\n\n\n// WEBPACK FOOTER //\n// ./events.js","import EVENTS from '@/events.js';\nimport external from '@/externalModules.js';\nimport { globalImageIdSpecificToolStateManager } from './imageIdSpecificStateManager.js';\nimport triggerEvent from '@/util/triggerEvent.js';\n\nfunction getElementToolStateManager (element) {\n  const enabledImage = external.cornerstone.getEnabledElement(element);\n  // If the enabledImage has no toolStateManager, create a default one for it\n  // NOTE: This makes state management element specific\n\n  if (enabledImage.toolStateManager === undefined) {\n    enabledImage.toolStateManager = globalImageIdSpecificToolStateManager;\n  }\n\n  return enabledImage.toolStateManager;\n}\n\n// Here we add tool state, this is done by tools as well\n// As modules that restore saved state\nfunction addToolState (element, toolType, measurementData) {\n  const toolStateManager = getElementToolStateManager(element);\n\n  toolStateManager.add(element, toolType, measurementData);\n\n  const eventType = EVENTS.MEASUREMENT_ADDED;\n  const eventData = {\n    toolType,\n    element,\n    measurementData\n  };\n\n  triggerEvent(element, eventType, eventData);\n}\n\n// Here you can get state - used by tools as well as modules\n// That save state persistently\nfunction getToolState (element, toolType) {\n  const toolStateManager = getElementToolStateManager(element);\n\n\n  return toolStateManager.get(element, toolType);\n}\n\nfunction removeToolState (element, toolType, data) {\n  const toolStateManager = getElementToolStateManager(element);\n  const toolData = toolStateManager.get(element, toolType);\n  // Find this tool data\n  let indexOfData = -1;\n\n  for (let i = 0; i < toolData.data.length; i++) {\n    if (toolData.data[i] === data) {\n      indexOfData = i;\n    }\n  }\n\n  if (indexOfData !== -1) {\n    toolData.data.splice(indexOfData, 1);\n\n    const eventType = EVENTS.MEASUREMENT_REMOVED;\n    const eventData = {\n      toolType,\n      element,\n      measurementData: data\n    };\n\n    triggerEvent(element, eventType, eventData);\n  }\n}\n\nfunction clearToolState (element, toolType) {\n  const toolStateManager = getElementToolStateManager(element);\n  const toolData = toolStateManager.get(element, toolType);\n\n  // If any toolData actually exists, clear it\n  if (toolData !== undefined) {\n    toolData.data = [];\n  }\n}\n\n// Sets the tool state manager for an element\nfunction setElementToolStateManager (element, toolStateManager) {\n  const enabledImage = external.cornerstone.getEnabledElement(element);\n\n  enabledImage.toolStateManager = toolStateManager;\n}\n\nexport {\n  addToolState,\n  getToolState,\n  removeToolState,\n  clearToolState,\n  setElementToolStateManager,\n  getElementToolStateManager\n};\n\n\n\n// WEBPACK FOOTER //\n// ./stateManagement/toolState.js","/**\n * Trigger a CustomEvent\n *\n * @param {EventTarget} el The element or EventTarget to trigger the event upon\n * @param {String} type The event type name\n * @param {Object|null} detail=null The event data to be sent\n * @returns {Boolean} The return value is false if at least one event listener called preventDefault(). Otherwise it returns true.\n */\nexport default function triggerEvent (el, type, detail = null) {\n  let event;\n\n  // This check is needed to polyfill CustomEvent on IE11-\n  if (typeof window.CustomEvent === 'function') {\n    event = new CustomEvent(type, {\n      detail,\n      cancelable: true\n    });\n  } else {\n    event = document.createEvent('CustomEvent');\n    event.initCustomEvent(type, true, true, detail);\n  }\n\n  return el.dispatchEvent(event);\n}\n\n\n\n// WEBPACK FOOTER //\n// ./util/triggerEvent.js","const elementToolOptions = {};\n\n/**\n * Retrieve the options object associated with a particular toolType and element\n *\n * @param {string} toolType Tool type identifier of the target options object\n * @param {HTMLElement} element Element of the target options object\n *\n * @return {Object} Target options object (empty if not yet set)\n */\nfunction getToolOptions (toolType, element) {\n  if (!elementToolOptions[toolType]) {\n    return {};\n  }\n\n  const toolOptions = elementToolOptions[toolType];\n  const optionsObject = toolOptions.find((toolOptionObject) => toolOptionObject.element === element);\n\n  if (!optionsObject) {\n    return {};\n  }\n\n  return optionsObject.options;\n}\n\n/**\n * Set the options object associated with a particular toolType and element\n *\n * @param {string} toolType Tool type identifier of the target options object\n * @param {HTMLElement} element Element of the target options object\n * @param {Object} options Options object to store at target\n *\n * @return {void}\n */\nfunction setToolOptions (toolType, element, options) {\n  if (!elementToolOptions[toolType]) {\n    elementToolOptions[toolType] = [{\n      element,\n      options\n    }];\n\n    return;\n  }\n\n  const toolOptions = elementToolOptions[toolType];\n  const index = toolOptions.findIndex((toolOptionObject) => toolOptionObject.element === element);\n\n  if (index === -1) {\n    elementToolOptions[toolType].push({\n      element,\n      options\n    });\n  } else {\n    const elementOptions = elementToolOptions[toolType][index].options || {};\n\n    elementToolOptions[toolType][index].options = Object.assign(elementOptions, options);\n  }\n}\n\n/**\n * Clear the options object associated with a particular toolType and element\n *\n * @param {string} toolType Tool type identifier of the target options object\n * @param {HTMLElement} element Element of the target options object\n *\n * @return {void}\n */\nfunction clearToolOptions (toolType, element) {\n  const toolOptions = elementToolOptions[toolType];\n\n  if (toolOptions) {\n    elementToolOptions[toolType] = toolOptions.filter(\n      (toolOptionObject) => toolOptionObject.element !== element\n    );\n  }\n}\n\n/**\n * Clear the options objects associated with a particular toolType\n *\n * @param {string} toolType Tool type identifier of the target options objects\n *\n * @return {void}\n */\nfunction clearToolOptionsByToolType (toolType) {\n  delete elementToolOptions[toolType];\n}\n\n/**\n * Clear the options objects associated with a particular element\n *\n * @param {HTMLElement} element Element of the target options objects\n *\n * @return {void}\n */\nfunction clearToolOptionsByElement (element) {\n  for (const toolType in elementToolOptions) {\n    elementToolOptions[toolType] = elementToolOptions[toolType].filter(\n      (toolOptionObject) => toolOptionObject.element !== element\n    );\n  }\n}\n\nexport {\n  getToolOptions,\n  setToolOptions,\n  clearToolOptions,\n  clearToolOptionsByToolType,\n  clearToolOptionsByElement\n};\n\n\n\n// WEBPACK FOOTER //\n// ./toolOptions.js","export { default as doubleTapTool } from './doubleTapTool.js';\nexport { default as keyboardTool } from './keyboardTool.js';\nexport { default as mouseButtonTool } from './mouseButtonTool.js';\nexport { default as mouseButtonRectangleTool } from './mouseButtonRectangleTool.js';\nexport { default as mouseWheelTool } from './mouseWheelTool.js';\nexport { default as multiTouchDragTool } from './multiTouchDragTool.js';\nexport { default as simpleMouseButtonTool } from './simpleMouseButtonTool.js';\nexport { default as touchDragTool } from './touchDragTool.js';\nexport { default as touchPinchTool } from './touchPinchTool.js';\nexport { default as touchTool } from './touchTool.js';\n\n\n\n\n// WEBPACK FOOTER //\n// ./tools/base/index.js","/* eslint no-bitwise:0 */\n\nexport default function (which, mouseButtonMask) {\n  const mouseButton = (1 << (which - 1));\n\n\n  return ((mouseButtonMask & mouseButton) !== 0);\n}\n\n\n\n// WEBPACK FOOTER //\n// ./util/isMouseButtonEnabled.js","\nlet defaultColor = 'white',\n  activeColor = 'greenyellow',\n  fillColor = 'transparent';\n\nfunction setFillColor (color) {\n  fillColor = color;\n}\n\nfunction getFillColor () {\n  return fillColor;\n}\n\nfunction setToolColor (color) {\n  defaultColor = color;\n}\n\nfunction getToolColor () {\n  return defaultColor;\n}\n\nfunction setActiveColor (color) {\n  activeColor = color;\n}\n\nfunction getActiveColor () {\n  return activeColor;\n}\n\nfunction getColorIfActive (active) {\n  return active ? activeColor : defaultColor;\n}\n\nconst toolColors = {\n  setFillColor,\n  getFillColor,\n  setToolColor,\n  getToolColor,\n  setActiveColor,\n  getActiveColor,\n  getColorIfActive\n};\n\nexport default toolColors;\n\n\n\n// WEBPACK FOOTER //\n// ./stateManagement/toolColors.js","let defaultWidth = 1,\n  activeWidth = 2;\n\nfunction setToolWidth (width) {\n  defaultWidth = width;\n}\n\nfunction getToolWidth () {\n  return defaultWidth;\n}\n\nfunction setActiveWidth (width) {\n  activeWidth = width;\n}\n\nfunction getActiveWidth () {\n  return activeWidth;\n}\n\nconst toolStyle = {\n  setToolWidth,\n  getToolWidth,\n  setActiveWidth,\n  getActiveWidth\n};\n\nexport default toolStyle;\n\n\n\n// WEBPACK FOOTER //\n// ./stateManagement/toolStyle.js","import textStyle from '@/stateManagement/textStyle.js';\n\nexport default function (context, textLines, x, y, color, options) {\n  if (Object.prototype.toString.call(textLines) !== '[object Array]') {\n    textLines = [textLines];\n  }\n\n  const padding = 5;\n  const font = textStyle.getFont();\n  const fontSize = textStyle.getFontSize();\n  const backgroundColor = textStyle.getBackgroundColor();\n\n  context.save();\n  context.font = font;\n  context.textBaseline = 'top';\n  context.strokeStyle = color;\n\n  // Find the longest text width in the array of text data\n  let maxWidth = 0;\n\n  textLines.forEach(function (text) {\n    // Get the text width in the current font\n    const width = context.measureText(text).width;\n\n    // Find the maximum with for all the text rows;\n    maxWidth = Math.max(maxWidth, width);\n  });\n\n  // Draw the background box with padding\n  context.fillStyle = backgroundColor;\n\n  // Calculate the bounding box for this text box\n  const boundingBox = {\n    width: maxWidth + (padding * 2),\n    height: padding + textLines.length * (fontSize + padding)\n  };\n\n  if (options && options.centering && options.centering.x === true) {\n    x -= boundingBox.width / 2;\n  }\n\n  if (options && options.centering && options.centering.y === true) {\n    y -= boundingBox.height / 2;\n  }\n\n  boundingBox.left = x;\n  boundingBox.top = y;\n\n  if (options && options.debug === true) {\n    context.fillStyle = '#FF0000';\n  }\n\n  context.fillRect(boundingBox.left, boundingBox.top, boundingBox.width, boundingBox.height);\n\n  // Draw each of the text lines on top of the background box\n  textLines.forEach(function (text, index) {\n    context.fillStyle = color;\n\n    /* Var ypos;\n        if (index === 0) {\n            ypos = y + index * (fontSize + padding);\n        } else {\n            ypos = y + index * (fontSize + padding * 2);\n        }*/\n\n    context.fillText(text, x + padding, y + padding + index * (fontSize + padding));\n  });\n\n  context.restore();\n\n  // Return the bounding box so it can be used for pointNearHandle\n  return boundingBox;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./util/drawTextBox.js","import external from '@/externalModules.js';\nimport toolStyle from '@/stateManagement/toolStyle.js';\n\nconst handleRadius = 6;\n\nexport default function (context, renderData, handles, color, options) {\n  context.strokeStyle = color;\n\n  Object.keys(handles).forEach(function (name) {\n    const handle = handles[name];\n\n    if (handle.drawnIndependently === true) {\n      return;\n    }\n\n    if (options && options.drawHandlesIfActive === true && !handle.active) {\n      return;\n    }\n\n    context.beginPath();\n\n    if (handle.active) {\n      context.lineWidth = toolStyle.getActiveWidth();\n    } else {\n      context.lineWidth = toolStyle.getToolWidth();\n    }\n\n    const handleCanvasCoords = external.cornerstone.pixelToCanvas(renderData.element, handle);\n\n    context.arc(handleCanvasCoords.x, handleCanvasCoords.y, handleRadius, 0, 2 * Math.PI);\n\n    if (options && options.fill) {\n      context.fillStyle = options.fill;\n      context.fill();\n    }\n\n    context.stroke();\n  });\n}\n\n\n\n// WEBPACK FOOTER //\n// ./manipulators/drawHandles.js","let defaultStartLoadHandler;\nlet defaultEndLoadHandler;\nlet defaultErrorLoadingHandler;\n\nfunction setStartLoadHandler (handler) {\n  defaultStartLoadHandler = handler;\n}\n\nfunction getStartLoadHandler () {\n  return defaultStartLoadHandler;\n}\n\nfunction setEndLoadHandler (handler) {\n  defaultEndLoadHandler = handler;\n}\n\nfunction getEndLoadHandler () {\n  return defaultEndLoadHandler;\n}\n\nfunction setErrorLoadingHandler (handler) {\n  defaultErrorLoadingHandler = handler;\n}\n\nfunction getErrorLoadingHandler () {\n  return defaultErrorLoadingHandler;\n}\n\nconst loadHandlerManager = {\n  setStartLoadHandler,\n  getStartLoadHandler,\n  setEndLoadHandler,\n  getEndLoadHandler,\n  setErrorLoadingHandler,\n  getErrorLoadingHandler\n};\n\nexport default loadHandlerManager;\n\n\n\n// WEBPACK FOOTER //\n// ./stateManagement/loadHandlerManager.js","import external from '@/externalModules.js';\n\nexport default function (renderData, handles) {\n  const image = renderData.image;\n  const imageRect = {\n    left: 0,\n    top: 0,\n    width: image.width,\n    height: image.height\n  };\n\n  let handleOutsideImage = false;\n\n  Object.keys(handles).forEach(function (name) {\n    const handle = handles[name];\n\n    if (handle.allowedOutsideImage === true) {\n      return;\n    }\n\n    if (external.cornerstoneMath.point.insideRect(handle, imageRect) === false) {\n      handleOutsideImage = true;\n    }\n  });\n\n  return handleOutsideImage;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./manipulators/anyHandlesOutsideImage.js","let defaultFontSize = 15,\n  defaultFont = `${defaultFontSize}px Arial`,\n  defaultBackgroundColor = 'transparent';\n\nfunction setFont (font) {\n  defaultFont = font;\n}\n\nfunction getFont () {\n  return defaultFont;\n}\n\nfunction setFontSize (fontSize) {\n  defaultFontSize = fontSize;\n}\n\nfunction getFontSize () {\n  return defaultFontSize;\n}\n\nfunction setBackgroundColor (backgroundColor) {\n  defaultBackgroundColor = backgroundColor;\n}\n\nfunction getBackgroundColor () {\n  return defaultBackgroundColor;\n}\n\nconst textStyle = {\n  setFont,\n  getFont,\n  setFontSize,\n  getFontSize,\n  setBackgroundColor,\n  getBackgroundColor\n};\n\nexport default textStyle;\n\n\n\n// WEBPACK FOOTER //\n// ./stateManagement/textStyle.js","import external from '@/externalModules.js';\n\n/**\n * Convert an Array to a cornerstoneMath.Vector3\n *\n * @param {Array|cornerstoneMath.Vector3} arrayOrVector3 Input array or Vector3\n * @return {cornerstoneMath.Vector3}\n */\nexport default function convertToVector3 (arrayOrVector3) {\n  const cornerstoneMath = external.cornerstoneMath;\n\n  if (arrayOrVector3 instanceof cornerstoneMath.Vector3) {\n    return arrayOrVector3;\n  }\n\n  return new cornerstoneMath.Vector3(arrayOrVector3[0], arrayOrVector3[1], arrayOrVector3[2]);\n}\n\n\n\n// WEBPACK FOOTER //\n// ./util/convertToVector3.js","import external from '@/externalModules.js';\n\n// This implements an imageId specific tool state management strategy.  This means that\n// Measurements data is tied to a specific imageId and only visible for enabled elements\n// That are displaying that imageId.\n\nfunction newImageIdSpecificToolStateManager () {\n  let toolState = {};\n\n  // Here we add tool state, this is done by tools as well\n  // As modules that restore saved state\n\n  function saveImageIdToolState (imageId) {\n    return toolState[imageId];\n  }\n\n  function restoreImageIdToolState (imageId, imageIdToolState) {\n    toolState[imageId] = imageIdToolState;\n  }\n\n  function saveToolState () {\n    return toolState;\n  }\n\n  function restoreToolState (savedToolState) {\n    toolState = savedToolState;\n  }\n\n  // Here we add tool state, this is done by tools as well\n  // As modules that restore saved state\n  function addImageIdSpecificToolState (element, toolType, data) {\n    const enabledImage = external.cornerstone.getEnabledElement(element);\n    // If we don't have any tool state for this imageId, add an empty object\n\n    if (!enabledImage.image || toolState.hasOwnProperty(enabledImage.image.imageId) === false) {\n      toolState[enabledImage.image.imageId] = {};\n    }\n\n    const imageIdToolState = toolState[enabledImage.image.imageId];\n\n    // If we don't have tool state for this type of tool, add an empty object\n    if (imageIdToolState.hasOwnProperty(toolType) === false) {\n      imageIdToolState[toolType] = {\n        data: []\n      };\n    }\n\n    const toolData = imageIdToolState[toolType];\n\n    // Finally, add this new tool to the state\n    toolData.data.push(data);\n  }\n\n  // Here you can get state - used by tools as well as modules\n  // That save state persistently\n  function getImageIdSpecificToolState (element, toolType) {\n    const enabledImage = external.cornerstone.getEnabledElement(element);\n    // If we don't have any tool state for this imageId, return undefined\n\n    if (!enabledImage.image || toolState.hasOwnProperty(enabledImage.image.imageId) === false) {\n      return;\n    }\n\n    const imageIdToolState = toolState[enabledImage.image.imageId];\n\n    // If we don't have tool state for this type of tool, return undefined\n    if (imageIdToolState.hasOwnProperty(toolType) === false) {\n      return;\n    }\n\n    const toolData = imageIdToolState[toolType];\n\n\n    return toolData;\n  }\n\n  // Clears all tool data from this toolStateManager.\n  function clearImageIdSpecificToolStateManager (element) {\n    const enabledImage = external.cornerstone.getEnabledElement(element);\n\n    if (!enabledImage.image || toolState.hasOwnProperty(enabledImage.image.imageId) === false) {\n      return;\n    }\n\n    delete toolState[enabledImage.image.imageId];\n  }\n\n  return {\n    get: getImageIdSpecificToolState,\n    add: addImageIdSpecificToolState,\n    clear: clearImageIdSpecificToolStateManager,\n    saveImageIdToolState,\n    restoreImageIdToolState,\n    saveToolState,\n    restoreToolState,\n    toolState\n  };\n}\n\n// A global imageIdSpecificToolStateManager - the most common case is to share state between all\n// Visible enabled images\nconst globalImageIdSpecificToolStateManager = newImageIdSpecificToolStateManager();\n\nexport {\n  newImageIdSpecificToolStateManager,\n  globalImageIdSpecificToolStateManager\n};\n\n\n\n// WEBPACK FOOTER //\n// ./stateManagement/imageIdSpecificStateManager.js","import external from '@/externalModules.js';\n\nexport default function (handle, coords) {\n  if (!handle.boundingBox) {\n    return;\n  }\n\n  return external.cornerstoneMath.point.insideRect(coords, handle.boundingBox);\n}\n\n\n\n// WEBPACK FOOTER //\n// ./util/pointInsideBoundingBox.js","import external from '@/externalModules.js';\nimport pointInsideBoundingBox from '@/util/pointInsideBoundingBox.js';\n\nexport default function (element, handles, coords, distanceThreshold) {\n  let nearbyHandle;\n\n  if (!handles) {\n    return;\n  }\n\n  Object.keys(handles).forEach(function (name) {\n    const handle = handles[name];\n\n    if (handle.hasOwnProperty('pointNearHandle')) {\n      if (handle.pointNearHandle(element, handle, coords)) {\n        nearbyHandle = handle;\n\n        return;\n      }\n    } else if (handle.hasBoundingBox === true) {\n      if (pointInsideBoundingBox(handle, coords)) {\n        nearbyHandle = handle;\n\n        return;\n      }\n    } else {\n      const handleCanvas = external.cornerstone.pixelToCanvas(element, handle);\n      const distance = external.cornerstoneMath.point.distance(handleCanvas, coords);\n\n      if (distance <= distanceThreshold) {\n        nearbyHandle = handle;\n\n        return;\n      }\n    }\n  });\n\n  return nearbyHandle;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./manipulators/getHandleNearImagePoint.js","let configMaxSimultaneousRequests;\n\n// Maximum concurrent connections to the same server\n// Information from http://sgdev-blog.blogspot.fr/2014/01/maximum-concurrent-connection-to-same.html\nconst maxSimultaneousRequests = {\n  default: 6,\n  IE: {\n    9: 6,\n    10: 8,\n    default: 8\n  },\n  Firefox: {\n    default: 6\n  },\n  Opera: {\n    10: 8,\n    11: 6,\n    12: 6,\n    default: 6\n  },\n  Chrome: {\n    default: 6\n  },\n  Safari: {\n    default: 6\n  }\n};\n\n// Browser name / version detection\n// http://stackoverflow.com/questions/2400935/browser-detection-in-javascript\nfunction getBrowserInfo () {\n  const ua = navigator.userAgent;\n  let M = ua.match(/(opera|chrome|safari|firefox|msie|trident(?=\\/))\\/?\\s*(\\d+)/i) || [];\n  let tem;\n\n  if (/trident/i.test(M[1])) {\n    tem = (/\\brv[ :]+(\\d+)/g).exec(ua) || [];\n\n    return `IE ${tem[1] || ''}`;\n  }\n\n  if (M[1] === 'Chrome') {\n    tem = ua.match(/\\b(OPR|Edge)\\/(\\d+)/);\n    if (tem !== null) {\n      return tem.slice(1).join(' ').replace('OPR', 'Opera');\n    }\n  }\n\n  M = M[2] ? [M[1], M[2]] : [navigator.appName, navigator.appVersion, '-?'];\n  if ((tem = ua.match(/version\\/(\\d+)/i)) !== null) {\n    M.splice(1, 1, tem[1]);\n  }\n\n  return M.join(' ');\n}\n\nfunction setMaxSimultaneousRequests (newMaxSimultaneousRequests) {\n  configMaxSimultaneousRequests = newMaxSimultaneousRequests;\n}\n\nfunction getMaxSimultaneousRequests () {\n  if (configMaxSimultaneousRequests) {\n    return configMaxSimultaneousRequests;\n  }\n\n  return getDefaultSimultaneousRequests();\n}\n\nfunction getDefaultSimultaneousRequests () {\n  const infoString = getBrowserInfo();\n  const info = infoString.split(' ');\n  const browserName = info[0];\n  const browserVersion = info[1];\n  const browserData = maxSimultaneousRequests[browserName];\n\n  if (!browserData) {\n    return maxSimultaneousRequests.default;\n  }\n\n  if (!browserData[browserVersion]) {\n    return browserData.default;\n  }\n\n  return browserData[browserVersion];\n}\n\nfunction isMobileDevice () {\n  const pattern = new RegExp('Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini');\n\n\n  return pattern.test(navigator.userAgent);\n}\n\nexport {\n  getDefaultSimultaneousRequests,\n  getMaxSimultaneousRequests,\n  setMaxSimultaneousRequests,\n  getBrowserInfo,\n  isMobileDevice\n};\n\n\n\n// WEBPACK FOOTER //\n// ./util/getMaxSimultaneousRequests.js","import external from '@/externalModules.js';\n\n// Returns a decimal value given a fractional value\nfunction fracToDec (fractionalValue) {\n  return parseFloat(`.${fractionalValue}`);\n}\n\nexport default function (image, storedPixelValue) {\n  const cornerstone = external.cornerstone;\n  const patientStudyModule = cornerstone.metaData.get('patientStudyModule', image.imageId);\n  const seriesModule = cornerstone.metaData.get('generalSeriesModule', image.imageId);\n\n  if (!patientStudyModule || !seriesModule) {\n    return;\n  }\n\n  const modality = seriesModule.modality;\n\n  // Image must be PET\n  if (modality !== 'PT') {\n    return;\n  }\n\n  const modalityPixelValue = storedPixelValue * image.slope + image.intercept;\n\n  const patientWeight = patientStudyModule.patientWeight; // In kg\n\n  if (!patientWeight) {\n    return;\n  }\n\n  const petSequenceModule = cornerstone.metaData.get('petIsotopeModule', image.imageId);\n\n  if (!petSequenceModule) {\n    return;\n  }\n\n  const radiopharmaceuticalInfo = petSequenceModule.radiopharmaceuticalInfo;\n  const startTime = radiopharmaceuticalInfo.radiopharmaceuticalStartTime;\n  const totalDose = radiopharmaceuticalInfo.radionuclideTotalDose;\n  const halfLife = radiopharmaceuticalInfo.radionuclideHalfLife;\n  const seriesAcquisitionTime = seriesModule.seriesTime;\n\n  if (!startTime || !totalDose || !halfLife || !seriesAcquisitionTime) {\n    return;\n  }\n\n  const acquisitionTimeInSeconds = fracToDec(seriesAcquisitionTime.fractionalSeconds || 0) + seriesAcquisitionTime.seconds + seriesAcquisitionTime.minutes * 60 + seriesAcquisitionTime.hours * 60 * 60;\n  const injectionStartTimeInSeconds = fracToDec(startTime.fractionalSeconds) + startTime.seconds + startTime.minutes * 60 + startTime.hours * 60 * 60;\n  const durationInSeconds = acquisitionTimeInSeconds - injectionStartTimeInSeconds;\n  const correctedDose = totalDose * Math.exp(-durationInSeconds * Math.log(2) / halfLife);\n  const suv = modalityPixelValue * patientWeight / correctedDose * 1000;\n\n  return suv;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./util/calculateSUV.js","import external from '@/externalModules.js';\nimport { getMaxSimultaneousRequests } from '@/util/getMaxSimultaneousRequests.js';\n\nconst requestPool = {\n  interaction: [],\n  thumbnail: [],\n  prefetch: []\n};\n\nconst numRequests = {\n  interaction: 0,\n  thumbnail: 0,\n  prefetch: 0\n};\n\nlet maxNumRequests = {\n  interaction: 6,\n  thumbnail: 6,\n  prefetch: 5\n};\n\nlet awake = false;\nconst grabDelay = 20;\n\nfunction addRequest (element, imageId, type, preventCache, doneCallback, failCallback, addToBeginning) {\n  if (!requestPool.hasOwnProperty(type)) {\n    throw new Error('Request type must be one of interaction, thumbnail, or prefetch');\n  }\n\n  if (!element || !imageId) {\n    return;\n  }\n\n  // Describe the request\n  const requestDetails = {\n    type,\n    imageId,\n    preventCache,\n    doneCallback,\n    failCallback\n  };\n\n  // If this imageId is in the cache, resolve it immediately\n  const imageLoadObject = external.cornerstone.imageCache.getImageLoadObject(imageId);\n\n  if (imageLoadObject) {\n    imageLoadObject.promise.then(function (image) {\n      doneCallback(image);\n    }, function (error) {\n      failCallback(error);\n    });\n\n    return;\n  }\n\n  if (addToBeginning) {\n    // Add it to the beginning of the stack\n    requestPool[type].unshift(requestDetails);\n  } else {\n    // Add it to the end of the stack\n    requestPool[type].push(requestDetails);\n  }\n}\n\nfunction clearRequestStack (type) {\n  // Console.log('clearRequestStack');\n  if (!requestPool.hasOwnProperty(type)) {\n    throw new Error('Request type must be one of interaction, thumbnail, or prefetch');\n  }\n\n  requestPool[type] = [];\n}\n\nfunction startAgain () {\n  if (!awake) {\n    return;\n  }\n\n  setTimeout(function () {\n    startGrabbing();\n  }, grabDelay);\n}\n\nfunction sendRequest (requestDetails) {\n  const cornerstone = external.cornerstone;\n  // Increment the number of current requests of this type\n  const type = requestDetails.type;\n\n  numRequests[type]++;\n\n  awake = true;\n  const imageId = requestDetails.imageId;\n  const doneCallback = requestDetails.doneCallback;\n  const failCallback = requestDetails.failCallback;\n\n  // Check if we already have this image promise in the cache\n  const imageLoadObject = cornerstone.imageCache.getImageLoadObject(imageId);\n\n  if (imageLoadObject) {\n    // If we do, remove from list (when resolved, as we could have\n    // Pending prefetch requests) and stop processing this iteration\n    imageLoadObject.promise.then(function (image) {\n      numRequests[type]--;\n      // Console.log(numRequests);\n\n      doneCallback(image);\n      startAgain();\n    }, function (error) {\n      numRequests[type]--;\n      // Console.log(numRequests);\n      failCallback(error);\n      startAgain();\n    });\n\n    return;\n  }\n\n  function requestTypeToLoadPriority (requestDetails) {\n    if (requestDetails.type === 'prefetch') {\n      return -5;\n    } else if (requestDetails.type === 'interactive') {\n      return 0;\n    } else if (requestDetails.type === 'thumbnail') {\n      return 5;\n    }\n  }\n\n  const priority = requestTypeToLoadPriority(requestDetails);\n\n  let loader;\n\n  if (requestDetails.preventCache === true) {\n    loader = cornerstone.loadImage(imageId, {\n      priority,\n      type: requestDetails.type\n    });\n  } else {\n    loader = cornerstone.loadAndCacheImage(imageId, {\n      priority,\n      type: requestDetails.type\n    });\n  }\n\n  // Load and cache the image\n  loader.then(function (image) {\n    numRequests[type]--;\n    // Console.log(numRequests);\n    doneCallback(image);\n    startAgain();\n  }, function (error) {\n    numRequests[type]--;\n    // Console.log(numRequests);\n    failCallback(error);\n    startAgain();\n  });\n}\n\nfunction startGrabbing () {\n  // Begin by grabbing X images\n  const maxSimultaneousRequests = getMaxSimultaneousRequests();\n\n  maxNumRequests = {\n    interaction: Math.max(maxSimultaneousRequests, 1),\n    thumbnail: Math.max(maxSimultaneousRequests - 2, 1),\n    prefetch: Math.max(maxSimultaneousRequests - 1, 1)\n  };\n\n  const currentRequests = numRequests.interaction +\n          numRequests.thumbnail +\n          numRequests.prefetch;\n  const requestsToSend = maxSimultaneousRequests - currentRequests;\n\n  for (let i = 0; i < requestsToSend; i++) {\n    const requestDetails = getNextRequest();\n\n    if (requestDetails) {\n      sendRequest(requestDetails);\n    }\n  }\n}\n\nfunction getNextRequest () {\n  if (requestPool.interaction.length && numRequests.interaction < maxNumRequests.interaction) {\n    return requestPool.interaction.shift();\n  }\n\n  if (requestPool.thumbnail.length && numRequests.thumbnail < maxNumRequests.thumbnail) {\n    return requestPool.thumbnail.shift();\n  }\n\n  if (requestPool.prefetch.length && numRequests.prefetch < maxNumRequests.prefetch) {\n    return requestPool.prefetch.shift();\n  }\n\n  if (!requestPool.interaction.length &&\n          !requestPool.thumbnail.length &&\n          !requestPool.prefetch.length) {\n    awake = false;\n  }\n\n  return false;\n}\n\nfunction getRequestPool () {\n  return requestPool;\n}\n\nexport default {\n  addRequest,\n  clearRequestStack,\n  startGrabbing,\n  getRequestPool\n};\n\n\n\n// WEBPACK FOOTER //\n// ./requestPool/requestPoolManager.js","export default function (ellipse, location) {\n  const xRadius = ellipse.width / 2;\n  const yRadius = ellipse.height / 2;\n\n  if (xRadius <= 0.0 || yRadius <= 0.0) {\n    return false;\n  }\n\n  const center = {\n    x: ellipse.left + xRadius,\n    y: ellipse.top + yRadius\n  };\n\n    /* This is a more general form of the circle equation\n     *\n     * X^2/a^2 + Y^2/b^2 <= 1\n     */\n\n  const normalized = {\n    x: location.x - center.x,\n    y: location.y - center.y\n  };\n\n  const inEllipse = ((normalized.x * normalized.x) / (xRadius * xRadius)) + ((normalized.y * normalized.y) / (yRadius * yRadius)) <= 1.0;\n\n\n  return inEllipse;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./util/pointInEllipse.js","import EVENTS from '@/events.js';\nimport external from '@/externalModules.js';\nimport triggerEvent from '@/util/triggerEvent.js';\n\nexport default function (mouseEventData, toolType, data, handle, doneMovingCallback, preventHandleOutsideImage) {\n  const cornerstone = external.cornerstone;\n  const element = mouseEventData.element;\n  const distanceFromTool = {\n    x: handle.x - mouseEventData.currentPoints.image.x,\n    y: handle.y - mouseEventData.currentPoints.image.y\n  };\n\n  function mouseDragCallback (e) {\n    const eventData = e.detail;\n\n    if (handle.hasMoved === false) {\n      handle.hasMoved = true;\n    }\n\n    handle.active = true;\n    handle.x = eventData.currentPoints.image.x + distanceFromTool.x;\n    handle.y = eventData.currentPoints.image.y + distanceFromTool.y;\n\n    if (preventHandleOutsideImage) {\n      handle.x = Math.max(handle.x, 0);\n      handle.x = Math.min(handle.x, eventData.image.width);\n\n      handle.y = Math.max(handle.y, 0);\n      handle.y = Math.min(handle.y, eventData.image.height);\n    }\n\n    cornerstone.updateImage(element);\n\n    const eventType = EVENTS.MEASUREMENT_MODIFIED;\n    const modifiedEventData = {\n      toolType,\n      element,\n      measurementData: data\n    };\n\n    triggerEvent(element, eventType, modifiedEventData);\n  }\n\n  element.addEventListener(EVENTS.MOUSE_DRAG, mouseDragCallback);\n\n  function mouseUpCallback () {\n    handle.active = false;\n    element.removeEventListener(EVENTS.MOUSE_DRAG, mouseDragCallback);\n    element.removeEventListener(EVENTS.MOUSE_UP, mouseUpCallback);\n    element.removeEventListener(EVENTS.MOUSE_CLICK, mouseUpCallback);\n    cornerstone.updateImage(element);\n\n    if (typeof doneMovingCallback === 'function') {\n      doneMovingCallback();\n    }\n  }\n\n  element.addEventListener(EVENTS.MOUSE_UP, mouseUpCallback);\n  element.addEventListener(EVENTS.MOUSE_CLICK, mouseUpCallback);\n}\n\n\n\n// WEBPACK FOOTER //\n// ./manipulators/moveHandle.js","import EVENTS from '@/events.js';\nimport external from '@/externalModules.js';\nimport triggerEvent from '@/util/triggerEvent.js';\n\nexport default function (mouseEventData, toolType, data, handle, doneMovingCallback, preventHandleOutsideImage) {\n  const cornerstone = external.cornerstone;\n  const element = mouseEventData.element;\n\n  function moveCallback (e) {\n    const eventData = e.detail;\n\n    handle.active = true;\n    handle.x = eventData.currentPoints.image.x;\n    handle.y = eventData.currentPoints.image.y;\n\n    if (preventHandleOutsideImage) {\n      handle.x = Math.max(handle.x, 0);\n      handle.x = Math.min(handle.x, eventData.image.width);\n\n      handle.y = Math.max(handle.y, 0);\n      handle.y = Math.min(handle.y, eventData.image.height);\n    }\n\n    cornerstone.updateImage(element);\n\n    const eventType = EVENTS.MEASUREMENT_MODIFIED;\n    const modifiedEventData = {\n      toolType,\n      element,\n      measurementData: data\n    };\n\n    triggerEvent(element, eventType, modifiedEventData);\n  }\n\n  function whichMovement (e) {\n    element.removeEventListener(EVENTS.MOUSE_MOVE, whichMovement);\n    element.removeEventListener(EVENTS.MOUSE_DRAG, whichMovement);\n\n    element.addEventListener(EVENTS.MOUSE_MOVE, moveCallback);\n    element.addEventListener(EVENTS.MOUSE_DRAG, moveCallback);\n\n    element.addEventListener(EVENTS.MOUSE_CLICK, moveEndCallback);\n    if (e.type === EVENTS.MOUSE_DRAG) {\n      element.addEventListener(EVENTS.MOUSE_UP, moveEndCallback);\n    }\n  }\n\n  function measurementRemovedCallback (e) {\n    const eventData = e.detail;\n\n    if (eventData.measurementData === data) {\n      moveEndCallback();\n    }\n  }\n\n  function toolDeactivatedCallback (e) {\n    const eventData = e.detail;\n\n    if (eventData.toolType === toolType) {\n      element.removeEventListener(EVENTS.MOUSE_MOVE, moveCallback);\n      element.removeEventListener(EVENTS.MOUSE_DRAG, moveCallback);\n      element.removeEventListener(EVENTS.MOUSE_CLICK, moveEndCallback);\n      element.removeEventListener(EVENTS.MOUSE_UP, moveEndCallback);\n      element.removeEventListener(EVENTS.MEASUREMENT_REMOVED, measurementRemovedCallback);\n      element.removeEventListener(EVENTS.TOOL_DEACTIVATED, toolDeactivatedCallback);\n\n      handle.active = false;\n      cornerstone.updateImage(element);\n    }\n  }\n\n  element.addEventListener(EVENTS.MOUSE_DRAG, whichMovement);\n  element.addEventListener(EVENTS.MOUSE_MOVE, whichMovement);\n  element.addEventListener(EVENTS.MEASUREMENT_REMOVED, measurementRemovedCallback);\n  element.addEventListener(EVENTS.TOOL_DEACTIVATED, toolDeactivatedCallback);\n\n  function moveEndCallback () {\n    element.removeEventListener(EVENTS.MOUSE_MOVE, moveCallback);\n    element.removeEventListener(EVENTS.MOUSE_DRAG, moveCallback);\n    element.removeEventListener(EVENTS.MOUSE_CLICK, moveEndCallback);\n    element.removeEventListener(EVENTS.MOUSE_UP, moveEndCallback);\n    element.removeEventListener(EVENTS.MEASUREMENT_REMOVED, measurementRemovedCallback);\n    element.removeEventListener(EVENTS.TOOL_DEACTIVATED, toolDeactivatedCallback);\n\n    handle.active = false;\n    cornerstone.updateImage(element);\n\n    if (typeof doneMovingCallback === 'function') {\n      doneMovingCallback();\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./manipulators/moveNewHandle.js","import EVENTS from '@/events.js';\nimport external from '@/externalModules.js';\nimport triggerEvent from '@/util/triggerEvent.js';\n\nexport default function (eventData, toolType, data, handle, doneMovingCallback, preventHandleOutsideImage) {\n  // Console.log('moveNewHandleTouch');\n  const cornerstone = external.cornerstone;\n  const element = eventData.element;\n  const imageCoords = cornerstone.pageToPixel(element, eventData.currentPoints.page.x, eventData.currentPoints.page.y + 50);\n  const distanceFromTouch = {\n    x: handle.x - imageCoords.x,\n    y: handle.y - imageCoords.y\n  };\n\n  handle.active = true;\n  data.active = true;\n\n  function moveCallback (e) {\n    const eventData = e.detail;\n\n    handle.x = eventData.currentPoints.image.x + distanceFromTouch.x;\n    handle.y = eventData.currentPoints.image.y + distanceFromTouch.y;\n\n    if (preventHandleOutsideImage) {\n      handle.x = Math.max(handle.x, 0);\n      handle.x = Math.min(handle.x, eventData.image.width);\n\n      handle.y = Math.max(handle.y, 0);\n      handle.y = Math.min(handle.y, eventData.image.height);\n    }\n\n    cornerstone.updateImage(element);\n\n    const eventType = EVENTS.MEASUREMENT_MODIFIED;\n    const modifiedEventData = {\n      toolType,\n      element,\n      measurementData: data\n    };\n\n    triggerEvent(element, eventType, modifiedEventData);\n  }\n\n  function moveEndCallback (e) {\n    const eventData = e.detail;\n\n    element.removeEventListener(EVENTS.TOUCH_DRAG, moveCallback);\n    element.removeEventListener(EVENTS.TOUCH_PINCH, moveEndCallback);\n    element.removeEventListener(EVENTS.TOUCH_END, moveEndCallback);\n    element.removeEventListener(EVENTS.TAP, moveEndCallback);\n    element.removeEventListener(EVENTS.TOUCH_START, stopImmediatePropagation);\n    element.removeEventListener(EVENTS.TOOL_DEACTIVATED, toolDeactivatedCallback);\n\n    if (e.type === EVENTS.TOUCH_PINCH || e.type === EVENTS.TOUCH_PRESS) {\n      handle.active = false;\n      cornerstone.updateImage(element);\n      doneMovingCallback();\n\n      return;\n    }\n\n    handle.active = false;\n    data.active = false;\n    handle.x = eventData.currentPoints.image.x + distanceFromTouch.x;\n    handle.y = eventData.currentPoints.image.y + distanceFromTouch.y;\n\n    if (preventHandleOutsideImage) {\n      handle.x = Math.max(handle.x, 0);\n      handle.x = Math.min(handle.x, eventData.image.width);\n\n      handle.y = Math.max(handle.y, 0);\n      handle.y = Math.min(handle.y, eventData.image.height);\n    }\n\n    cornerstone.updateImage(element);\n\n    if (typeof doneMovingCallback === 'function') {\n      doneMovingCallback();\n    }\n  }\n\n  function stopImmediatePropagation (e) {\n    // Stop the CornerstoneToolsTouchStart event from\n    // Become a CornerstoneToolsTouchStartActive event when\n    // MoveNewHandleTouch ends\n    e.stopImmediatePropagation();\n\n    return false;\n  }\n\n  element.addEventListener(EVENTS.TOUCH_DRAG, moveCallback);\n  element.addEventListener(EVENTS.TOUCH_PINCH, moveEndCallback);\n  element.addEventListener(EVENTS.TOUCH_END, moveEndCallback);\n  element.addEventListener(EVENTS.TAP, moveEndCallback);\n  element.addEventListener(EVENTS.TOUCH_START, stopImmediatePropagation);\n\n  function toolDeactivatedCallback () {\n    element.removeEventListener(EVENTS.TOUCH_DRAG, moveCallback);\n    element.removeEventListener(EVENTS.TOUCH_PINCH, moveEndCallback);\n    element.removeEventListener(EVENTS.TOUCH_END, moveEndCallback);\n    element.removeEventListener(EVENTS.TAP, moveEndCallback);\n    element.removeEventListener(EVENTS.TOUCH_START, stopImmediatePropagation);\n    element.removeEventListener(EVENTS.TOOL_DEACTIVATED, toolDeactivatedCallback);\n\n    handle.active = false;\n    data.active = false;\n    handle.x = eventData.currentPoints.image.x + distanceFromTouch.x;\n    handle.y = eventData.currentPoints.image.y + distanceFromTouch.y;\n\n    if (preventHandleOutsideImage) {\n      handle.x = Math.max(handle.x, 0);\n      handle.x = Math.min(handle.x, eventData.image.width);\n\n      handle.y = Math.max(handle.y, 0);\n      handle.y = Math.min(handle.y, eventData.image.height);\n    }\n\n    cornerstone.updateImage(element);\n  }\n\n  element.addEventListener(EVENTS.TOOL_DEACTIVATED, toolDeactivatedCallback);\n}\n\n\n\n// WEBPACK FOOTER //\n// ./manipulators/moveNewHandleTouch.js","import external from '@/externalModules.js';\nimport convertToVector3 from '@/util/convertToVector3.js';\n\n// Projects a patient point to an image point\nexport function projectPatientPointToImagePlane (patientPoint, imagePlane) {\n  const rowCosines = convertToVector3(imagePlane.rowCosines);\n  const columnCosines = convertToVector3(imagePlane.columnCosines);\n  const imagePositionPatient = convertToVector3(imagePlane.imagePositionPatient);\n  const point = patientPoint.clone().sub(imagePositionPatient);\n  const x = rowCosines.dot(point) / imagePlane.columnPixelSpacing;\n  const y = columnCosines.dot(point) / imagePlane.rowPixelSpacing;\n\n\n  return {\n    x,\n    y\n  };\n}\n\n// Projects an image point to a patient point\nexport function imagePointToPatientPoint (imagePoint, imagePlane) {\n  const rowCosines = convertToVector3(imagePlane.rowCosines);\n  const columnCosines = convertToVector3(imagePlane.columnCosines);\n  const imagePositionPatient = convertToVector3(imagePlane.imagePositionPatient);\n\n  const x = rowCosines.clone().multiplyScalar(imagePoint.x);\n\n  x.multiplyScalar(imagePlane.columnPixelSpacing);\n  const y = columnCosines.clone().multiplyScalar(imagePoint.y);\n\n  y.multiplyScalar(imagePlane.rowPixelSpacing);\n  const patientPoint = x.add(y);\n\n  patientPoint.add(imagePositionPatient);\n\n  return patientPoint;\n}\n\nfunction getRectangleFromImagePlane (imagePlane) {\n  // Get the points\n  const topLeft = imagePointToPatientPoint({\n    x: 0,\n    y: 0\n  }, imagePlane);\n  const topRight = imagePointToPatientPoint({\n    x: imagePlane.columns,\n    y: 0\n  }, imagePlane);\n  const bottomLeft = imagePointToPatientPoint({\n    x: 0,\n    y: imagePlane.rows\n  }, imagePlane);\n  const bottomRight = imagePointToPatientPoint({\n    x: imagePlane.columns,\n    y: imagePlane.rows\n  }, imagePlane);\n\n    // Get each side as a vector\n  const rect = {\n    top: new external.cornerstoneMath.Line3(topLeft, topRight),\n    left: new external.cornerstoneMath.Line3(topLeft, bottomLeft),\n    right: new external.cornerstoneMath.Line3(topRight, bottomRight),\n    bottom: new external.cornerstoneMath.Line3(bottomLeft, bottomRight)\n  };\n\n\n  return rect;\n}\n\nfunction lineRectangleIntersection (line, rect) {\n  const intersections = [];\n\n  Object.keys(rect).forEach(function (side) {\n    const segment = rect[side];\n    const intersection = line.intersectLine(segment);\n\n    if (intersection) {\n      intersections.push(intersection);\n    }\n  });\n\n  return intersections;\n}\n\n// Gets the line of intersection between two planes in patient space\nexport function planePlaneIntersection (targetImagePlane, referenceImagePlane) {\n  const targetRowCosines = convertToVector3(targetImagePlane.rowCosines);\n  const targetColumnCosines = convertToVector3(targetImagePlane.columnCosines);\n  const targetImagePositionPatient = convertToVector3(targetImagePlane.imagePositionPatient);\n  const referenceRowCosines = convertToVector3(referenceImagePlane.rowCosines);\n  const referenceColumnCosines = convertToVector3(referenceImagePlane.columnCosines);\n  const referenceImagePositionPatient = convertToVector3(referenceImagePlane.imagePositionPatient);\n\n  // First, get the normals of each image plane\n  const targetNormal = targetRowCosines.clone().cross(targetColumnCosines);\n  const targetPlane = new external.cornerstoneMath.Plane();\n\n  targetPlane.setFromNormalAndCoplanarPoint(targetNormal, targetImagePositionPatient);\n\n  const referenceNormal = referenceRowCosines.clone().cross(referenceColumnCosines);\n  const referencePlane = new external.cornerstoneMath.Plane();\n\n  referencePlane.setFromNormalAndCoplanarPoint(referenceNormal, referenceImagePositionPatient);\n\n  const originDirection = referencePlane.clone().intersectPlane(targetPlane);\n  const origin = originDirection.origin;\n  const direction = originDirection.direction;\n\n  // Calculate the longest possible length in the reference image plane (the length of the diagonal)\n  const bottomRight = imagePointToPatientPoint({\n    x: referenceImagePlane.columns,\n    y: referenceImagePlane.rows\n  }, referenceImagePlane);\n  const distance = referenceImagePositionPatient.distanceTo(bottomRight);\n\n  // Use this distance to bound the ray intersecting the two planes\n  const line = new external.cornerstoneMath.Line3();\n\n  line.start = origin;\n  line.end = origin.clone().add(direction.multiplyScalar(distance));\n\n  // Find the intersections between this line and the reference image plane's four sides\n  const rect = getRectangleFromImagePlane(referenceImagePlane);\n  const intersections = lineRectangleIntersection(line, rect);\n\n  // Return the intersections between this line and the reference image plane's sides\n  // In order to draw the reference line from the target image.\n  if (intersections.length !== 2) {\n    return;\n  }\n\n  return {\n    start: intersections[0],\n    end: intersections[1]\n  };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./util/pointProjector.js","import EVENTS from '@/events.js';\nimport external from '@/externalModules.js';\nimport { getToolState } from '@/stateManagement/toolState.js';\nimport requestPoolManager from '../requestPool/requestPoolManager.js';\nimport loadHandlerManager from '@/stateManagement/loadHandlerManager.js';\nimport triggerEvent from '@/util/triggerEvent.js';\n\nexport default function (element, newImageIdIndex) {\n  const toolData = getToolState(element, 'stack');\n\n  if (!toolData || !toolData.data || !toolData.data.length) {\n    return;\n  }\n\n  const cornerstone = external.cornerstone;\n  // If we have more than one stack, check if we have a stack renderer defined\n  let stackRenderer;\n\n  if (toolData.data.length > 1) {\n    const stackRendererData = getToolState(element, 'stackRenderer');\n\n    if (stackRendererData && stackRendererData.data && stackRendererData.data.length) {\n      stackRenderer = stackRendererData.data[0];\n    }\n  }\n\n  const stackData = toolData.data[0];\n\n  // Allow for negative indexing\n  if (newImageIdIndex < 0) {\n    newImageIdIndex += stackData.imageIds.length;\n  }\n\n  const startLoadingHandler = loadHandlerManager.getStartLoadHandler();\n  const endLoadingHandler = loadHandlerManager.getEndLoadHandler();\n  const errorLoadingHandler = loadHandlerManager.getErrorLoadingHandler();\n\n  function doneCallback (image) {\n    if (stackData.currentImageIdIndex !== newImageIdIndex) {\n      return;\n    }\n\n    // Check if the element is still enabled in Cornerstone,\n    // If an error is thrown, stop here.\n    try {\n      // TODO: Add 'isElementEnabled' to Cornerstone?\n      cornerstone.getEnabledElement(element);\n    } catch(error) {\n      return;\n    }\n\n    if (stackRenderer) {\n      stackRenderer.currentImageIdIndex = newImageIdIndex;\n      stackRenderer.render(element, toolData.data);\n    } else {\n      cornerstone.displayImage(element, image);\n    }\n\n    if (endLoadingHandler) {\n      endLoadingHandler(element, image);\n    }\n  }\n\n  function failCallback (error) {\n    const imageId = stackData.imageIds[newImageIdIndex];\n\n    if (errorLoadingHandler) {\n      errorLoadingHandler(element, imageId, error);\n    }\n  }\n\n  if (newImageIdIndex === stackData.currentImageIdIndex) {\n    return;\n  }\n\n  if (startLoadingHandler) {\n    startLoadingHandler(element);\n  }\n\n  const eventData = {\n    newImageIdIndex,\n    direction: newImageIdIndex - stackData.currentImageIdIndex\n  };\n\n  stackData.currentImageIdIndex = newImageIdIndex;\n  const newImageId = stackData.imageIds[newImageIdIndex];\n\n  // Retry image loading in cases where previous image promise\n  // Was rejected, if the option is set\n  /*\n\n    Const config = stackScroll.getConfiguration();\n\n    TODO: Revisit this. It appears that Core's imageCache is not\n    keeping rejected promises anywhere, so we have no way to know\n    if something was previously rejected.\n\n    if (config && config.retryLoadOnScroll === true) {\n    }\n  */\n\n  // Convert the preventCache value in stack data to a boolean\n  const preventCache = Boolean(stackData.preventCache);\n\n  let imagePromise;\n\n  if (preventCache) {\n    imagePromise = cornerstone.loadImage(newImageId);\n  } else {\n    imagePromise = cornerstone.loadAndCacheImage(newImageId);\n  }\n\n  imagePromise.then(doneCallback, failCallback);\n  // Make sure we kick off any changed download request pools\n  requestPoolManager.startGrabbing();\n\n  triggerEvent(element, EVENTS.STACK_SCROLL, eventData);\n}\n\n\n\n// WEBPACK FOOTER //\n// ./util/scrollToIndex.js","import scrollToIndex from './scrollToIndex.js';\nimport { getToolState } from '@/stateManagement/toolState.js';\n\nfunction scrollWithoutSkipping (stackData, pendingEvent, element) {\n  if (stackData.pending[0] === pendingEvent) {\n    if (stackData.currentImageIdIndex === pendingEvent.index) {\n      stackData.pending.splice(stackData.pending.indexOf(pendingEvent), 1);\n\n      if (stackData.pending.length > 0) {\n        scrollWithoutSkipping(stackData, stackData.pending[0], element);\n      }\n\n      return;\n    }\n\n    const newImageHandler = function (event) {\n      const index = stackData.imageIds.indexOf(event.detail.image.imageId);\n\n      if (index === pendingEvent.index) {\n        stackData.pending.splice(stackData.pending.indexOf(pendingEvent), 1);\n        element.removeEventListener('cornerstonenewimage', newImageHandler);\n\n        if (stackData.pending.length > 0) {\n          scrollWithoutSkipping(stackData, stackData.pending[0], element);\n        }\n      }\n    };\n\n    element.addEventListener('cornerstonenewimage', newImageHandler);\n\n    scrollToIndex(element, pendingEvent.index);\n  }\n}\n\nexport default function (element, images, loop = false, allowSkipping = true) {\n  const toolData = getToolState(element, 'stack');\n\n  if (!toolData || !toolData.data || !toolData.data.length) {\n    return;\n  }\n\n  const stackData = toolData.data[0];\n\n  if (!stackData.pending) {\n    stackData.pending = [];\n  }\n\n  let newImageIdIndex = stackData.currentImageIdIndex + images;\n\n  if (loop) {\n    const nbImages = stackData.imageIds.length;\n\n    newImageIdIndex %= nbImages;\n  } else {\n    newImageIdIndex = Math.min(stackData.imageIds.length - 1, newImageIdIndex);\n    newImageIdIndex = Math.max(0, newImageIdIndex);\n  }\n\n  if (allowSkipping) {\n    scrollToIndex(element, newImageIdIndex);\n  } else {\n    const pendingEvent = {\n      index: newImageIdIndex\n    };\n\n    stackData.pending.push(pendingEvent);\n    scrollWithoutSkipping(stackData, pendingEvent, element);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./util/scroll.js","export default function (value, precision) {\n  const multiplier = Math.pow(10, precision);\n\n\n  return (Math.round(value * multiplier) / multiplier);\n}\n\n\n\n// WEBPACK FOOTER //\n// ./util/roundToDecimal.js","import external from '@/externalModules.js';\n\nexport default function (element, x, y, width, height) {\n  if (!element) {\n    throw new Error('getRGBPixels: parameter element must not be undefined');\n  }\n\n  x = Math.round(x);\n  y = Math.round(y);\n  const enabledElement = external.cornerstone.getEnabledElement(element);\n  const storedPixelData = [];\n  let index = 0;\n  const pixelData = enabledElement.image.getPixelData();\n  let spIndex,\n    row,\n    column;\n\n  if (enabledElement.image.color) {\n    for (row = 0; row < height; row++) {\n      for (column = 0; column < width; column++) {\n        spIndex = (((row + y) * enabledElement.image.columns) + (column + x)) * 4;\n        const red = pixelData[spIndex];\n        const green = pixelData[spIndex + 1];\n        const blue = pixelData[spIndex + 2];\n        const alpha = pixelData[spIndex + 3];\n\n        storedPixelData[index++] = red;\n        storedPixelData[index++] = green;\n        storedPixelData[index++] = blue;\n        storedPixelData[index++] = alpha;\n      }\n    }\n  }\n\n  return storedPixelData;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./util/getRGBPixels.js","let coordsData;\n\nfunction setCoords (eventData) {\n  coordsData = eventData.currentPoints.canvas;\n}\n\nfunction getCoords () {\n  return coordsData;\n}\n\nconst toolCoordinates = {\n  setCoords,\n  getCoords\n};\n\nexport default toolCoordinates;\n\n\n\n// WEBPACK FOOTER //\n// ./stateManagement/toolCoordinates.js","import getHandleNearImagePoint from './getHandleNearImagePoint.js';\n\nfunction getActiveHandle (handles) {\n  let activeHandle;\n\n  Object.keys(handles).forEach(function (name) {\n    const handle = handles[name];\n\n    if (handle.active === true) {\n      activeHandle = handle;\n\n      return;\n    }\n  });\n\n  return activeHandle;\n}\n\nexport default function (element, handles, canvasPoint, distanceThreshold) {\n  if (!distanceThreshold) {\n    distanceThreshold = 6;\n  }\n\n  const activeHandle = getActiveHandle(handles);\n  const nearbyHandle = getHandleNearImagePoint(element, handles, canvasPoint, distanceThreshold);\n\n  if (activeHandle !== nearbyHandle) {\n    if (nearbyHandle !== undefined) {\n      nearbyHandle.active = true;\n    }\n\n    if (activeHandle !== undefined) {\n      activeHandle.active = false;\n    }\n\n    return true;\n  }\n\n  return false;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./manipulators/handleActivator.js","import EVENTS from '@/events.js';\nimport external from '@/externalModules.js';\nimport anyHandlesOutsideImage from './anyHandlesOutsideImage.js';\nimport { removeToolState } from '@/stateManagement/toolState.js';\nimport triggerEvent from '@/util/triggerEvent.js';\n\nexport default function (e, data, toolData, toolType, options, doneMovingCallback) {\n  const cornerstone = external.cornerstone;\n  const mouseEventData = e.detail;\n  const element = mouseEventData.element;\n\n  function mouseDragCallback (e) {\n    const eventData = e.detail;\n\n    data.active = true;\n\n    Object.keys(data.handles).forEach(function (name) {\n      const handle = data.handles[name];\n\n      if (handle.movesIndependently === true) {\n        return;\n      }\n\n      handle.x += eventData.deltaPoints.image.x;\n      handle.y += eventData.deltaPoints.image.y;\n\n      if (options.preventHandleOutsideImage === true) {\n        handle.x = Math.max(handle.x, 0);\n        handle.x = Math.min(handle.x, eventData.image.width);\n\n        handle.y = Math.max(handle.y, 0);\n        handle.y = Math.min(handle.y, eventData.image.height);\n      }\n    });\n\n    cornerstone.updateImage(element);\n\n    const eventType = EVENTS.MEASUREMENT_MODIFIED;\n    const modifiedEventData = {\n      toolType,\n      element,\n      measurementData: data\n    };\n\n    triggerEvent(element, eventType, modifiedEventData);\n\n    e.preventDefault();\n    e.stopPropagation();\n  }\n\n  element.addEventListener(EVENTS.MOUSE_DRAG, mouseDragCallback);\n\n  function mouseUpCallback (e) {\n    const eventData = e.detail;\n\n    data.invalidated = true;\n\n    element.removeEventListener(EVENTS.MOUSE_DRAG, mouseDragCallback);\n    element.removeEventListener(EVENTS.MOUSE_UP, mouseUpCallback);\n    element.removeEventListener(EVENTS.MOUSE_CLICK, mouseUpCallback);\n\n    // If any handle is outside the image, delete the tool data\n    if (options.deleteIfHandleOutsideImage === true &&\n            anyHandlesOutsideImage(eventData, data.handles)) {\n      removeToolState(element, toolType, data);\n    }\n\n    cornerstone.updateImage(element);\n\n    if (typeof doneMovingCallback === 'function') {\n      doneMovingCallback();\n    }\n  }\n\n  element.addEventListener(EVENTS.MOUSE_UP, mouseUpCallback);\n  element.addEventListener(EVENTS.MOUSE_CLICK, mouseUpCallback);\n\n  return true;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./manipulators/moveAllHandles.js","\nimport EVENTS from '@/events.js';\nimport external from '@/externalModules.js';\n\nexport default function (onImageRendered) {\n  let configuration = {};\n\n  return {\n    disable (element) {\n      element.removeEventListener(EVENTS.IMAGE_RENDERED, onImageRendered);\n    },\n    enable (element) {\n      element.removeEventListener(EVENTS.IMAGE_RENDERED, onImageRendered);\n      element.addEventListener(EVENTS.IMAGE_RENDERED, onImageRendered);\n      external.cornerstone.updateImage(element);\n    },\n    getConfiguration () {\n      return configuration;\n    },\n    setConfiguration (config) {\n      configuration = config;\n    }\n  };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./tools/image/displayTool.js","import getOrientationString from './getOrientationString.js';\nimport invertOrientationString from './invertOrientationString.js';\n\nconst orientation = {\n  getOrientationString,\n  invertOrientationString\n};\n\nexport default orientation;\n\n\n\n// WEBPACK FOOTER //\n// ./orientation/index.js","import external from '@/externalModules.js';\nimport convertToVector3 from '@/util/convertToVector3.js';\n\nexport default function (vector) {\n  const vec3 = convertToVector3(vector);\n\n  // Thanks to David Clunie\n  // https://sites.google.com/site/dicomnotes/\n\n  let orientation = '';\n  const orientationX = vec3.x < 0 ? 'R' : 'L';\n  const orientationY = vec3.y < 0 ? 'A' : 'P';\n  const orientationZ = vec3.z < 0 ? 'F' : 'H';\n\n  // Should probably make this a function vector3.abs\n  const abs = new external.cornerstoneMath.Vector3(Math.abs(vec3.x), Math.abs(vec3.y), Math.abs(vec3.z));\n\n  for (let i = 0; i < 3; i++) {\n    if (abs.x > 0.0001 && abs.x > abs.y && abs.x > abs.z) {\n      orientation += orientationX;\n      abs.x = 0;\n    } else if (abs.y > 0.0001 && abs.y > abs.x && abs.y > abs.z) {\n      orientation += orientationY;\n      abs.y = 0;\n    } else if (abs.z > 0.0001 && abs.z > abs.x && abs.z > abs.y) {\n      orientation += orientationZ;\n      abs.z = 0;\n    } else {\n      break;\n    }\n  }\n\n  return orientation;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./orientation/getOrientationString.js","export default function (string) {\n  let inverted = string.replace('H', 'f');\n\n  inverted = inverted.replace('F', 'h');\n  inverted = inverted.replace('R', 'l');\n  inverted = inverted.replace('L', 'r');\n  inverted = inverted.replace('A', 'p');\n  inverted = inverted.replace('P', 'a');\n  inverted = inverted.toUpperCase();\n\n  return inverted;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./orientation/invertOrientationString.js","import external from '@/externalModules.js';\n\nexport default function (element, x, y, width, height) {\n  if (!element) {\n    throw new Error('getLuminance: parameter element must not be undefined');\n  }\n\n  x = Math.round(x);\n  y = Math.round(y);\n  const enabledElement = external.cornerstone.getEnabledElement(element);\n  const image = enabledElement.image;\n  const luminance = [];\n  let index = 0;\n  const pixelData = image.getPixelData();\n  let spIndex,\n    row,\n    column;\n\n  if (image.color) {\n    for (row = 0; row < height; row++) {\n      for (column = 0; column < width; column++) {\n        spIndex = (((row + y) * image.columns) + (column + x)) * 4;\n        const red = pixelData[spIndex];\n        const green = pixelData[spIndex + 1];\n        const blue = pixelData[spIndex + 2];\n\n        luminance[index++] = 0.2126 * red + 0.7152 * green + 0.0722 * blue;\n      }\n    }\n  } else {\n    for (row = 0; row < height; row++) {\n      for (column = 0; column < width; column++) {\n        spIndex = ((row + y) * image.columns) + (column + x);\n        luminance[index++] = pixelData[spIndex] * image.slope + image.intercept;\n      }\n    }\n  }\n\n  return luminance;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./util/getLuminance.js","// http://stackoverflow.com/questions/2172798/how-to-draw-an-oval-in-html5-canvas\nexport default function (context, x, y, w, h) {\n  const kappa = 0.5522848,\n    ox = (w / 2) * kappa, // Control point offset horizontal\n    oy = (h / 2) * kappa, // Control point offset vertical\n    xe = x + w, // X-end\n    ye = y + h, // Y-end\n    xm = x + w / 2, // X-middle\n    ym = y + h / 2; // Y-middle\n\n  context.beginPath();\n  context.moveTo(x, ym);\n  context.bezierCurveTo(x, ym - oy, xm - ox, y, xm, y);\n  context.bezierCurveTo(xm + ox, y, xe, ym - oy, xe, ym);\n  context.bezierCurveTo(xe, ym + oy, xm + ox, ye, xm, ye);\n  context.bezierCurveTo(xm - ox, ye, x, ym + oy, x, ym);\n  context.closePath();\n  context.stroke();\n}\n\n\n\n// WEBPACK FOOTER //\n// ./util/drawEllipse.js","export default function (context, start, color, lineWidth) {\n  const handleRadius = 6;\n\n  context.beginPath();\n  context.strokeStyle = color;\n  context.lineWidth = lineWidth;\n  context.arc(start.x, start.y, handleRadius, 0, 2 * Math.PI);\n  context.stroke();\n}\n\n\n\n// WEBPACK FOOTER //\n// ./util/drawCircle.js","export default function (context, start, end, color, lineWidth) {\n  // Variables to be used when creating the arrow\n  const headLength = 10;\n\n  const angle = Math.atan2(end.y - start.y, end.x - start.x);\n\n  // Starting path of the arrow from the start square to the end square and drawing the stroke\n  context.beginPath();\n  context.moveTo(start.x, start.y);\n  context.lineTo(end.x, end.y);\n  context.strokeStyle = color;\n  context.lineWidth = lineWidth;\n  context.stroke();\n\n  // Starting a new path from the head of the arrow to one of the sides of the point\n  context.beginPath();\n  context.moveTo(end.x, end.y);\n  context.lineTo(end.x - headLength * Math.cos(angle - Math.PI / 7), end.y - headLength * Math.sin(angle - Math.PI / 7));\n\n  // Path from the side point of the arrow, to the other side point\n  context.lineTo(end.x - headLength * Math.cos(angle + Math.PI / 7), end.y - headLength * Math.sin(angle + Math.PI / 7));\n\n  // Path from the side point back to the tip of the arrow, and then again to the opposite side point\n  context.lineTo(end.x, end.y);\n  context.lineTo(end.x - headLength * Math.cos(angle - Math.PI / 7), end.y - headLength * Math.sin(angle - Math.PI / 7));\n\n  // Draws the paths created above\n  context.strokeStyle = color;\n  context.lineWidth = lineWidth;\n  context.stroke();\n  context.fillStyle = color;\n  context.fill();\n}\n\n\n\n// WEBPACK FOOTER //\n// ./util/drawArrow.js","import pointInEllipse from './pointInEllipse.js';\n\nexport default function (sp, ellipse) {\n  // TODO: Get a real statistics library here that supports large counts\n\n  let sum = 0;\n  let sumSquared = 0;\n  let count = 0;\n  let index = 0;\n\n  for (let y = ellipse.top; y < ellipse.top + ellipse.height; y++) {\n    for (let x = ellipse.left; x < ellipse.left + ellipse.width; x++) {\n      const point = {\n        x,\n        y\n      };\n\n      if (pointInEllipse(ellipse, point)) {\n        sum += sp[index];\n        sumSquared += sp[index] * sp[index];\n        count++;\n      }\n\n      index++;\n    }\n  }\n\n  if (count === 0) {\n    return {\n      count,\n      mean: 0.0,\n      variance: 0.0,\n      stdDev: 0.0\n    };\n  }\n\n  const mean = sum / count;\n  const variance = sumSquared / count - mean * mean;\n\n  return {\n    count,\n    mean,\n    variance,\n    stdDev: Math.sqrt(variance)\n  };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./util/calculateEllipseStatistics.js","import EVENTS from '@/events.js';\nimport external from '@/externalModules.js';\nimport anyHandlesOutsideImage from './anyHandlesOutsideImage.js';\nimport { removeToolState } from '@/stateManagement/toolState.js';\nimport triggerEvent from '@/util/triggerEvent.js';\n\nexport default function (event, data, toolData, toolType, deleteIfHandleOutsideImage, doneMovingCallback) {\n  const touchEventData = event.detail;\n  const element = touchEventData.element;\n  const cornerstone = external.cornerstone;\n\n  function touchDragCallback (e) {\n    const eventData = e.detail;\n\n    data.active = true;\n\n    Object.keys(data.handles).forEach(function (name) {\n      const handle = data.handles[name];\n\n      if (handle.movesIndependently === true) {\n        return;\n      }\n\n      handle.x += eventData.deltaPoints.image.x;\n      handle.y += eventData.deltaPoints.image.y;\n    });\n    cornerstone.updateImage(element);\n\n    const eventType = EVENTS.MEASUREMENT_MODIFIED;\n    const modifiedEventData = {\n      toolType,\n      element,\n      measurementData: data\n    };\n\n    triggerEvent(element, eventType, modifiedEventData);\n\n    e.preventDefault();\n    e.stopPropagation();\n  }\n\n  element.addEventListener(EVENTS.TOUCH_DRAG, touchDragCallback);\n\n  function touchEndCallback (e) {\n    const eventData = e.detail;\n\n    // Console.log('touchMoveAllHandles touchEndCallback: ' + e.type);\n    data.active = false;\n    data.invalidated = false;\n\n    element.removeEventListener(EVENTS.TOUCH_DRAG, touchDragCallback);\n\n    element.removeEventListener(EVENTS.TOUCH_PINCH, touchEndCallback);\n    element.removeEventListener(EVENTS.TOUCH_PRESS, touchEndCallback);\n    element.removeEventListener(EVENTS.TOUCH_END, touchEndCallback);\n    element.removeEventListener(EVENTS.TOUCH_DRAG_END, touchEndCallback);\n    element.removeEventListener(EVENTS.TAP, touchEndCallback);\n\n    // If any handle is outside the image, delete the tool data\n    const handlesOutsideImage = anyHandlesOutsideImage(eventData, data.handles);\n\n    if (deleteIfHandleOutsideImage === true && handlesOutsideImage === true) {\n      removeToolState(element, toolType, data);\n    }\n\n    cornerstone.updateImage(element);\n\n    if (typeof doneMovingCallback === 'function') {\n      doneMovingCallback(e);\n    }\n  }\n\n  element.addEventListener(EVENTS.TOUCH_PINCH, touchEndCallback);\n  element.addEventListener(EVENTS.TOUCH_PRESS, touchEndCallback);\n  element.addEventListener(EVENTS.TOUCH_END, touchEndCallback);\n  element.addEventListener(EVENTS.TOUCH_DRAG_END, touchEndCallback);\n  element.addEventListener(EVENTS.TAP, touchEndCallback);\n\n  return true;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./manipulators/touchMoveAllHandles.js","import EVENTS from '@/events.js';\nimport external from '@/externalModules.js';\nimport triggerEvent from '@/util/triggerEvent.js';\n\n/*\n * Define the runAnimation boolean as an object\n * so that it can be modified by reference\n */\nconst runAnimation = {\n  value: false\n};\n\nconst touchEndEvents = [\n  EVENTS.TOUCH_END,\n  EVENTS.TOUCH_DRAG_END,\n  EVENTS.TOUCH_PINCH,\n  EVENTS.TOUCH_PRESS,\n  EVENTS.TAP\n];\n\nfunction animate (lastTime, handle, runAnimation, enabledElement, targetLocation) {\n  // See http://www.html5canvastutorials.com/advanced/html5-canvas-start-and-stop-an-animation/\n  if (!runAnimation.value) {\n    return;\n  }\n\n  const cornerstone = external.cornerstone;\n  // Update\n  const time = (new Date()).getTime();\n  // Var timeDiff = time - lastTime;\n\n  // Pixels / second\n  const distanceRemaining = Math.abs(handle.y - targetLocation.y);\n  const linearDistEachFrame = distanceRemaining / 10;\n\n  if (distanceRemaining < 1) {\n    handle.y = targetLocation.y;\n    runAnimation.value = false;\n\n    return;\n  }\n\n  if (handle.y > targetLocation.y) {\n    handle.y -= linearDistEachFrame;\n  } else if (handle.y < targetLocation.y) {\n    handle.y += linearDistEachFrame;\n  }\n\n  // Update the image\n  cornerstone.updateImage(enabledElement.element);\n\n  // Request a new frame\n  cornerstone.requestAnimationFrame(function () {\n    animate(time, handle, runAnimation, enabledElement, targetLocation);\n  });\n}\n\nexport default function (event, toolType, data, handle, doneMovingCallback) {\n  // Console.log('touchMoveHandle');\n  runAnimation.value = true;\n\n  const touchEventData = event.detail;\n  const cornerstone = external.cornerstone;\n  const element = touchEventData.element;\n  const enabledElement = cornerstone.getEnabledElement(element);\n\n  const time = (new Date()).getTime();\n\n  // Average pixel width of index finger is 45-57 pixels\n  // https://www.smashingmagazine.com/2012/02/finger-friendly-design-ideal-mobile-touchscreen-target-sizes/\n  const fingerDistance = -57;\n\n  const aboveFinger = {\n    x: touchEventData.currentPoints.page.x,\n    y: touchEventData.currentPoints.page.y + fingerDistance\n  };\n\n  let targetLocation = cornerstone.pageToPixel(element, aboveFinger.x, aboveFinger.y);\n\n  function touchDragCallback (e) {\n    const eventData = e.detail;\n\n    // Console.log('touchMoveHandle touchDragCallback: ' + e.type);\n    runAnimation.value = false;\n\n    if (handle.hasMoved === false) {\n      handle.hasMoved = true;\n    }\n\n    handle.active = true;\n\n    const currentPoints = eventData.currentPoints;\n    const aboveFinger = {\n      x: currentPoints.page.x,\n      y: currentPoints.page.y + fingerDistance\n    };\n\n    targetLocation = cornerstone.pageToPixel(element, aboveFinger.x, aboveFinger.y);\n    handle.x = targetLocation.x;\n    handle.y = targetLocation.y;\n\n    cornerstone.updateImage(element);\n\n    const eventType = EVENTS.MEASUREMENT_MODIFIED;\n    const modifiedEventData = {\n      toolType,\n      element,\n      measurementData: data\n    };\n\n    triggerEvent(element, eventType, modifiedEventData);\n  }\n\n  element.addEventListener(EVENTS.TOUCH_DRAG, touchDragCallback);\n\n  function touchEndCallback (e) {\n    const eventData = e.detail;\n    // Console.log('touchMoveHandle touchEndCallback: ' + e.type);\n\n    runAnimation.value = false;\n\n    handle.active = false;\n    element.removeEventListener(EVENTS.TOUCH_DRAG, touchDragCallback);\n    touchEndEvents.forEach((eventType) => {\n      element.removeEventListener(eventType, touchEndCallback);\n    });\n\n    cornerstone.updateImage(element);\n\n    if (e.type === EVENTS.TOUCH_PRESS) {\n      eventData.handlePressed = data;\n\n      handle.x = touchEventData.currentPoints.image.x;\n      handle.y = touchEventData.currentPoints.image.y;\n    }\n\n    if (typeof doneMovingCallback === 'function') {\n      doneMovingCallback(e);\n    }\n  }\n\n  touchEndEvents.forEach((eventType) => {\n    element.addEventListener(eventType, touchEndCallback);\n  });\n\n  animate(time, handle, runAnimation, enabledElement, targetLocation);\n}\n\n\n\n// WEBPACK FOOTER //\n// ./manipulators/touchMoveHandle.js","import external from '@/externalModules.js';\nimport { getToolState } from '@/stateManagement/toolState.js';\nimport loadHandlerManager from '@/stateManagement/loadHandlerManager.js';\n\nexport default function (element, timePoints, wrap) {\n  const toolData = getToolState(element, 'timeSeries');\n\n  if (!toolData || !toolData.data || !toolData.data.length) {\n    return;\n  }\n\n  const cornerstone = external.cornerstone;\n  const timeSeriesData = toolData.data[0];\n  const currentStack = timeSeriesData.stacks[timeSeriesData.currentStackIndex];\n  const currentImageIdIndex = currentStack.currentImageIdIndex;\n  let newStackIndex = timeSeriesData.currentStackIndex + timePoints;\n\n  // Loop around if we go outside the stack\n  if (wrap) {\n    if (newStackIndex >= timeSeriesData.stacks.length) {\n      newStackIndex = 0;\n    }\n\n    if (newStackIndex < 0) {\n      newStackIndex = timeSeriesData.stacks.length - 1;\n    }\n  } else {\n    newStackIndex = Math.min(timeSeriesData.stacks.length - 1, newStackIndex);\n    newStackIndex = Math.max(0, newStackIndex);\n  }\n\n  if (newStackIndex !== timeSeriesData.currentStackIndex) {\n    const viewport = cornerstone.getViewport(element);\n    const newStack = timeSeriesData.stacks[newStackIndex];\n\n    const startLoadingHandler = loadHandlerManager.getStartLoadHandler();\n    const endLoadingHandler = loadHandlerManager.getEndLoadHandler();\n    const errorLoadingHandler = loadHandlerManager.getErrorLoadingHandler();\n\n    if (startLoadingHandler) {\n      startLoadingHandler(element);\n    }\n\n    let loader;\n\n    if (newStack.preventCache === true) {\n      loader = cornerstone.loadImage(newStack.imageIds[currentImageIdIndex]);\n    } else {\n      loader = cornerstone.loadAndCacheImage(newStack.imageIds[currentImageIdIndex]);\n    }\n\n    loader.then(function (image) {\n      if (timeSeriesData.currentImageIdIndex !== currentImageIdIndex) {\n        newStack.currentImageIdIndex = currentImageIdIndex;\n        timeSeriesData.currentStackIndex = newStackIndex;\n        cornerstone.displayImage(element, image, viewport);\n        if (endLoadingHandler) {\n          endLoadingHandler(element, image);\n        }\n      }\n    }, function (error) {\n      const imageId = newStack.imageIds[currentImageIdIndex];\n\n      if (errorLoadingHandler) {\n        errorLoadingHandler(element, imageId, error);\n      }\n    });\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./tools/timeSeries/incrementTimePoint.js","import EVENTS from '@/events.js';\nimport external from '@/externalModules.js';\nimport { getToolState, addToolState } from '@/stateManagement/toolState.js';\nimport { mouseButtonTool } from '@/tools/base/index.js';\nimport isMouseButtonEnabled from '@/util/isMouseButtonEnabled.js';\nimport { setToolOptions, getToolOptions } from '@/toolOptions.js';\n\nconst TOOL_STATE_TOOL_TYPE = 'brush';\nlet brushLayerId;\n\nexport default function brushTool (brushToolInterface) {\n  const toolType = brushToolInterface.toolType;\n\n  function mouseMoveCallback (e) {\n    brushToolInterface.onMouseMove(e);\n  }\n\n  function mouseUpCallback (e) {\n    const eventData = e.detail;\n    const element = eventData.element;\n\n    brushToolInterface.onMouseUp(e);\n\n    element.removeEventListener(EVENTS.MOUSE_DRAG, mouseMoveCallback);\n    element.removeEventListener(EVENTS.MOUSE_DRAG, dragCallback);\n    element.removeEventListener(EVENTS.MOUSE_UP, mouseUpCallback);\n    element.removeEventListener(EVENTS.MOUSE_CLICK, mouseUpCallback);\n  }\n\n  function dragCallback (e) {\n    brushToolInterface.onDrag(e);\n\n    return false;\n  }\n\n  function mouseDownActivateCallback (e) {\n    const eventData = e.detail;\n    const element = eventData.element;\n    const options = getToolOptions(toolType, element);\n\n    if (isMouseButtonEnabled(eventData.which, options.mouseButtonMask)) {\n      element.addEventListener(EVENTS.MOUSE_DRAG, dragCallback);\n      element.addEventListener(EVENTS.MOUSE_UP, mouseUpCallback);\n      element.addEventListener(EVENTS.MOUSE_CLICK, mouseUpCallback);\n      brushToolInterface.onMouseDown(e);\n\n      return false;\n    }\n\n    element.addEventListener(EVENTS.MOUSE_DRAG, mouseMoveCallback);\n    element.addEventListener(EVENTS.MOUSE_UP, mouseUpCallback);\n  }\n\n  function onImageRendered (e) {\n    const eventData = e.detail;\n    const element = eventData.element;\n    const toolData = getToolState(element, TOOL_STATE_TOOL_TYPE);\n    let pixelData;\n\n    if (toolData) {\n      pixelData = toolData.data[0].pixelData;\n    } else {\n      pixelData = new Uint8ClampedArray(eventData.image.width * eventData.image.height);\n      addToolState(element, TOOL_STATE_TOOL_TYPE, { pixelData });\n    }\n\n    const layer = external.cornerstone.getLayer(eventData.element, brushLayerId);\n\n    layer.image.setPixelData(pixelData);\n    layer.invalid = true;\n\n    external.cornerstone.updateImage(element);\n\n    brushToolInterface.onImageRendered(e);\n  }\n\n  function activate (element, mouseButtonMask) {\n    setToolOptions(toolType, element, { mouseButtonMask });\n\n    element.removeEventListener(EVENTS.IMAGE_RENDERED, onImageRendered);\n    element.addEventListener(EVENTS.IMAGE_RENDERED, onImageRendered);\n\n    element.removeEventListener(EVENTS.MOUSE_DOWN_ACTIVATE, mouseDownActivateCallback);\n    element.addEventListener(EVENTS.MOUSE_DOWN_ACTIVATE, mouseDownActivateCallback);\n\n    element.removeEventListener(EVENTS.MOUSE_MOVE, mouseMoveCallback);\n    element.addEventListener(EVENTS.MOUSE_MOVE, mouseMoveCallback);\n\n    const enabledElement = external.cornerstone.getEnabledElement(element);\n    const { width, height } = enabledElement.image;\n    let pixelData = new Uint8ClampedArray(width * height);\n\n    const configuration = brushTool.getConfiguration();\n    let colormapId = configuration.colormapId;\n\n    if (!colormapId) {\n      colormapId = 'BrushColorMap';\n\n      const colormap = external.cornerstone.colors.getColormap(colormapId);\n\n      colormap.setNumberOfColors(2);\n      colormap.setColor(0, [0, 0, 0, 0]);\n      colormap.setColor(1, [255, 0, 0, 255]);\n    }\n\n    const labelMapImage = {\n      minPixelValue: 0,\n      maxPixelValue: 1,\n      slope: 1.0,\n      intercept: 0,\n      getPixelData: () => pixelData,\n      rows: enabledElement.image.height,\n      columns: enabledElement.image.width,\n      height,\n      width,\n      pixelData,\n      setPixelData: (data) => {\n        pixelData = data;\n      },\n      colormap: colormapId,\n      color: false,\n      rgba: false,\n      labelmap: true,\n      invert: false,\n      columnPixelSpacing: 1.0,\n      rowPixelSpacing: 1.0,\n      sizeInBytes: enabledElement.image.width * enabledElement.image.height\n    };\n\n    let layer;\n    const options = {\n      viewport: {\n        pixelReplication: true\n      }\n    };\n\n    if (brushLayerId) {\n      layer = external.cornerstone.getLayer(element, brushLayerId);\n    }\n\n    if (!layer) {\n      brushLayerId = external.cornerstone.addLayer(element, labelMapImage, options);\n    }\n\n    addToolState(element, TOOL_STATE_TOOL_TYPE, { pixelData });\n\n    configuration.brushLayerId = brushLayerId;\n    brushTool.setConfiguration(configuration);\n\n    external.cornerstone.updateImage(element);\n  }\n\n  function deactivate (element) {\n    element.removeEventListener(EVENTS.IMAGE_RENDERED, onImageRendered);\n    element.removeEventListener(EVENTS.MOUSE_DOWN_ACTIVATE, mouseDownActivateCallback);\n    element.removeEventListener(EVENTS.MOUSE_MOVE, mouseMoveCallback);\n  }\n\n  const brushTool = mouseButtonTool({\n    mouseMoveCallback,\n    mouseDownActivateCallback,\n    onImageRendered,\n    deactivate\n  });\n\n  brushTool.activate = activate;\n\n  return brushTool;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./tools/painting/brushTool.js","export default function getCircle (radius, rows, columns, xCoord = 0, yCoord = 0) {\n  const x0 = Math.round(xCoord);\n  const y0 = Math.round(yCoord);\n\n  if (radius === 1) {\n    return [[x0, y0]];\n  }\n\n  const circleArray = [];\n  let index = 0;\n\n  for(let y = -radius; y <= radius; y++) {\n    const yCoord = y0 + y;\n\n    if (yCoord > rows || yCoord < 0) {\n      continue;\n    }\n\n    for(let x = -radius; x <= radius; x++) {\n      const xCoord = x0 + x;\n\n      if (xCoord > columns || xCoord < 0) {\n        continue;\n      }\n\n      if (x * x + y * y < radius * radius) {\n        circleArray[index++] = [x0 + x, y0 + y];\n      }\n    }\n  }\n\n  return circleArray;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./tools/painting/getCircle.js","import external from '@/externalModules.js';\n\nfunction drawBrushPixels (pointerArray, storedPixels, brushPixelValue, columns) {\n  const getPixelIndex = (x, y) => (y * columns) + x;\n\n  pointerArray.forEach((point) => {\n    const spIndex = getPixelIndex(point[0], point[1]);\n\n    storedPixels[spIndex] = brushPixelValue;\n  });\n}\n\nfunction drawBrushOnCanvas (pointerArray, canvasContext, color, element) {\n  const canvasPtTL = external.cornerstone.pixelToCanvas(element, { x: 0,\n    y: 0 });\n  const canvasPtBR = external.cornerstone.pixelToCanvas(element, { x: 1,\n    y: 1 });\n  const sizeX = canvasPtBR.x - canvasPtTL.x;\n  const sizeY = canvasPtBR.y - canvasPtTL.y;\n\n  canvasContext.save();\n  canvasContext.fillStyle = color;\n\n  pointerArray.forEach((point) => {\n    const canvasPt = external.cornerstone.pixelToCanvas(element, {\n      x: point[0],\n      y: point[1]\n    });\n\n    canvasContext.fillRect(canvasPt.x, canvasPt.y, sizeX, sizeY);\n  });\n\n  canvasContext.restore();\n}\n\nexport { drawBrushPixels, drawBrushOnCanvas };\n\n\n\n// WEBPACK FOOTER //\n// ./tools/painting/drawBrush.js","// Image Tools\nexport { angle, angleTouch } from '@tools/image/angleTool.js';\nexport { arrowAnnotate, arrowAnnotateTouch } from '@tools/image/arrowAnnotate.js';\nexport { crosshairs, crosshairsTouch } from '@tools/image/crosshairs.js';\nexport { default as displayTool } from '@tools/image/displayTool.js';\nexport { default as doubleTapZoom } from '@tools/image/doubleTapZoom.js';\nexport { dragProbe, dragProbeTouch } from '@tools/image/dragProbe.js';\nexport { ellipticalRoi, ellipticalRoiTouch } from '@tools/image/ellipticalRoi.js';\nexport { freehand } from '@tools/image/freehand.js';\nexport { highlight, highlightTouch } from '@tools/image/highlight.js';\nexport { default as imageStats } from '@tools/image/imageStats.js';\nexport { length, lengthTouch } from '@tools/image/length.js';\nexport { magnify, magnifyTouchDrag } from '@tools/image/magnify.js';\nexport { default as orientationMarkers } from '@tools/image/orientationMarkers.js';\nexport { pan, panTouchDrag } from '@tools/image/pan.js';\nexport { default as panMultiTouch } from '@tools/image/panMultiTouch.js';\nexport { probe, probeTouch } from '@tools/image/probe.js';\nexport { rectangleRoi, rectangleRoiTouch } from '@tools/image/rectangleRoi.js';\nexport { rotate, rotateTouchDrag } from '@tools/image/rotate.js';\nexport { default as rotateTouch } from '@tools/image/rotateTouch.js';\nexport { seedAnnotate, seedAnnotateTouch } from '@tools/image/seedAnnotate.js';\nexport { simpleAngle, simpleAngleTouch } from '@tools/image/simpleAngle.js';\nexport { textMarker, textMarkerTouch } from '@tools/image/textMarker.js';\nexport { wwwc, wwwcTouchDrag } from '@tools/image/wwwc.js';\nexport { wwwcRegion, wwwcRegionTouch } from '@tools/image/wwwcRegion.js';\nexport { zoom,\n  zoomWheel,\n  zoomTouchPinch,\n  zoomTouchDrag } from '@tools/image/zoom.js';\n\n// Stack Tools\nexport { playClip, stopClip } from '@tools/stack/playClip.js';\nexport { default as scrollIndicator } from '@tools/stack/scrollIndicator.js';\nexport { default as stackPrefetch } from '@tools/stack/stackPrefetch.js';\nexport { default as stackRenderers } from '@tools/stack/stackRenderers.js';\nexport { default as stackScrollKeyboard } from '@tools/stack/stackScrollKeyboard.js';\nexport { stackScroll,\n  stackScrollWheel,\n  stackScrollTouchDrag,\n  stackScrollMultiTouch } from '@tools/stack/stackScroll.js';\n\n// Time Series Tools\nexport { default as incrementTimePoint } from '@tools/timeSeries/incrementTimePoint.js';\nexport { default as probeTool4D } from '@tools/timeSeries/probeTool4D.js';\nexport { default as timeSeriesPlayer } from '@tools/timeSeries/timeSeriesPlayer.js';\nexport { timeSeriesScroll,\n  timeSeriesScrollWheel,\n  timeSeriesScrollTouchDrag } from '@tools/timeSeries/timeSeriesScroll.js';\n\n// Brush Tools\nexport { adaptiveBrush } from '@tools/painting/adaptiveBrush.js';\nexport { brush } from '@tools/painting/brush.js';\n\n\n/* eslint-disable */\n// Todo: Do we want the ability to import all tools as default\n//       or is import * as Tools good enough?\n// export default {\n//   // Brush Tools\n//   adaptiveBrush,\n//   brush,\n//   // Image Tools\n//   angle,\n//   angleTouch,\n//   arrowAnnotate,\n//   arrowAnnotateTouch,\n//   crosshairs,\n//   crosshairsTouch,\n//   displayTool,\n//   doubleTapZoom,\n//   dragProbe,\n//   dragProbeTouch,\n//   ellipticalRoi,\n//   ellipticalRoiTouch,\n//   freehand,\n//   highlight,\n//   highlightTouch,\n//   imageStats,\n//   length,\n//   lengthTouch,\n//   magnify,\n//   magnifyTouchDrag,\n//   orientationMarkers,\n//   pan,\n//   panTouchDrag,\n//   panMultiTouch,\n//   probe,\n//   probeTouch,\n//   rectangleRoi,\n//   rectangleRoiTouch,\n//   rotate,\n//   rotateTouch,\n//   rotateTouchDrag,\n//   seedAnnotate,\n//   seedAnnotateTouch,\n//   simpleAngle,\n//   simpleAngleTouch,\n//   textMarker,\n//   textMarkerTouch,\n//   wwwc,\n//   wwwcTouchDrag,\n//   wwwcRegion,\n//   wwwcRegionTouch,\n//   zoom,\n//   zoomWheel,\n//   zoomTouchPinch,\n//   zoomTouchDrag,\n//   // Stack Scroll\n//   playClip,\n//   scrollIndicator,\n//   stackPrefetch,\n//   stackRenderers,\n//   stackScroll,\n//   stackScrollKeyboard,\n//   stackScrollMultiTouch,\n//   stackScrollTouchDrag,\n//   stackScrollWheel,\n//   stopClip,\n//   // Time Series Tools\n//   incrementTimePoint,\n//   probeTool4D,\n//   timeSeriesPlayer,\n//   timeSeriesScroll,\n//   timeSeriesScrollWheel,\n//   timeSeriesScrollTouchDrag\n// };\n\n\n\n\n// WEBPACK FOOTER //\n// ./tools/index.js","import external from '@/externalModules.js';\nimport {\n  mouseButtonTool,\n  touchTool } from '@tools/base/index.js';\nimport drawTextBox from '@/util/drawTextBox.js';\nimport roundToDecimal from '@/util/roundToDecimal.js';\nimport toolStyle from '@/stateManagement/toolStyle.js';\nimport textStyle from '@/stateManagement/textStyle.js';\nimport toolColors from '@/stateManagement/toolColors.js';\nimport drawHandles from '@/manipulators/drawHandles.js';\nimport { getToolState } from '@/stateManagement/toolState.js';\n\nconst toolType = 'angle';\n\n// /////// BEGIN ACTIVE TOOL ///////\nfunction createNewMeasurement (mouseEventData) {\n  // Create the measurement data for this tool with the end handle activated\n  const angleData = {\n    visible: true,\n    active: true,\n    handles: {\n      start: {\n        x: mouseEventData.currentPoints.image.x - 20,\n        y: mouseEventData.currentPoints.image.y + 10,\n        highlight: true,\n        active: false\n      },\n      end: {\n        x: mouseEventData.currentPoints.image.x,\n        y: mouseEventData.currentPoints.image.y,\n        highlight: true,\n        active: true\n      },\n      start2: {\n        x: mouseEventData.currentPoints.image.x - 20,\n        y: mouseEventData.currentPoints.image.y + 10,\n        highlight: true,\n        active: false\n      },\n      end2: {\n        x: mouseEventData.currentPoints.image.x,\n        y: mouseEventData.currentPoints.image.y + 20,\n        highlight: true,\n        active: false\n      }\n    }\n  };\n\n  return angleData;\n}\n// /////// END ACTIVE TOOL ///////\n\nfunction pointNearTool (element, data, coords) {\n  const cornerstone = external.cornerstone;\n\n  const lineSegment = {\n    start: cornerstone.pixelToCanvas(element, data.handles.start),\n    end: cornerstone.pixelToCanvas(element, data.handles.end)\n  };\n\n  let distanceToPoint = external.cornerstoneMath.lineSegment.distanceToPoint(lineSegment, coords);\n\n  if (distanceToPoint < 5) {\n    return true;\n  }\n\n  lineSegment.start = cornerstone.pixelToCanvas(element, data.handles.start2);\n  lineSegment.end = cornerstone.pixelToCanvas(element, data.handles.end2);\n\n  distanceToPoint = external.cornerstoneMath.lineSegment.distanceToPoint(lineSegment, coords);\n\n  return (distanceToPoint < 5);\n}\n\n// /////// BEGIN IMAGE RENDERING ///////\nfunction onImageRendered (e) {\n  const eventData = e.detail;\n\n  // If we have no toolData for this element, return immediately as there is nothing to do\n  const toolData = getToolState(e.currentTarget, toolType);\n\n  if (toolData === undefined) {\n    return;\n  }\n\n  // We have tool data for this element - iterate over each one and draw it\n  const context = eventData.canvasContext.canvas.getContext('2d');\n\n  context.setTransform(1, 0, 0, 1, 0, 0);\n\n  // Activation color\n  let color;\n  const lineWidth = toolStyle.getToolWidth();\n  const font = textStyle.getFont();\n  const config = angle.getConfiguration();\n  const cornerstone = external.cornerstone;\n\n  for (let i = 0; i < toolData.data.length; i++) {\n    context.save();\n\n    // Configurable shadow\n    if (config && config.shadow) {\n      context.shadowColor = config.shadowColor || '#000000';\n      context.shadowOffsetX = config.shadowOffsetX || 1;\n      context.shadowOffsetY = config.shadowOffsetY || 1;\n    }\n\n    const data = toolData.data[i];\n\n    // Differentiate the color of activation tool\n    if (data.active) {\n      color = toolColors.getActiveColor();\n    } else {\n      color = toolColors.getToolColor();\n    }\n\n    // Draw the line\n    context.beginPath();\n    context.strokeStyle = color;\n    context.lineWidth = lineWidth;\n\n    let handleStartCanvas = cornerstone.pixelToCanvas(eventData.element, data.handles.start);\n    let handleEndCanvas = cornerstone.pixelToCanvas(eventData.element, data.handles.end);\n\n    context.moveTo(handleStartCanvas.x, handleStartCanvas.y);\n    context.lineTo(handleEndCanvas.x, handleEndCanvas.y);\n\n    handleStartCanvas = cornerstone.pixelToCanvas(eventData.element, data.handles.start2);\n    handleEndCanvas = cornerstone.pixelToCanvas(eventData.element, data.handles.end2);\n\n    context.moveTo(handleStartCanvas.x, handleStartCanvas.y);\n    context.lineTo(handleEndCanvas.x, handleEndCanvas.y);\n    context.stroke();\n\n    // Draw the handles\n    drawHandles(context, eventData, data.handles);\n\n    // Draw the text\n    context.fillStyle = color;\n\n    // Need to work on correct angle to measure.  This is a cobb angle and we need to determine\n    // Where lines cross to measure angle. For now it will show smallest angle.\n    const dx1 = (Math.ceil(data.handles.start.x) - Math.ceil(data.handles.end.x)) * eventData.image.columnPixelSpacing;\n    const dy1 = (Math.ceil(data.handles.start.y) - Math.ceil(data.handles.end.y)) * eventData.image.rowPixelSpacing;\n    const dx2 = (Math.ceil(data.handles.start2.x) - Math.ceil(data.handles.end2.x)) * eventData.image.columnPixelSpacing;\n    const dy2 = (Math.ceil(data.handles.start2.y) - Math.ceil(data.handles.end2.y)) * eventData.image.rowPixelSpacing;\n\n    let angle = Math.acos(Math.abs(((dx1 * dx2) + (dy1 * dy2)) / (Math.sqrt((dx1 * dx1) + (dy1 * dy1)) * Math.sqrt((dx2 * dx2) + (dy2 * dy2)))));\n\n    angle *= (180 / Math.PI);\n\n    const rAngle = roundToDecimal(angle, 2);\n    const str = '00B0'; // Degrees symbol\n    const text = rAngle.toString() + String.fromCharCode(parseInt(str, 16));\n\n    const textX = (handleStartCanvas.x + handleEndCanvas.x) / 2;\n    const textY = (handleStartCanvas.y + handleEndCanvas.y) / 2;\n\n    context.font = font;\n    drawTextBox(context, text, textX, textY, color);\n    context.restore();\n  }\n}\n// /////// END IMAGE RENDERING ///////\n\n// Module exports\nconst angle = mouseButtonTool({\n  createNewMeasurement,\n  onImageRendered,\n  pointNearTool,\n  toolType\n});\n\nconst angleTouch = touchTool({\n  createNewMeasurement,\n  onImageRendered,\n  pointNearTool,\n  toolType\n});\n\nexport {\n  angle,\n  angleTouch\n};\n\n\n\n// WEBPACK FOOTER //\n// ./tools/image/angleTool.js","import EVENTS from '@/events.js';\n\nexport default function (doubleTapCallback) {\n  return {\n    activate (element) {\n      element.removeEventListener(EVENTS.DOUBLE_TAP, doubleTapCallback);\n      element.addEventListener(EVENTS.DOUBLE_TAP, doubleTapCallback);\n    },\n    disable (element) {\n      element.removeEventListener(EVENTS.DOUBLE_TAP, doubleTapCallback);\n    },\n    enable (element) {\n      element.removeEventListener(EVENTS.DOUBLE_TAP, doubleTapCallback);\n    },\n    deactivate (element) {\n      element.removeEventListener(EVENTS.DOUBLE_TAP, doubleTapCallback);\n    }\n  };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./tools/base/doubleTapTool.js","import EVENTS from '@/events.js';\n\nexport default function (keyDownCallback) {\n  let configuration = {};\n\n  return {\n    activate (element) {\n      element.removeEventListener(EVENTS.KEY_DOWN, keyDownCallback);\n      element.addEventListener(EVENTS.KEY_DOWN, keyDownCallback);\n    },\n    disable (element) {\n      element.removeEventListener(EVENTS.KEY_DOWN, keyDownCallback);\n    },\n    enable (element) {\n      element.removeEventListener(EVENTS.KEY_DOWN, keyDownCallback);\n    },\n    deactivate (element) {\n      element.removeEventListener(EVENTS.KEY_DOWN, keyDownCallback);\n    },\n    getConfiguration () {\n      return configuration;\n    },\n    setConfiguration (config) {\n      configuration = config;\n    }\n  };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./tools/base/keyboardTool.js","import EVENTS from '@/events.js';\nimport external from '@/externalModules.js';\nimport toolCoordinates from '@/stateManagement/toolCoordinates.js';\nimport getHandleNearImagePoint from '@/manipulators/getHandleNearImagePoint.js';\nimport handleActivator from '@/manipulators/handleActivator.js';\nimport moveHandle from '@/manipulators/moveHandle.js';\nimport moveNewHandle from '@/manipulators/moveNewHandle.js';\nimport moveAllHandles from '@/manipulators/moveAllHandles.js';\nimport anyHandlesOutsideImage from '@/manipulators/anyHandlesOutsideImage.js';\nimport isMouseButtonEnabled from '@/util/isMouseButtonEnabled.js';\nimport { addToolState, removeToolState, getToolState } from '@/stateManagement/toolState.js';\nimport triggerEvent from '@/util/triggerEvent.js';\nimport { getToolOptions, setToolOptions } from '@/toolOptions.js';\n\nexport default function (mouseToolInterface) {\n  let configuration = {};\n  const toolType = mouseToolInterface.toolType;\n\n  function mouseDownActivateCallback (e) {\n    const eventData = e.detail;\n    const element = eventData.element;\n    const options = getToolOptions(toolType, element);\n\n    if (!isMouseButtonEnabled(eventData.which, options.mouseButtonMask)) {\n      return;\n    }\n\n    if (mouseToolInterface.addNewMeasurement) {\n      mouseToolInterface.addNewMeasurement(eventData);\n    } else {\n      addNewMeasurement(eventData);\n    }\n\n    e.preventDefault();\n    e.stopPropagation();\n  }\n\n  // /////// END ACTIVE TOOL ///////\n\n  // /////// BEGIN DEACTIVE TOOL ///////\n\n  function mouseMoveCallback (e) {\n    const eventData = e.detail;\n\n    toolCoordinates.setCoords(eventData);\n\n    // If we have no tool data for this element, do nothing\n    const toolData = getToolState(eventData.element, toolType);\n\n    if (!toolData) {\n      return;\n    }\n\n    // We have tool data, search through all data\n    // And see if we can activate a handle\n    let imageNeedsUpdate = false;\n\n    for (let i = 0; i < toolData.data.length; i++) {\n      // Get the cursor position in canvas coordinates\n      const coords = eventData.currentPoints.canvas;\n\n      const data = toolData.data[i];\n\n      if (handleActivator(eventData.element, data.handles, coords) === true) {\n        imageNeedsUpdate = true;\n      }\n\n      if ((mouseToolInterface.pointNearTool(eventData.element, data, coords) && !data.active) ||\n          (!mouseToolInterface.pointNearTool(eventData.element, data, coords) && data.active)) {\n        data.active = !data.active;\n        imageNeedsUpdate = true;\n      }\n    }\n\n    // Handle activation status changed, redraw the image\n    if (imageNeedsUpdate === true) {\n      external.cornerstone.updateImage(eventData.element);\n    }\n  }\n\n  function mouseDownCallback (e) {\n    const eventData = e.detail;\n    let data;\n    const element = eventData.element;\n    const options = getToolOptions(toolType, element);\n\n    if (!isMouseButtonEnabled(eventData.which, options.mouseButtonMask)) {\n      return;\n    }\n\n    function handleDoneMove () {\n      data.invalidated = true;\n      if (anyHandlesOutsideImage(eventData, data.handles)) {\n        // Delete the measurement\n        removeToolState(element, toolType, data);\n      }\n\n      external.cornerstone.updateImage(element);\n      element.addEventListener(EVENTS.MOUSE_MOVE, mouseMove);\n    }\n\n    const coords = eventData.startPoints.canvas;\n    const toolData = getToolState(e.currentTarget, toolType);\n\n    if (!toolData) {\n      return;\n    }\n\n    let i;\n\n    // Now check to see if there is a handle we can move\n\n    let preventHandleOutsideImage;\n\n    if (mouseToolInterface.options && mouseToolInterface.options.preventHandleOutsideImage !== undefined) {\n      preventHandleOutsideImage = mouseToolInterface.options.preventHandleOutsideImage;\n    } else {\n      preventHandleOutsideImage = false;\n    }\n\n    for (i = 0; i < toolData.data.length; i++) {\n      data = toolData.data[i];\n      const distance = 6;\n      const handle = getHandleNearImagePoint(element, data.handles, coords, distance);\n\n      if (handle) {\n        element.removeEventListener(EVENTS.MOUSE_MOVE, mouseMove);\n        data.active = true;\n        moveHandle(eventData, toolType, data, handle, handleDoneMove, preventHandleOutsideImage);\n        e.stopImmediatePropagation();\n        e.stopPropagation();\n        e.preventDefault();\n\n        return;\n      }\n    }\n\n    // Now check to see if there is a line we can move\n    // Now check to see if we have a tool that we can move\n    if (!mouseToolInterface.pointNearTool) {\n      return;\n    }\n\n    const opt = mouseToolInterface.options || {\n      deleteIfHandleOutsideImage: true,\n      preventHandleOutsideImage: false\n    };\n\n    for (i = 0; i < toolData.data.length; i++) {\n      data = toolData.data[i];\n      data.active = false;\n      if (mouseToolInterface.pointNearTool(element, data, coords)) {\n        data.active = true;\n        element.removeEventListener(EVENTS.MOUSE_MOVE, mouseMove);\n        moveAllHandles(e, data, toolData, toolType, opt, handleDoneMove);\n        e.stopImmediatePropagation();\n        e.stopPropagation();\n        e.preventDefault();\n\n        return;\n      }\n    }\n  }\n  // /////// END DEACTIVE TOOL ///////\n\n\n  const mouseMove = mouseToolInterface.mouseMoveCallback || mouseMoveCallback;\n  const mouseDown = mouseToolInterface.mouseDownCallback || mouseDownCallback;\n  const mouseDownActivate = mouseToolInterface.mouseDownActivateCallback || mouseDownActivateCallback;\n  const mouseDoubleClick = mouseToolInterface.mouseDoubleClickCallback;\n\n  // /////// BEGIN ACTIVE TOOL ///////\n  function addNewMeasurement (mouseEventData) {\n    const cornerstone = external.cornerstone;\n    const element = mouseEventData.element;\n\n    const measurementData = mouseToolInterface.createNewMeasurement(mouseEventData);\n\n    if (!measurementData) {\n      return;\n    }\n\n    // Associate this data with this imageId so we can render it and manipulate it\n    addToolState(mouseEventData.element, toolType, measurementData);\n\n    // Since we are dragging to another place to drop the end point, we can just activate\n    // The end point and let the moveHandle move it for us.\n    element.removeEventListener(EVENTS.MOUSE_MOVE, mouseMove);\n    element.removeEventListener(EVENTS.MOUSE_DOWN, mouseDown);\n    element.removeEventListener(EVENTS.MOUSE_DOWN_ACTIVATE, mouseDownActivate);\n\n    if (mouseDoubleClick) {\n      element.removeEventListener(EVENTS.MOUSE_DOUBLE_CLICK, mouseDoubleClick);\n    }\n\n    cornerstone.updateImage(element);\n\n    let handleMover;\n\n    if (Object.keys(measurementData.handles).length === 1) {\n      handleMover = moveHandle;\n    } else {\n      handleMover = moveNewHandle;\n    }\n\n    let preventHandleOutsideImage;\n\n    if (mouseToolInterface.options && mouseToolInterface.options.preventHandleOutsideImage !== undefined) {\n      preventHandleOutsideImage = mouseToolInterface.options.preventHandleOutsideImage;\n    } else {\n      preventHandleOutsideImage = false;\n    }\n\n    handleMover(mouseEventData, toolType, measurementData, measurementData.handles.end, function () {\n      measurementData.active = false;\n      measurementData.invalidated = true;\n      if (anyHandlesOutsideImage(mouseEventData, measurementData.handles)) {\n        // Delete the measurement\n        removeToolState(element, toolType, measurementData);\n      }\n\n      element.addEventListener(EVENTS.MOUSE_MOVE, mouseMove);\n      element.addEventListener(EVENTS.MOUSE_DOWN, mouseDown);\n      element.addEventListener(EVENTS.MOUSE_DOWN_ACTIVATE, mouseDownActivate);\n\n      if (mouseDoubleClick) {\n        element.addEventListener(EVENTS.MOUSE_DOUBLE_CLICK, mouseDoubleClick);\n      }\n\n      cornerstone.updateImage(element);\n    }, preventHandleOutsideImage);\n  }\n\n\n  // Not visible, not interactive\n  function disable (element) {\n    element.removeEventListener(EVENTS.IMAGE_RENDERED, mouseToolInterface.onImageRendered);\n    element.removeEventListener(EVENTS.MOUSE_MOVE, mouseMove);\n    element.removeEventListener(EVENTS.MOUSE_DOWN, mouseDown);\n    element.removeEventListener(EVENTS.MOUSE_DOWN_ACTIVATE, mouseDownActivate);\n\n    if (mouseDoubleClick) {\n      element.removeEventListener(EVENTS.MOUSE_DOUBLE_CLICK, mouseDoubleClick);\n    }\n\n    external.cornerstone.updateImage(element);\n  }\n\n  // Visible but not interactive\n  function enable (element) {\n    element.removeEventListener(EVENTS.IMAGE_RENDERED, mouseToolInterface.onImageRendered);\n    element.removeEventListener(EVENTS.MOUSE_MOVE, mouseMove);\n    element.removeEventListener(EVENTS.MOUSE_DOWN, mouseDown);\n    element.removeEventListener(EVENTS.MOUSE_DOWN_ACTIVATE, mouseDownActivate);\n\n    if (mouseDoubleClick) {\n      element.removeEventListener(EVENTS.MOUSE_DOUBLE_CLICK, mouseDoubleClick);\n    }\n\n    element.addEventListener(EVENTS.IMAGE_RENDERED, mouseToolInterface.onImageRendered);\n\n    external.cornerstone.updateImage(element);\n  }\n\n  // Visible, interactive and can create\n  function activate (element, mouseButtonMask) {\n    setToolOptions(toolType, element, { mouseButtonMask });\n\n    element.removeEventListener(EVENTS.IMAGE_RENDERED, mouseToolInterface.onImageRendered);\n    element.removeEventListener(EVENTS.MOUSE_MOVE, mouseMove);\n    element.removeEventListener(EVENTS.MOUSE_DOWN, mouseDown);\n    element.removeEventListener(EVENTS.MOUSE_DOWN_ACTIVATE, mouseDownActivate);\n\n    element.addEventListener(EVENTS.IMAGE_RENDERED, mouseToolInterface.onImageRendered);\n    element.addEventListener(EVENTS.MOUSE_MOVE, mouseMove);\n    element.addEventListener(EVENTS.MOUSE_DOWN, mouseDown);\n    element.addEventListener(EVENTS.MOUSE_DOWN_ACTIVATE, mouseDownActivate);\n\n    if (mouseDoubleClick) {\n      element.removeEventListener(EVENTS.MOUSE_DOUBLE_CLICK, mouseDoubleClick);\n      element.addEventListener(EVENTS.MOUSE_DOUBLE_CLICK, mouseDoubleClick);\n    }\n\n    external.cornerstone.updateImage(element);\n  }\n\n  // Visible, interactive\n  function deactivate (element, mouseButtonMask) {\n    setToolOptions(toolType, element, { mouseButtonMask });\n\n    const eventType = EVENTS.TOOL_DEACTIVATED;\n    const statusChangeEventData = {\n      mouseButtonMask,\n      toolType,\n      type: eventType\n    };\n\n    triggerEvent(element, eventType, statusChangeEventData);\n\n    element.removeEventListener(EVENTS.IMAGE_RENDERED, mouseToolInterface.onImageRendered);\n    element.removeEventListener(EVENTS.MOUSE_MOVE, mouseMove);\n    element.removeEventListener(EVENTS.MOUSE_DOWN, mouseDown);\n    element.removeEventListener(EVENTS.MOUSE_DOWN_ACTIVATE, mouseDownActivate);\n\n    element.addEventListener(EVENTS.IMAGE_RENDERED, mouseToolInterface.onImageRendered);\n    element.addEventListener(EVENTS.MOUSE_MOVE, mouseMove);\n    element.addEventListener(EVENTS.MOUSE_DOWN, mouseDown);\n\n    if (mouseDoubleClick) {\n      element.removeEventListener(EVENTS.MOUSE_DOUBLE_CLICK, mouseDoubleClick);\n      element.addEventListener(EVENTS.MOUSE_DOUBLE_CLICK, mouseDoubleClick);\n    }\n\n    if (mouseToolInterface.deactivate) {\n      mouseToolInterface.deactivate(element, mouseButtonMask);\n    }\n\n    external.cornerstone.updateImage(element);\n  }\n\n  function getConfiguration () {\n    return configuration;\n  }\n\n  function setConfiguration (config) {\n    configuration = config;\n  }\n\n  const toolInterface = {\n    enable,\n    disable,\n    activate,\n    deactivate,\n    getConfiguration,\n    setConfiguration,\n    mouseDownCallback,\n    mouseMoveCallback,\n    mouseDownActivateCallback\n  };\n\n  // Expose pointNearTool if available\n  if (mouseToolInterface.pointNearTool) {\n    toolInterface.pointNearTool = mouseToolInterface.pointNearTool;\n  }\n\n  if (mouseDoubleClick) {\n    toolInterface.mouseDoubleClickCallback = mouseDoubleClick;\n  }\n\n  if (mouseToolInterface.addNewMeasurement) {\n    toolInterface.addNewMeasurement = mouseToolInterface.addNewMeasurement;\n  }\n\n  return toolInterface;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./tools/base/mouseButtonTool.js","import EVENTS from '@/events.js';\nimport external from '@/externalModules.js';\nimport toolCoordinates from '@/stateManagement/toolCoordinates.js';\nimport getHandleNearImagePoint from '@/manipulators/getHandleNearImagePoint.js';\nimport handleActivator from '@/manipulators/handleActivator.js';\nimport moveHandle from '@/manipulators/moveHandle.js';\nimport moveAllHandles from '@/manipulators/moveAllHandles.js';\nimport anyHandlesOutsideImage from '@/manipulators/anyHandlesOutsideImage.js';\nimport isMouseButtonEnabled from '@/util/isMouseButtonEnabled.js';\nimport { addToolState, removeToolState, getToolState } from '@/stateManagement/toolState.js';\nimport { setToolOptions, getToolOptions } from '@/toolOptions.js';\n\nexport default function (mouseToolInterface, preventHandleOutsideImage) {\n  const toolType = mouseToolInterface.toolType;\n\n  // /////// BEGIN ACTIVE TOOL ///////\n  function addNewMeasurement (mouseEventData) {\n    const element = mouseEventData.element;\n    const measurementData = mouseToolInterface.createNewMeasurement(mouseEventData);\n\n    // Prevent adding new measurement if tool returns nill\n    if (!measurementData) {\n      return;\n    }\n\n    // Associate this data with this imageId so we can render it and manipulate it\n    addToolState(mouseEventData.element, toolType, measurementData);\n\n    // Since we are dragging to another place to drop the end point, we can just activate\n    // The end point and let the moveHandle move it for us.\n    element.removeEventListener(EVENTS.MOUSE_MOVE, mouseMoveCallback);\n    moveHandle(mouseEventData, toolType, measurementData, measurementData.handles.end, function () {\n      measurementData.active = false;\n      if (anyHandlesOutsideImage(mouseEventData, measurementData.handles)) {\n        // Delete the measurement\n        removeToolState(mouseEventData.element, toolType, measurementData);\n      }\n\n      element.addEventListener(EVENTS.MOUSE_MOVE, mouseMoveCallback);\n    }, preventHandleOutsideImage);\n  }\n\n  function mouseDownActivateCallback (e) {\n    const eventData = e.detail;\n    const element = eventData.element;\n    const options = getToolOptions(toolType, element);\n\n    if (isMouseButtonEnabled(eventData.which, options.mouseButtonMask)) {\n      addNewMeasurement(eventData);\n\n      return false;\n    }\n  }\n  // /////// END ACTIVE TOOL ///////\n\n  // /////// BEGIN DEACTIVE TOOL ///////\n\n  function mouseMoveCallback (e) {\n    const eventData = e.detail;\n\n    toolCoordinates.setCoords(eventData);\n\n    // If we have no tool data for this element, do nothing\n    const toolData = getToolState(eventData.element, toolType);\n\n    if (toolData === undefined) {\n      return;\n    }\n\n    // We have tool data, search through all data\n    // And see if we can activate a handle\n    let imageNeedsUpdate = false;\n    const coords = eventData.currentPoints.canvas;\n\n    for (let i = 0; i < toolData.data.length; i++) {\n      // Get the cursor position in image coordinates\n      const data = toolData.data[i];\n\n      if (handleActivator(eventData.element, data.handles, coords) === true) {\n        imageNeedsUpdate = true;\n      }\n\n      if ((mouseToolInterface.pointInsideRect(eventData.element, data, coords) && !data.active) || (!mouseToolInterface.pointInsideRect(eventData.element, data, coords) && data.active)) {\n        data.active = !data.active;\n        imageNeedsUpdate = true;\n      }\n    }\n\n    // Handle activation status changed, redraw the image\n    if (imageNeedsUpdate === true) {\n      external.cornerstone.updateImage(eventData.element);\n    }\n  }\n\n  function mouseDownCallback (e) {\n    const eventData = e.detail;\n    const element = eventData.element;\n    const cornerstone = external.cornerstone;\n    let data;\n    const options = getToolOptions(toolType, element);\n\n    if (!isMouseButtonEnabled(eventData.which, options.mouseButtonMask)) {\n      return;\n    }\n\n    function handleDoneMove () {\n      data.active = false;\n      if (anyHandlesOutsideImage(eventData, data.handles)) {\n        // Delete the measurement\n        removeToolState(eventData.element, toolType, data);\n      }\n\n      cornerstone.updateImage(eventData.element);\n      element.addEventListener(EVENTS.MOUSE_MOVE, mouseMoveCallback);\n    }\n\n    const coords = eventData.startPoints.canvas;\n    const toolData = getToolState(e.currentTarget, toolType);\n\n    let i;\n\n    // Now check to see if there is a handle we can move\n    const distanceSq = 25;\n\n    if (toolData !== undefined) {\n      for (i = 0; i < toolData.data.length; i++) {\n        data = toolData.data[i];\n        const handle = getHandleNearImagePoint(eventData.element, data.handles, coords, distanceSq);\n\n        if (handle !== undefined) {\n          element.removeEventListener(EVENTS.MOUSE_MOVE, mouseMoveCallback);\n          data.active = true;\n          moveHandle(eventData, toolType, data, handle, handleDoneMove, preventHandleOutsideImage);\n          e.stopImmediatePropagation();\n\n          return false;\n        }\n      }\n    }\n\n    // Now check to see if there is a line we can move\n    // Now check to see if we have a tool that we can move\n    const opt = {\n      deleteIfHandleOutsideImage: true,\n      preventHandleOutsideImage\n    };\n\n    if (toolData !== undefined && mouseToolInterface.pointInsideRect !== undefined) {\n      for (i = 0; i < toolData.data.length; i++) {\n        data = toolData.data[i];\n        if (mouseToolInterface.pointInsideRect(eventData.element, data, coords)) {\n          element.removeEventListener(EVENTS.MOUSE_MOVE, mouseMoveCallback);\n          moveAllHandles(e, data, toolData, toolType, opt, handleDoneMove);\n          element.addEventListener(EVENTS.MOUSE_MOVE, mouseMoveCallback);\n          e.stopImmediatePropagation();\n\n          return false;\n        }\n      }\n    }\n  }\n  // /////// END DEACTIVE TOOL ///////\n\n  // Not visible, not interactive\n  function disable (element) {\n    element.removeEventListener(EVENTS.IMAGE_RENDERED, mouseToolInterface.onImageRendered);\n    element.removeEventListener(EVENTS.MOUSE_MOVE, mouseMoveCallback);\n    element.removeEventListener(EVENTS.MOUSE_DOWN, mouseDownCallback);\n    element.removeEventListener(EVENTS.MOUSE_DOWN_ACTIVATE, mouseDownActivateCallback);\n\n    external.cornerstone.updateImage(element);\n  }\n\n  // Visible but not interactive\n  function enable (element) {\n    element.removeEventListener(EVENTS.IMAGE_RENDERED, mouseToolInterface.onImageRendered);\n    element.removeEventListener(EVENTS.MOUSE_MOVE, mouseMoveCallback);\n    element.removeEventListener(EVENTS.MOUSE_DOWN, mouseDownCallback);\n    element.removeEventListener(EVENTS.MOUSE_DOWN_ACTIVATE, mouseDownActivateCallback);\n\n    element.addEventListener(EVENTS.IMAGE_RENDERED, mouseToolInterface.onImageRendered);\n\n    external.cornerstone.updateImage(element);\n  }\n\n  // Visible, interactive and can create\n  function activate (element, mouseButtonMask) {\n    setToolOptions(toolType, element, { mouseButtonMask });\n\n    element.removeEventListener(EVENTS.IMAGE_RENDERED, mouseToolInterface.onImageRendered);\n    element.removeEventListener(EVENTS.MOUSE_MOVE, mouseMoveCallback);\n    element.removeEventListener(EVENTS.MOUSE_DOWN, mouseDownCallback);\n    element.removeEventListener(EVENTS.MOUSE_DOWN_ACTIVATE, mouseDownActivateCallback);\n\n    element.addEventListener(EVENTS.IMAGE_RENDERED, mouseToolInterface.onImageRendered);\n    element.addEventListener(EVENTS.MOUSE_MOVE, mouseMoveCallback);\n    element.addEventListener(EVENTS.MOUSE_DOWN, mouseDownCallback);\n    element.addEventListener(EVENTS.MOUSE_DOWN_ACTIVATE, mouseDownActivateCallback);\n\n    external.cornerstone.updateImage(element);\n  }\n\n  // Visible, interactive\n  function deactivate (element, mouseButtonMask) {\n    setToolOptions(toolType, element, { mouseButtonMask });\n\n    element.removeEventListener(EVENTS.IMAGE_RENDERED, mouseToolInterface.onImageRendered);\n    element.removeEventListener(EVENTS.MOUSE_MOVE, mouseMoveCallback);\n    element.removeEventListener(EVENTS.MOUSE_DOWN, mouseDownCallback);\n    element.removeEventListener(EVENTS.MOUSE_DOWN_ACTIVATE, mouseDownActivateCallback);\n\n    element.addEventListener(EVENTS.IMAGE_RENDERED, mouseToolInterface.onImageRendered);\n    element.addEventListener(EVENTS.MOUSE_MOVE, mouseMoveCallback);\n    element.addEventListener(EVENTS.MOUSE_DOWN, mouseDownCallback);\n\n    external.cornerstone.updateImage(element);\n  }\n\n  const toolInterface = {\n    enable,\n    disable,\n    activate,\n    deactivate\n  };\n\n  return toolInterface;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./tools/base/mouseButtonRectangleTool.js","import EVENTS from '@/events.js';\n\nexport default function (mouseWheelCallback) {\n  return {\n    activate (element) {\n      element.removeEventListener(EVENTS.MOUSE_WHEEL, mouseWheelCallback);\n      element.addEventListener(EVENTS.MOUSE_WHEEL, mouseWheelCallback);\n    },\n    disable (element) {\n      element.removeEventListener(EVENTS.MOUSE_WHEEL, mouseWheelCallback);\n    },\n    enable (element) {\n      element.removeEventListener(EVENTS.MOUSE_WHEEL, mouseWheelCallback);\n    },\n    deactivate (element) {\n      element.removeEventListener(EVENTS.MOUSE_WHEEL, mouseWheelCallback);\n    }\n  };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./tools/base/mouseWheelTool.js","import EVENTS from '@/events.js';\n\nexport default function (touchDragCallback, options) {\n  let configuration = {};\n  const events = [EVENTS.MULTI_TOUCH_DRAG];\n\n  if (options && options.fireOnTouchStart === true) {\n    events.push(EVENTS.MULTI_TOUCH_START);\n  }\n\n  return {\n    activate (element) {\n      events.forEach((eventType) => {\n        element.removeEventListener(eventType, touchDragCallback);\n        element.addEventListener(eventType, touchDragCallback);\n      });\n\n      if (options && options.activateCallback) {\n        options.activateCallback(element);\n      }\n    },\n    disable (element) {\n      events.forEach((eventType) => {\n        element.removeEventListener(eventType, touchDragCallback);\n      });\n\n      if (options && options.disableCallback) {\n        options.disableCallback(element);\n      }\n    },\n    enable (element) {\n      events.forEach((eventType) => {\n        element.removeEventListener(eventType, touchDragCallback);\n      });\n\n      if (options && options.enableCallback) {\n        options.enableCallback(element);\n      }\n    },\n    deactivate (element) {\n      events.forEach((eventType) => {\n        element.removeEventListener(eventType, touchDragCallback);\n      });\n\n      if (options && options.deactivateCallback) {\n        options.deactivateCallback(element);\n      }\n    },\n    getConfiguration () {\n      return configuration;\n    },\n    setConfiguration (config) {\n      configuration = config;\n    }\n  };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./tools/base/multiTouchDragTool.js","import EVENTS from '@/events.js';\nimport { setToolOptions } from '@/toolOptions.js';\n\nexport default function (mouseDownCallback, toolType) {\n  if (!toolType) {\n    throw new Error('simpleMouseButtonTool: toolType is required');\n  }\n\n  let configuration = {};\n\n  return {\n    activate (element, mouseButtonMask, options = {}) {\n      options.mouseButtonMask = mouseButtonMask;\n      setToolOptions(toolType, element, options);\n\n      element.removeEventListener(EVENTS.MOUSE_DOWN_ACTIVATE, mouseDownCallback);\n      element.addEventListener(EVENTS.MOUSE_DOWN_ACTIVATE, mouseDownCallback);\n    },\n    disable (element) {\n      element.removeEventListener(EVENTS.MOUSE_DOWN_ACTIVATE, mouseDownCallback);\n    },\n    enable (element) {\n      element.removeEventListener(EVENTS.MOUSE_DOWN_ACTIVATE, mouseDownCallback);\n    },\n    deactivate (element) {\n      element.removeEventListener(EVENTS.MOUSE_DOWN_ACTIVATE, mouseDownCallback);\n    },\n    getConfiguration () {\n      return configuration;\n    },\n    setConfiguration (config) {\n      configuration = config;\n    }\n  };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./tools/base/simpleMouseButtonTool.js","import EVENTS from '@/events.js';\nimport { setToolOptions } from '@/toolOptions.js';\n\nexport default function (touchDragCallback, toolType, options) {\n  const events = [EVENTS.TOUCH_DRAG];\n\n  if (options && options.fireOnTouchStart === true) {\n    events.push(EVENTS.TOUCH_START);\n  }\n\n  return {\n    activate (element) {\n      if (options && options.eventData) {\n        setToolOptions(toolType, element, options.eventData);\n      }\n\n      events.forEach((eventType) => {\n        element.removeEventListener(eventType, touchDragCallback);\n        element.addEventListener(eventType, touchDragCallback);\n      });\n\n      if (options && options.activateCallback) {\n        options.activateCallback(element);\n      }\n    },\n    disable (element) {\n      events.forEach((eventType) => {\n        element.removeEventListener(eventType, touchDragCallback);\n      });\n\n      if (options && options.disableCallback) {\n        options.disableCallback(element);\n      }\n    },\n    enable (element) {\n      events.forEach((eventType) => {\n        element.removeEventListener(eventType, touchDragCallback);\n      });\n\n      if (options && options.enableCallback) {\n        options.enableCallback(element);\n      }\n    },\n    deactivate (element) {\n      events.forEach((eventType) => {\n        element.removeEventListener(eventType, touchDragCallback);\n      });\n\n      if (options && options.deactivateCallback) {\n        options.deactivateCallback(element);\n      }\n    }\n  };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./tools/base/touchDragTool.js","import EVENTS from '@/events.js';\n\nexport default function (touchPinchCallback) {\n  return {\n    activate (element) {\n      element.removeEventListener(EVENTS.TOUCH_PINCH, touchPinchCallback);\n      element.addEventListener(EVENTS.TOUCH_PINCH, touchPinchCallback);\n    },\n    disable (element) {\n      element.removeEventListener(EVENTS.TOUCH_PINCH, touchPinchCallback);\n    },\n    enable (element) {\n      element.removeEventListener(EVENTS.TOUCH_PINCH, touchPinchCallback);\n    },\n    deactivate (element) {\n      element.removeEventListener(EVENTS.TOUCH_PINCH, touchPinchCallback);\n    }\n  };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./tools/base/touchPinchTool.js","import EVENTS from '@/events.js';\nimport external from '@/externalModules.js';\nimport anyHandlesOutsideImage from '@/manipulators/anyHandlesOutsideImage.js';\nimport getHandleNearImagePoint from '@/manipulators/getHandleNearImagePoint.js';\nimport touchMoveHandle from '@/manipulators/touchMoveHandle.js';\nimport moveNewHandleTouch from '@/manipulators/moveNewHandleTouch.js';\nimport touchMoveAllHandles from '@/manipulators/touchMoveAllHandles.js';\nimport { addToolState, removeToolState, getToolState } from '@/stateManagement/toolState.js';\nimport triggerEvent from '@/util/triggerEvent.js';\n\nfunction deactivateAllHandles (handles) {\n  Object.keys(handles).forEach(function (name) {\n    const handle = handles[name];\n\n    handle.active = false;\n  });\n}\n\nfunction deactivateAllToolInstances (toolData) {\n  if (!toolData) {\n    return;\n  }\n\n  for (let i = 0; i < toolData.data.length; i++) {\n    const data = toolData.data[i];\n\n    data.active = false;\n    if (!data.handles) {\n      continue;\n    }\n\n    deactivateAllHandles(data.handles);\n  }\n}\n\nfunction touchTool (touchToolInterface) {\n  // /////// BEGIN ACTIVE TOOL ///////\n  function addNewMeasurement (touchEventData) {\n    // Console.log('touchTool addNewMeasurement');\n    const cornerstone = external.cornerstone;\n    const element = touchEventData.element;\n\n    const measurementData = touchToolInterface.createNewMeasurement(touchEventData);\n\n    if (!measurementData) {\n      return;\n    }\n\n    addToolState(element, touchToolInterface.toolType, measurementData);\n\n    if (Object.keys(measurementData.handles).length === 1 && touchEventData.type === EVENTS.TAP) {\n      measurementData.active = false;\n      measurementData.handles.end.active = false;\n      measurementData.handles.end.highlight = false;\n      measurementData.invalidated = true;\n      if (anyHandlesOutsideImage(touchEventData, measurementData.handles)) {\n        // Delete the measurement\n        removeToolState(element, touchToolInterface.toolType, measurementData);\n      }\n\n      cornerstone.updateImage(element);\n\n      return;\n    }\n\n    element.removeEventListener(EVENTS.TOUCH_START_ACTIVE, touchToolInterface.touchDownActivateCallback || touchDownActivateCallback);\n    element.removeEventListener(EVENTS.TAP, touchToolInterface.tapCallback || tapCallback);\n    element.removeEventListener(EVENTS.TOUCH_START, touchToolInterface.touchStartCallback || touchStartCallback);\n\n    cornerstone.updateImage(element);\n    moveNewHandleTouch(touchEventData, touchToolInterface.toolType, measurementData, measurementData.handles.end, function () {\n      measurementData.active = false;\n      measurementData.invalidated = true;\n      if (anyHandlesOutsideImage(touchEventData, measurementData.handles)) {\n        // Delete the measurement\n        removeToolState(element, touchToolInterface.toolType, measurementData);\n      }\n\n      element.addEventListener(EVENTS.TOUCH_START_ACTIVE, touchToolInterface.touchDownActivateCallback || touchDownActivateCallback);\n      element.addEventListener(EVENTS.TAP, touchToolInterface.tapCallback || tapCallback);\n      element.addEventListener(EVENTS.TOUCH_START, touchToolInterface.touchStartCallback || touchStartCallback);\n      cornerstone.updateImage(element);\n    });\n  }\n\n  function touchDownActivateCallback (e) {\n    const eventData = e.detail;\n\n    // Console.log('touchTool touchDownActivateCallback');\n    if (touchToolInterface.addNewMeasurement) {\n      touchToolInterface.addNewMeasurement(eventData);\n    } else {\n      addNewMeasurement(eventData);\n    }\n\n    e.stopImmediatePropagation();\n    e.preventDefault();\n  }\n  // /////// END ACTIVE TOOL ///////\n\n  // /////// BEGIN INACTIVE TOOL ///////\n  function tapCallback (e) {\n    const eventData = e.detail;\n\n    // Console.log('touchTool tapCallback');\n    const cornerstone = external.cornerstone;\n    const element = eventData.element;\n    const coords = eventData.currentPoints.canvas;\n    const toolData = getToolState(e.currentTarget, touchToolInterface.toolType);\n    let data;\n    let i;\n\n    // Deactivate everything\n    deactivateAllToolInstances(toolData);\n\n    function doneMovingCallback () {\n      // Console.log('touchTool tapCallback doneMovingCallback');\n      deactivateAllToolInstances(toolData);\n      if (anyHandlesOutsideImage(eventData, data.handles)) {\n        // Delete the measurement\n        removeToolState(element, touchToolInterface.toolType, data);\n      }\n\n      cornerstone.updateImage(element);\n      element.addEventListener(EVENTS.TOUCH_START, touchToolInterface.touchStartCallback || touchStartCallback);\n      element.addEventListener(EVENTS.TAP, touchToolInterface.tapCallback || tapCallback);\n    }\n\n    // Now check to see if there is a handle we can move\n    if (toolData) {\n      for (i = 0; i < toolData.data.length; i++) {\n        data = toolData.data[i];\n        const distanceSq = 25; // Should probably make this a settable property later\n        const handle = getHandleNearImagePoint(element, data.handles, coords, distanceSq);\n\n        if (handle) {\n          element.removeEventListener(EVENTS.TOUCH_START, touchToolInterface.touchStartCallback || touchStartCallback);\n          element.removeEventListener(EVENTS.TAP, touchToolInterface.tapCallback || tapCallback);\n          data.active = true;\n          handle.active = true;\n          cornerstone.updateImage(element);\n          touchMoveHandle(e, touchToolInterface.toolType, data, handle, doneMovingCallback);\n          e.stopImmediatePropagation();\n          e.preventDefault();\n\n          return;\n        }\n      }\n    }\n\n    // Now check to see if we have a tool that we can move\n    if (toolData && touchToolInterface.pointNearTool) {\n      for (i = 0; i < toolData.data.length; i++) {\n        data = toolData.data[i];\n        if (touchToolInterface.pointNearTool(element, data, coords)) {\n          element.removeEventListener(EVENTS.TOUCH_START, touchToolInterface.touchStartCallback || touchStartCallback);\n          element.removeEventListener(EVENTS.TAP, touchToolInterface.tapCallback || tapCallback);\n          data.active = true;\n          cornerstone.updateImage(element);\n          touchMoveAllHandles(e, data, toolData, touchToolInterface.toolType, true, doneMovingCallback);\n          e.stopImmediatePropagation();\n          e.preventDefault();\n\n          return;\n        }\n      }\n    }\n\n    // If there is nothing to move, add a new instance of the tool\n    // Need to check here to see if activation is allowed!\n    if (touchToolInterface.touchDownActivateCallback) {\n      touchToolInterface.touchDownActivateCallback(e);\n    } else {\n      touchDownActivateCallback(e);\n    }\n\n    return false;\n  }\n\n  function touchStartCallback (e) {\n    const eventData = e.detail;\n\n    // Console.log('touchTool touchStartCallback');\n    const cornerstone = external.cornerstone;\n    const element = eventData.element;\n    const coords = eventData.startPoints.canvas;\n    let data;\n    const toolData = getToolState(e.currentTarget, touchToolInterface.toolType);\n    let i;\n\n    function doneMovingCallback (lastEvent, lastEventData) {\n      // Console.log('touchTool touchStartCallback doneMovingCallback');\n      data.active = false;\n      data.invalidated = true;\n      if (anyHandlesOutsideImage(eventData, data.handles)) {\n        // Delete the measurement\n        removeToolState(eventData.element, touchToolInterface.toolType, data);\n      }\n\n      cornerstone.updateImage(eventData.element);\n      element.addEventListener(EVENTS.TOUCH_START, touchToolInterface.touchStartCallback || touchStartCallback);\n      element.addEventListener(EVENTS.TAP, touchToolInterface.tapCallback || tapCallback);\n\n      if (touchToolInterface.pressCallback) {\n        element.addEventListener(EVENTS.TOUCH_PRESS, touchToolInterface.pressCallback);\n      }\n\n      if (lastEvent && lastEvent.type === EVENTS.TOUCH_PRESS) {\n        triggerEvent(element, lastEvent.type, lastEventData);\n      }\n    }\n\n    // Now check to see if there is a handle we can move\n\n    // Average pixel width of index finger is 45-57 pixels\n    // https://www.smashingmagazine.com/2012/02/finger-friendly-design-ideal-mobile-touchscreen-target-sizes/\n    const distance = 28;\n\n    if (!toolData) {\n      return;\n    }\n\n    for (i = 0; i < toolData.data.length; i++) {\n      data = toolData.data[i];\n\n      const handle = getHandleNearImagePoint(eventData.element, data.handles, coords, distance);\n\n      if (handle) {\n        element.removeEventListener(EVENTS.TOUCH_START, touchToolInterface.touchStartCallback || touchStartCallback);\n        element.removeEventListener(EVENTS.TAP, touchToolInterface.tapCallback || tapCallback);\n        if (touchToolInterface.pressCallback) {\n          element.removeEventListener(EVENTS.TOUCH_PRESS, touchToolInterface.pressCallback);\n        }\n\n        data.active = true;\n        touchMoveHandle(e, touchToolInterface.toolType, data, handle, doneMovingCallback);\n        e.stopImmediatePropagation();\n        e.preventDefault();\n        e.stopPropagation();\n\n        return;\n      }\n    }\n\n    // Now check to see if we have a tool that we can move\n    if (!touchToolInterface.pointNearTool) {\n      return;\n    }\n\n    for (i = 0; i < toolData.data.length; i++) {\n      data = toolData.data[i];\n\n      if (touchToolInterface.pointNearTool(eventData.element, data, coords)) {\n        element.removeEventListener(EVENTS.TOUCH_START, touchToolInterface.touchStartCallback || touchStartCallback);\n        element.removeEventListener(EVENTS.TAP, touchToolInterface.tapCallback || tapCallback);\n        if (touchToolInterface.pressCallback) {\n          element.removeEventListener(EVENTS.TOUCH_PRESS, touchToolInterface.pressCallback);\n        }\n\n        touchMoveAllHandles(e, data, toolData, touchToolInterface.toolType, true, doneMovingCallback);\n        e.stopImmediatePropagation();\n        e.preventDefault();\n        e.stopPropagation();\n\n        return;\n      }\n    }\n  }\n  // /////// END INACTIVE TOOL ///////\n\n  // Not visible, not interactive\n  function disable (element) {\n    element.removeEventListener(EVENTS.IMAGE_RENDERED, touchToolInterface.onImageRendered);\n    element.removeEventListener(EVENTS.TOUCH_START, touchToolInterface.touchStartCallback || touchStartCallback);\n    element.removeEventListener(EVENTS.TOUCH_START_ACTIVE, touchToolInterface.touchDownActivateCallback || touchDownActivateCallback);\n    element.removeEventListener(EVENTS.TAP, touchToolInterface.tapCallback || tapCallback);\n\n    if (touchToolInterface.doubleTapCallback) {\n      element.removeEventListener(EVENTS.DOUBLE_TAP, touchToolInterface.doubleTapCallback);\n    }\n\n    if (touchToolInterface.pressCallback) {\n      element.removeEventListener(EVENTS.TOUCH_PRESS, touchToolInterface.pressCallback);\n    }\n\n    external.cornerstone.updateImage(element);\n  }\n\n  // Visible but not interactive\n  function enable (element) {\n    element.removeEventListener(EVENTS.IMAGE_RENDERED, touchToolInterface.onImageRendered);\n    element.removeEventListener(EVENTS.TOUCH_START, touchToolInterface.touchStartCallback || touchStartCallback);\n    element.removeEventListener(EVENTS.TOUCH_START_ACTIVE, touchToolInterface.touchDownActivateCallback || touchDownActivateCallback);\n    element.removeEventListener(EVENTS.TAP, touchToolInterface.tapCallback || tapCallback);\n\n    element.addEventListener(EVENTS.IMAGE_RENDERED, touchToolInterface.onImageRendered);\n\n    if (touchToolInterface.doubleTapCallback) {\n      element.removeEventListener(EVENTS.DOUBLE_TAP, touchToolInterface.doubleTapCallback);\n    }\n\n    if (touchToolInterface.pressCallback) {\n      element.removeEventListener(EVENTS.TOUCH_PRESS, touchToolInterface.pressCallback);\n    }\n\n    external.cornerstone.updateImage(element);\n  }\n\n  // Visible, interactive and can create\n  function activate (element) {\n    element.removeEventListener(EVENTS.IMAGE_RENDERED, touchToolInterface.onImageRendered);\n    element.removeEventListener(EVENTS.TOUCH_START, touchToolInterface.touchStartCallback || touchStartCallback);\n    element.removeEventListener(EVENTS.TOUCH_START_ACTIVE, touchToolInterface.touchDownActivateCallback || touchDownActivateCallback);\n    element.removeEventListener(EVENTS.TAP, touchToolInterface.tapCallback || tapCallback);\n\n    element.addEventListener(EVENTS.IMAGE_RENDERED, touchToolInterface.onImageRendered);\n    element.addEventListener(EVENTS.TOUCH_START, touchToolInterface.touchStartCallback || touchStartCallback);\n    element.addEventListener(EVENTS.TOUCH_START_ACTIVE, touchToolInterface.touchDownActivateCallback || touchDownActivateCallback);\n    element.addEventListener(EVENTS.TAP, touchToolInterface.tapCallback || tapCallback);\n\n    if (touchToolInterface.doubleTapCallback) {\n      element.removeEventListener(EVENTS.DOUBLE_TAP, touchToolInterface.doubleTapCallback);\n      element.addEventListener(EVENTS.DOUBLE_TAP, touchToolInterface.doubleTapCallback);\n    }\n\n    if (touchToolInterface.pressCallback) {\n      element.removeEventListener(EVENTS.TOUCH_PRESS, touchToolInterface.pressCallback);\n      element.addEventListener(EVENTS.TOUCH_PRESS, touchToolInterface.pressCallback);\n    }\n\n    external.cornerstone.updateImage(element);\n  }\n\n  // Visible, interactive\n  function deactivate (element) {\n    const eventType = EVENTS.TOOL_DEACTIVATED;\n    const statusChangeEventData = {\n      toolType: touchToolInterface.toolType,\n      type: eventType\n    };\n\n    triggerEvent(element, eventType, statusChangeEventData);\n\n    element.removeEventListener(EVENTS.IMAGE_RENDERED, touchToolInterface.onImageRendered);\n    element.removeEventListener(EVENTS.TOUCH_START, touchToolInterface.touchStartCallback || touchStartCallback);\n    element.removeEventListener(EVENTS.TOUCH_START_ACTIVE, touchToolInterface.touchDownActivateCallback || touchDownActivateCallback);\n    element.removeEventListener(EVENTS.TAP, touchToolInterface.tapCallback || tapCallback);\n\n    element.addEventListener(EVENTS.IMAGE_RENDERED, touchToolInterface.onImageRendered);\n    element.addEventListener(EVENTS.TOUCH_START, touchToolInterface.touchStartCallback || touchStartCallback);\n\n    if (touchToolInterface.doubleTapCallback) {\n      element.removeEventListener(EVENTS.DOUBLE_TAP, touchToolInterface.doubleTapCallback);\n    }\n\n    if (touchToolInterface.pressCallback) {\n      element.removeEventListener(EVENTS.TOUCH_PRESS, touchToolInterface.pressCallback);\n    }\n\n    external.cornerstone.updateImage(element);\n  }\n\n  const toolInterface = {\n    enable,\n    disable,\n    activate,\n    deactivate,\n    touchStartCallback: touchToolInterface.touchStartCallback || touchStartCallback,\n    touchDownActivateCallback: touchToolInterface.touchDownActivateCallback || touchDownActivateCallback,\n    tapCallback: touchToolInterface.tapCallback || tapCallback\n  };\n\n    // Expose pointNearTool if available\n  if (touchToolInterface.pointNearTool) {\n    toolInterface.pointNearTool = touchToolInterface.pointNearTool;\n  }\n\n  if (touchToolInterface.doubleTapCallback) {\n    toolInterface.doubleTapCallback = touchToolInterface.doubleTapCallback;\n  }\n\n  if (touchToolInterface.pressCallback) {\n    toolInterface.pressCallback = touchToolInterface.pressCallback;\n  }\n\n  if (touchToolInterface.addNewMeasurement) {\n    toolInterface.addNewMeasurement = touchToolInterface.addNewMeasurement;\n  }\n\n  return toolInterface;\n}\n\nexport default touchTool;\n\n\n\n// WEBPACK FOOTER //\n// ./tools/base/touchTool.js","/* eslint no-alert:0 */\nimport EVENTS from '@/events.js';\nimport external from '@/externalModules.js';\nimport { mouseButtonTool, touchTool } from '@tools/base/index.js';\nimport drawTextBox from '@/util/drawTextBox.js';\nimport toolStyle from '@/stateManagement/toolStyle.js';\nimport textStyle from '@/stateManagement/textStyle.js';\nimport toolColors from '@/stateManagement/toolColors.js';\nimport drawHandles from '@/manipulators/drawHandles.js';\nimport drawArrow from '@/util/drawArrow.js';\nimport moveNewHandle from '@/manipulators/moveNewHandle.js';\nimport moveNewHandleTouch from '@/manipulators/moveNewHandleTouch.js';\nimport anyHandlesOutsideImage from '@/manipulators/anyHandlesOutsideImage.js';\nimport isMouseButtonEnabled from '@/util/isMouseButtonEnabled.js';\nimport pointInsideBoundingBox from '@/util/pointInsideBoundingBox.js';\nimport { addToolState, removeToolState, getToolState } from '@/stateManagement/toolState.js';\nimport { getToolOptions } from '@/toolOptions.js';\n\nconst toolType = 'arrowAnnotate';\n\n// Define a callback to get your text annotation\n// This could be used, e.g. to open a modal\nfunction getTextCallback (doneChangingTextCallback) {\n  doneChangingTextCallback(prompt('Enter your annotation:'));\n}\n\nfunction changeTextCallback (data, eventData, doneChangingTextCallback) {\n  doneChangingTextCallback(prompt('Change your annotation:'));\n}\n\nconst configuration = {\n  getTextCallback,\n  changeTextCallback,\n  drawHandles: false,\n  drawHandlesOnHover: true,\n  arrowFirst: true\n};\n\n// / --- Mouse Tool --- ///\n\n// /////// BEGIN ACTIVE TOOL ///////\nfunction addNewMeasurement (mouseEventData) {\n  const element = mouseEventData.element;\n  const measurementData = createNewMeasurement(mouseEventData);\n  const cornerstone = external.cornerstone;\n\n  function doneChangingTextCallback (text) {\n    if (text === null) {\n      removeToolState(element, toolType, measurementData);\n    } else {\n      measurementData.text = text;\n    }\n\n    measurementData.active = false;\n    cornerstone.updateImage(element);\n\n    element.addEventListener(EVENTS.MOUSE_MOVE, arrowAnnotate.mouseMoveCallback);\n    element.addEventListener(EVENTS.MOUSE_DOWN, arrowAnnotate.mouseDownCallback);\n    element.addEventListener(EVENTS.MOUSE_DOWN_ACTIVATE, arrowAnnotate.mouseDownActivateCallback);\n    element.addEventListener(EVENTS.MOUSE_DOUBLE_CLICK, arrowAnnotate.mouseDoubleClickCallback);\n  }\n\n  // Associate this data with this imageId so we can render it and manipulate it\n  addToolState(element, toolType, measurementData);\n\n  // Since we are dragging to another place to drop the end point, we can just activate\n  // The end point and let the moveHandle move it for us.\n  element.removeEventListener(EVENTS.MOUSE_MOVE, arrowAnnotate.mouseMoveCallback);\n  element.removeEventListener(EVENTS.MOUSE_DOWN, arrowAnnotate.mouseDownCallback);\n  element.removeEventListener(EVENTS.MOUSE_DOWN_ACTIVATE, arrowAnnotate.mouseDownActivateCallback);\n  element.removeEventListener(EVENTS.MOUSE_DOUBLE_CLICK, arrowAnnotate.mouseDoubleClickCallback);\n\n  cornerstone.updateImage(element);\n  moveNewHandle(mouseEventData, toolType, measurementData, measurementData.handles.end, function () {\n    if (anyHandlesOutsideImage(mouseEventData, measurementData.handles)) {\n      // Delete the measurement\n      removeToolState(element, toolType, measurementData);\n    }\n\n    const config = arrowAnnotate.getConfiguration();\n\n    if (measurementData.text === undefined) {\n      config.getTextCallback(doneChangingTextCallback);\n    }\n\n    cornerstone.updateImage(element);\n  });\n}\n\nfunction createNewMeasurement (eventData) {\n  // Create the measurement data for this tool with the end handle activated\n  const measurementData = {\n    visible: true,\n    active: true,\n    handles: {\n      start: {\n        x: eventData.currentPoints.image.x,\n        y: eventData.currentPoints.image.y,\n        highlight: true,\n        active: false\n      },\n      end: {\n        x: eventData.currentPoints.image.x,\n        y: eventData.currentPoints.image.y,\n        highlight: true,\n        active: false\n      },\n      textBox: {\n        active: false,\n        hasMoved: false,\n        movesIndependently: false,\n        drawnIndependently: true,\n        allowedOutsideImage: true,\n        hasBoundingBox: true\n      }\n    }\n  };\n\n  return measurementData;\n}\n// /////// END ACTIVE TOOL ///////\n\nfunction pointNearTool (element, data, coords) {\n  const cornerstone = external.cornerstone;\n\n  const lineSegment = {\n    start: cornerstone.pixelToCanvas(element, data.handles.start),\n    end: cornerstone.pixelToCanvas(element, data.handles.end)\n  };\n\n  const distanceToPoint = external.cornerstoneMath.lineSegment.distanceToPoint(lineSegment, coords);\n\n\n  return (distanceToPoint < 25);\n}\n\n// /////// BEGIN IMAGE RENDERING ///////\nfunction onImageRendered (e) {\n  const eventData = e.detail;\n\n  // If we have no toolData for this element, return immediately as there is nothing to do\n  const toolData = getToolState(e.currentTarget, toolType);\n\n  if (!toolData) {\n    return;\n  }\n\n  const enabledElement = eventData.enabledElement;\n  const cornerstone = external.cornerstone;\n\n  // We have tool data for this element - iterate over each one and draw it\n  const context = eventData.canvasContext.canvas.getContext('2d');\n\n  context.setTransform(1, 0, 0, 1, 0, 0);\n\n  let color;\n  const lineWidth = toolStyle.getToolWidth();\n  const font = textStyle.getFont();\n  const config = arrowAnnotate.getConfiguration();\n\n  for (let i = 0; i < toolData.data.length; i++) {\n    context.save();\n\n    if (config && config.shadow) {\n      context.shadowColor = config.shadowColor || '#000000';\n      context.shadowOffsetX = config.shadowOffsetX || 1;\n      context.shadowOffsetY = config.shadowOffsetY || 1;\n    }\n\n    const data = toolData.data[i];\n\n    if (data.active) {\n      color = toolColors.getActiveColor();\n    } else {\n      color = toolColors.getToolColor();\n    }\n\n    // Draw the arrow\n    const handleStartCanvas = cornerstone.pixelToCanvas(eventData.element, data.handles.start);\n    const handleEndCanvas = cornerstone.pixelToCanvas(eventData.element, data.handles.end);\n\n    // Config.arrowFirst = false;\n    if (config.arrowFirst) {\n      drawArrow(context, handleEndCanvas, handleStartCanvas, color, lineWidth);\n    } else {\n      drawArrow(context, handleStartCanvas, handleEndCanvas, color, lineWidth);\n    }\n\n    const handleOptions = {\n      drawHandlesIfActive: (config && config.drawHandlesOnHover)\n    };\n\n    if (config.drawHandles) {\n      drawHandles(context, eventData, data.handles, color, handleOptions);\n    }\n\n    // Draw the text\n    if (data.text && data.text !== '') {\n      context.font = font;\n\n      // Calculate the text coordinates.\n      const textWidth = context.measureText(data.text).width + 10;\n      const textHeight = textStyle.getFontSize() + 10;\n\n      let distance = Math.max(textWidth, textHeight) / 2 + 5;\n\n      if (handleEndCanvas.x < handleStartCanvas.x) {\n        distance = -distance;\n      }\n\n      let textCoords;\n\n      if (!data.handles.textBox.hasMoved) {\n        if (config.arrowFirst) {\n          textCoords = {\n            x: handleEndCanvas.x - textWidth / 2 + distance,\n            y: handleEndCanvas.y - textHeight / 2\n          };\n        } else {\n          // If the arrow is at the End position, the text should\n          // Be placed near the Start position\n          textCoords = {\n            x: handleStartCanvas.x - textWidth / 2 - distance,\n            y: handleStartCanvas.y - textHeight / 2\n          };\n        }\n\n        const transform = cornerstone.internal.getTransform(enabledElement);\n\n        transform.invert();\n\n        const coords = transform.transformPoint(textCoords.x, textCoords.y);\n\n        data.handles.textBox.x = coords.x;\n        data.handles.textBox.y = coords.y;\n      }\n\n      textCoords = cornerstone.pixelToCanvas(eventData.element, data.handles.textBox);\n\n      const boundingBox = drawTextBox(context, data.text, textCoords.x, textCoords.y, color);\n\n      data.handles.textBox.boundingBox = boundingBox;\n\n      if (data.handles.textBox.hasMoved) {\n        // Draw dashed link line between tool and text\n        const link = {\n          start: {},\n          end: {}\n        };\n\n        const midpointCanvas = {\n          x: (handleStartCanvas.x + handleEndCanvas.x) / 2,\n          y: (handleStartCanvas.y + handleEndCanvas.y) / 2\n        };\n\n        const points = [handleStartCanvas, handleEndCanvas, midpointCanvas];\n\n        link.end.x = textCoords.x;\n        link.end.y = textCoords.y;\n\n        link.start = external.cornerstoneMath.point.findClosestPoint(points, link.end);\n\n        const boundingBoxPoints = [{\n          // Top middle point of bounding box\n          x: boundingBox.left + boundingBox.width / 2,\n          y: boundingBox.top\n        }, {\n          // Left middle point of bounding box\n          x: boundingBox.left,\n          y: boundingBox.top + boundingBox.height / 2\n        }, {\n          // Bottom middle point of bounding box\n          x: boundingBox.left + boundingBox.width / 2,\n          y: boundingBox.top + boundingBox.height\n        }, {\n          // Right middle point of bounding box\n          x: boundingBox.left + boundingBox.width,\n          y: boundingBox.top + boundingBox.height / 2\n        }\n        ];\n\n        link.end = external.cornerstoneMath.point.findClosestPoint(boundingBoxPoints, link.start);\n\n        context.beginPath();\n        context.strokeStyle = color;\n        context.lineWidth = lineWidth;\n        context.setLineDash([2, 3]);\n        context.moveTo(link.start.x, link.start.y);\n        context.lineTo(link.end.x, link.end.y);\n        context.stroke();\n      }\n    }\n\n    context.restore();\n  }\n}\n// ---- Touch tool ----\n\n// /////// BEGIN ACTIVE TOOL ///////\nfunction addNewMeasurementTouch (touchEventData) {\n  const element = touchEventData.element;\n  const measurementData = createNewMeasurement(touchEventData);\n  const cornerstone = external.cornerstone;\n\n  function doneChangingTextCallback (text) {\n    if (text === null) {\n      removeToolState(element, toolType, measurementData);\n    } else {\n      measurementData.text = text;\n    }\n\n    measurementData.active = false;\n    cornerstone.updateImage(element);\n\n    element.addEventListener(EVENTS.TOUCH_PRESS, arrowAnnotateTouch.pressCallback);\n    element.addEventListener(EVENTS.TOUCH_START_ACTIVE, arrowAnnotateTouch.touchDownActivateCallback);\n    element.addEventListener(EVENTS.TAP, arrowAnnotateTouch.tapCallback);\n  }\n\n  addToolState(element, toolType, measurementData);\n  element.removeEventListener(EVENTS.TOUCH_PRESS, arrowAnnotateTouch.pressCallback);\n  element.removeEventListener(EVENTS.TOUCH_START_ACTIVE, arrowAnnotateTouch.touchDownActivateCallback);\n  element.removeEventListener(EVENTS.TAP, arrowAnnotateTouch.tapCallback);\n  cornerstone.updateImage(element);\n\n  moveNewHandleTouch(touchEventData, toolType, measurementData, measurementData.handles.end, function () {\n    cornerstone.updateImage(element);\n\n    if (anyHandlesOutsideImage(touchEventData, measurementData.handles)) {\n      // Delete the measurement\n      removeToolState(element, toolType, measurementData);\n    }\n\n    const config = arrowAnnotate.getConfiguration();\n\n    if (measurementData.text === undefined) {\n      config.getTextCallback(doneChangingTextCallback);\n    }\n  });\n}\n\nfunction doubleClickCallback (e) {\n  const eventData = e.detail;\n  const element = eventData.element;\n  const cornerstone = external.cornerstone;\n  const options = getToolOptions(toolType, element);\n  let data;\n\n  if (!isMouseButtonEnabled(eventData.which, options.mouseButtonMask)) {\n    return;\n  }\n\n  function doneChangingTextCallback (data, updatedText, deleteTool) {\n    if (deleteTool === true) {\n      removeToolState(element, toolType, data);\n    } else {\n      data.text = updatedText;\n    }\n\n    data.active = false;\n    cornerstone.updateImage(element);\n  }\n\n  const config = arrowAnnotate.getConfiguration();\n\n  const coords = eventData.currentPoints.canvas;\n  const toolData = getToolState(element, toolType);\n\n  // Now check to see if there is a handle we can move\n  if (!toolData) {\n    return;\n  }\n\n  for (let i = 0; i < toolData.data.length; i++) {\n    data = toolData.data[i];\n    if (pointNearTool(element, data, coords) ||\n            pointInsideBoundingBox(data.handles.textBox, coords)) {\n      data.active = true;\n      cornerstone.updateImage(element);\n      // Allow relabelling via a callback\n      config.changeTextCallback(data, eventData, doneChangingTextCallback);\n\n      e.stopImmediatePropagation();\n\n      return false;\n    }\n  }\n}\n\nfunction pressCallback (e) {\n  const eventData = e.detail;\n  const element = eventData.element;\n  const cornerstone = external.cornerstone;\n  let data;\n\n  function doneChangingTextCallback (data, updatedText, deleteTool) {\n    console.log('pressCallback doneChangingTextCallback');\n    if (deleteTool === true) {\n      removeToolState(element, toolType, data);\n    } else {\n      data.text = updatedText;\n    }\n\n    data.active = false;\n    cornerstone.updateImage(element);\n\n    element.addEventListener(EVENTS.TOUCH_START, arrowAnnotateTouch.touchStartCallback);\n    element.addEventListener(EVENTS.TOUCH_START_ACTIVE, arrowAnnotateTouch.touchDownActivateCallback);\n    element.addEventListener(EVENTS.TAP, arrowAnnotateTouch.tapCallback);\n  }\n\n  const config = arrowAnnotate.getConfiguration();\n\n  const coords = eventData.currentPoints.canvas;\n  const toolData = getToolState(element, toolType);\n\n  // Now check to see if there is a handle we can move\n  if (!toolData) {\n    return;\n  }\n\n  if (eventData.handlePressed) {\n    element.removeEventListener(EVENTS.TOUCH_START, arrowAnnotateTouch.touchStartCallback);\n    element.removeEventListener(EVENTS.TOUCH_START_ACTIVE, arrowAnnotateTouch.touchDownActivateCallback);\n    element.removeEventListener(EVENTS.TAP, arrowAnnotateTouch.tapCallback);\n\n    // Allow relabelling via a callback\n    config.changeTextCallback(eventData.handlePressed, eventData, doneChangingTextCallback);\n\n    e.stopImmediatePropagation();\n\n    return false;\n  }\n\n  for (let i = 0; i < toolData.data.length; i++) {\n    data = toolData.data[i];\n    if (pointNearTool(element, data, coords) ||\n            pointInsideBoundingBox(data.handles.textBox, coords)) {\n      data.active = true;\n      cornerstone.updateImage(element);\n\n      element.removeEventListener(EVENTS.TOUCH_START, arrowAnnotateTouch.touchStartCallback);\n      element.removeEventListener(EVENTS.TOUCH_START_ACTIVE, arrowAnnotateTouch.touchDownActivateCallback);\n      element.removeEventListener(EVENTS.TAP, arrowAnnotateTouch.tapCallback);\n\n      // Allow relabelling via a callback\n      config.changeTextCallback(data, eventData, doneChangingTextCallback);\n\n      e.stopImmediatePropagation();\n\n      return false;\n    }\n  }\n\n  e.preventDefault();\n  e.stopPropagation();\n}\n\nconst arrowAnnotate = mouseButtonTool({\n  addNewMeasurement,\n  createNewMeasurement,\n  onImageRendered,\n  pointNearTool,\n  toolType,\n  mouseDoubleClickCallback: doubleClickCallback\n});\n\narrowAnnotate.setConfiguration(configuration);\n\nconst arrowAnnotateTouch = touchTool({\n  addNewMeasurement: addNewMeasurementTouch,\n  createNewMeasurement,\n  onImageRendered,\n  pointNearTool,\n  toolType,\n  pressCallback\n});\n\nexport { arrowAnnotate, arrowAnnotateTouch };\n\n\n\n// WEBPACK FOOTER //\n// ./tools/image/arrowAnnotate.js","import EVENTS from '@/events.js';\nimport external from '@/externalModules.js';\nimport loadHandlerManager from '@/stateManagement/loadHandlerManager.js';\nimport { addToolState, getToolState, clearToolState } from '@/stateManagement/toolState.js';\nimport isMouseButtonEnabled from '@/util/isMouseButtonEnabled.js';\nimport { imagePointToPatientPoint } from '@/util/pointProjector.js';\nimport convertToVector3 from '@/util/convertToVector3.js';\nimport { setToolOptions, getToolOptions } from '@/toolOptions.js';\n\nconst toolType = 'crosshairs';\n\nfunction chooseLocation (e) {\n  const eventData = e.detail;\n\n  e.stopImmediatePropagation(); // Prevent CornerstoneToolsTouchStartActive from killing any press events\n\n  // If we have no toolData for this element, return immediately as there is nothing to do\n  const toolData = getToolState(e.currentTarget, toolType);\n\n  if (!toolData) {\n    return;\n  }\n\n  // Get current element target information\n  const cornerstone = external.cornerstone;\n  const sourceElement = e.currentTarget;\n  const sourceEnabledElement = cornerstone.getEnabledElement(sourceElement);\n  const sourceImageId = sourceEnabledElement.image.imageId;\n  const sourceImagePlane = cornerstone.metaData.get('imagePlaneModule', sourceImageId);\n\n  // Get currentPoints from mouse cursor on selected element\n  const sourceImagePoint = eventData.currentPoints.image;\n\n  // Transfer this to a patientPoint given imagePlane metadata\n  const patientPoint = imagePointToPatientPoint(sourceImagePoint, sourceImagePlane);\n\n  // Get the enabled elements associated with this synchronization context\n  const syncContext = toolData.data[0].synchronizationContext;\n  const enabledElements = syncContext.getSourceElements();\n\n  // Iterate over each synchronized element\n  enabledElements.forEach(function (targetElement) {\n    // Don't do anything if the target is the same as the source\n    if (targetElement === sourceElement) {\n      return;\n    }\n\n    let minDistance = Number.MAX_VALUE;\n    let newImageIdIndex = -1;\n\n    const stackToolDataSource = getToolState(targetElement, 'stack');\n\n    if (stackToolDataSource === undefined) {\n      return;\n    }\n\n    const stackData = stackToolDataSource.data[0];\n\n    // Find within the element's stack the closest image plane to selected location\n    stackData.imageIds.forEach(function (imageId, index) {\n      const imagePlane = cornerstone.metaData.get('imagePlaneModule', imageId);\n\n      // Skip if the image plane is not ready\n      if (!imagePlane || !imagePlane.imagePositionPatient || !imagePlane.rowCosines || !imagePlane.columnCosines) {\n        return;\n      }\n\n      const imagePosition = convertToVector3(imagePlane.imagePositionPatient);\n      const row = convertToVector3(imagePlane.rowCosines);\n      const column = convertToVector3(imagePlane.columnCosines);\n      const normal = column.clone().cross(row.clone());\n      const distance = Math.abs(normal.clone().dot(imagePosition) - normal.clone().dot(patientPoint));\n      // Console.log(index + '=' + distance);\n\n      if (distance < minDistance) {\n        minDistance = distance;\n        newImageIdIndex = index;\n      }\n    });\n\n    if (newImageIdIndex === stackData.currentImageIdIndex) {\n      return;\n    }\n\n    // Switch the loaded image to the required image\n    if (newImageIdIndex !== -1 && stackData.imageIds[newImageIdIndex] !== undefined) {\n      const startLoadingHandler = loadHandlerManager.getStartLoadHandler();\n      const endLoadingHandler = loadHandlerManager.getEndLoadHandler();\n      const errorLoadingHandler = loadHandlerManager.getErrorLoadingHandler();\n\n      if (startLoadingHandler) {\n        startLoadingHandler(targetElement);\n      }\n\n      let loader;\n\n      if (stackData.preventCache === true) {\n        loader = cornerstone.loadImage(stackData.imageIds[newImageIdIndex]);\n      } else {\n        loader = cornerstone.loadAndCacheImage(stackData.imageIds[newImageIdIndex]);\n      }\n\n      loader.then(function (image) {\n        const viewport = cornerstone.getViewport(targetElement);\n\n        stackData.currentImageIdIndex = newImageIdIndex;\n        cornerstone.displayImage(targetElement, image, viewport);\n        if (endLoadingHandler) {\n          endLoadingHandler(targetElement, image);\n        }\n      }, function (error) {\n        const imageId = stackData.imageIds[newImageIdIndex];\n\n        if (errorLoadingHandler) {\n          errorLoadingHandler(targetElement, imageId, error);\n        }\n      });\n    }\n  });\n}\n\nfunction mouseUpCallback (e) {\n  const eventData = e.detail;\n  const element = eventData.element;\n\n  element.removeEventListener(EVENTS.MOUSE_DRAG, mouseDragCallback);\n  element.removeEventListener(EVENTS.MOUSE_UP, mouseUpCallback);\n}\n\nfunction mouseDownCallback (e) {\n  const eventData = e.detail;\n  const element = eventData.element;\n  const options = getToolOptions(toolType, element);\n\n  if (isMouseButtonEnabled(eventData.which, options.mouseButtonMask)) {\n    element.addEventListener(EVENTS.MOUSE_DRAG, mouseDragCallback);\n    element.addEventListener(EVENTS.MOUSE_UP, mouseUpCallback);\n    chooseLocation(e);\n\n    e.preventDefault();\n    e.stopPropagation();\n  }\n}\n\nfunction mouseDragCallback (e) {\n  chooseLocation(e);\n\n  e.preventDefault();\n  e.stopPropagation();\n}\n\nfunction enable (element, mouseButtonMask, synchronizationContext) {\n  setToolOptions(toolType, element, { mouseButtonMask });\n\n  // Clear any currently existing toolData\n  clearToolState(element, toolType);\n\n  addToolState(element, toolType, {\n    synchronizationContext\n  });\n\n  element.removeEventListener(EVENTS.MOUSE_DOWN, mouseDownCallback);\n\n  element.addEventListener(EVENTS.MOUSE_DOWN, mouseDownCallback);\n}\n\n// Disables the reference line tool for the given element\nfunction disable (element) {\n  element.removeEventListener(EVENTS.MOUSE_DOWN, mouseDownCallback);\n}\n\n// Module/private exports\nconst crosshairs = {\n  activate: enable,\n  deactivate: disable,\n  enable,\n  disable\n};\n\nfunction dragEndCallback (e) {\n  const eventData = e.detail;\n  const element = eventData.element;\n\n  element.removeEventListener(EVENTS.TOUCH_DRAG, dragCallback);\n  element.removeEventListener(EVENTS.TOUCH_DRAG_END, dragEndCallback);\n}\n\nfunction dragStartCallback (e) {\n  const eventData = e.detail;\n  const element = eventData.element;\n\n  element.addEventListener(EVENTS.TOUCH_DRAG, dragCallback);\n  element.addEventListener(EVENTS.TOUCH_DRAG_END, dragEndCallback);\n  chooseLocation(e);\n\n  return false;\n}\n\nfunction dragCallback (e) {\n  chooseLocation(e);\n\n  e.preventDefault();\n  e.stopPropagation();\n}\n\nfunction enableTouch (element, synchronizationContext) {\n  // Clear any currently existing toolData\n  clearToolState(element, toolType);\n\n  addToolState(element, toolType, {\n    synchronizationContext\n  });\n\n  element.removeEventListener(EVENTS.TOUCH_START, dragStartCallback);\n\n  element.addEventListener(EVENTS.TOUCH_START, dragStartCallback);\n}\n\n// Disables the reference line tool for the given element\nfunction disableTouch (element) {\n  element.removeEventListener(EVENTS.TOUCH_START, dragStartCallback);\n}\n\nconst crosshairsTouch = {\n  activate: enableTouch,\n  deactivate: disableTouch,\n  enable: enableTouch,\n  disable: disableTouch\n};\n\nexport {\n  crosshairs,\n  crosshairsTouch\n};\n\n\n\n// WEBPACK FOOTER //\n// ./tools/image/crosshairs.js","import external from '@/externalModules.js';\nimport { doubleTapTool } from '@tools/base/index.js';\n\nfunction fitToWindowStrategy (eventData) {\n  external.cornerstone.fitToWindow(eventData.element);\n}\n\nfunction doubleTapCallback (e) {\n  const eventData = e.detail;\n\n  doubleTapZoom.strategy(eventData);\n\n  e.preventDefault();\n  e.stopPropagation();\n}\n\nconst doubleTapZoom = doubleTapTool(doubleTapCallback);\n\ndoubleTapZoom.strategies = {\n  default: fitToWindowStrategy\n};\n\ndoubleTapZoom.strategy = fitToWindowStrategy;\n\nexport default doubleTapZoom;\n\n\n\n// WEBPACK FOOTER //\n// ./tools/image/doubleTapZoom.js","import EVENTS from '@/events.js';\nimport external from '@/externalModules.js';\nimport { simpleMouseButtonTool, touchDragTool } from '@tools/base/index.js';\nimport textStyle from '@/stateManagement/textStyle.js';\nimport toolColors from '@/stateManagement/toolColors.js';\nimport drawTextBox from '@/util/drawTextBox.js';\nimport getRGBPixels from '@/util/getRGBPixels.js';\nimport calculateSUV from '@/util/calculateSUV.js';\nimport isMouseButtonEnabled from '@/util/isMouseButtonEnabled.js';\nimport { getToolOptions } from '@/toolOptions.js';\n\nconst toolType = 'dragProbe';\n\nlet dragEventData;\n\nfunction defaultStrategy (eventData) {\n  const cornerstone = external.cornerstone;\n  const enabledElement = cornerstone.getEnabledElement(eventData.element);\n\n  const context = enabledElement.canvas.getContext('2d');\n\n  context.setTransform(1, 0, 0, 1, 0, 0);\n\n  const color = toolColors.getActiveColor();\n  const font = textStyle.getFont();\n  const fontHeight = textStyle.getFontSize();\n  const config = dragProbe.getConfiguration();\n\n  context.save();\n\n  if (config && config.shadow) {\n    context.shadowColor = config.shadowColor || '#000000';\n    context.shadowOffsetX = config.shadowOffsetX || 1;\n    context.shadowOffsetY = config.shadowOffsetY || 1;\n  }\n\n  const x = Math.round(eventData.currentPoints.image.x);\n  const y = Math.round(eventData.currentPoints.image.y);\n\n  let storedPixels;\n  let text,\n    str;\n\n  if (x < 0 || y < 0 || x >= eventData.image.columns || y >= eventData.image.rows) {\n    return;\n  }\n\n  if (eventData.image.color) {\n    storedPixels = getRGBPixels(eventData.element, x, y, 1, 1);\n    text = `${x}, ${y}`;\n    str = `R: ${storedPixels[0]} G: ${storedPixels[1]} B: ${storedPixels[2]} A: ${storedPixels[3]}`;\n  } else {\n    storedPixels = cornerstone.getStoredPixels(eventData.element, x, y, 1, 1);\n    const sp = storedPixels[0];\n    const mo = sp * eventData.image.slope + eventData.image.intercept;\n    const suv = calculateSUV(eventData.image, sp);\n\n    // Draw text\n    text = `${x}, ${y}`;\n    str = `SP: ${sp} MO: ${parseFloat(mo.toFixed(3))}`;\n    if (suv) {\n      str += ` SUV: ${parseFloat(suv.toFixed(3))}`;\n    }\n  }\n\n  // Draw text\n  const coords = {\n    // Translate the x/y away from the cursor\n    x: eventData.currentPoints.image.x + 3,\n    y: eventData.currentPoints.image.y - 3\n  };\n  const textCoords = cornerstone.pixelToCanvas(eventData.element, coords);\n\n  context.font = font;\n  context.fillStyle = color;\n\n  drawTextBox(context, str, textCoords.x, textCoords.y + fontHeight + 5, color);\n  drawTextBox(context, text, textCoords.x, textCoords.y, color);\n  context.restore();\n}\n\nfunction minimalStrategy (eventData) {\n  const cornerstone = external.cornerstone;\n  const element = eventData.element;\n  const enabledElement = cornerstone.getEnabledElement(element);\n  const image = enabledElement.image;\n\n  const context = enabledElement.canvas.getContext('2d');\n\n  context.setTransform(1, 0, 0, 1, 0, 0);\n\n  const color = toolColors.getActiveColor();\n  const font = textStyle.getFont();\n  const config = dragProbe.getConfiguration();\n\n  context.save();\n\n  if (config && config.shadow) {\n    context.shadowColor = config.shadowColor || '#000000';\n    context.shadowOffsetX = config.shadowOffsetX || 1;\n    context.shadowOffsetY = config.shadowOffsetY || 1;\n  }\n\n  const seriesModule = cornerstone.metaData.get('generalSeriesModule', image.imageId);\n  let modality;\n\n  if (seriesModule) {\n    modality = seriesModule.modality;\n  }\n\n  let toolCoords;\n\n  if (eventData.isTouchEvent === true) {\n    toolCoords = cornerstone.pageToPixel(element, eventData.currentPoints.page.x,\n      eventData.currentPoints.page.y - textStyle.getFontSize() * 4);\n  } else {\n    toolCoords = cornerstone.pageToPixel(element, eventData.currentPoints.page.x,\n      eventData.currentPoints.page.y - textStyle.getFontSize() / 2);\n  }\n\n  let storedPixels;\n  let text = '';\n\n  if (toolCoords.x < 0 || toolCoords.y < 0 ||\n        toolCoords.x >= image.columns || toolCoords.y >= image.rows) {\n    return;\n  }\n\n  if (image.color) {\n    storedPixels = getRGBPixels(element, toolCoords.x, toolCoords.y, 1, 1);\n    text = `R: ${storedPixels[0]} G: ${storedPixels[1]} B: ${storedPixels[2]}`;\n  } else {\n    storedPixels = cornerstone.getStoredPixels(element, toolCoords.x, toolCoords.y, 1, 1);\n    const sp = storedPixels[0];\n    const mo = sp * eventData.image.slope + eventData.image.intercept;\n\n    const modalityPixelValueText = parseFloat(mo.toFixed(2));\n\n    if (modality === 'CT') {\n      text += `HU: ${modalityPixelValueText}`;\n    } else if (modality === 'PT') {\n      text += modalityPixelValueText;\n      const suv = calculateSUV(eventData.image, sp);\n\n      if (suv) {\n        text += ` SUV: ${parseFloat(suv.toFixed(2))}`;\n      }\n    } else {\n      text += modalityPixelValueText;\n    }\n  }\n\n  // Prepare text\n  const textCoords = cornerstone.pixelToCanvas(element, toolCoords);\n\n  context.font = font;\n  context.fillStyle = color;\n\n  // Translate the x/y away from the cursor\n  let translation;\n  const handleRadius = 6;\n  const width = context.measureText(text).width;\n\n  if (eventData.isTouchEvent === true) {\n    translation = {\n      x: -width / 2 - 5,\n      y: -textStyle.getFontSize() - 10 - 2 * handleRadius\n    };\n  } else {\n    translation = {\n      x: 12,\n      y: -(textStyle.getFontSize() + 10) / 2\n    };\n  }\n\n  context.beginPath();\n  context.strokeStyle = color;\n  context.arc(textCoords.x, textCoords.y, handleRadius, 0, 2 * Math.PI);\n  context.stroke();\n\n  drawTextBox(context, text, textCoords.x + translation.x, textCoords.y + translation.y, color);\n  context.restore();\n}\n\nfunction mouseUpCallback (e) {\n  const eventData = e.detail;\n  const element = eventData.element;\n\n  element.removeEventListener(EVENTS.IMAGE_RENDERED, imageRenderedCallback);\n  element.removeEventListener(EVENTS.MOUSE_DRAG, dragCallback);\n  element.removeEventListener(EVENTS.MOUSE_UP, mouseUpCallback);\n  element.removeEventListener(EVENTS.MOUSE_CLICK, mouseUpCallback);\n  external.cornerstone.updateImage(eventData.element);\n}\n\nfunction mouseDownCallback (e) {\n  const eventData = e.detail;\n  const element = eventData.element;\n  const options = getToolOptions(toolType, element);\n\n  if (isMouseButtonEnabled(eventData.which, options.mouseButtonMask)) {\n    element.addEventListener(EVENTS.IMAGE_RENDERED, imageRenderedCallback);\n    element.addEventListener(EVENTS.MOUSE_DRAG, dragCallback);\n    element.addEventListener(EVENTS.MOUSE_UP, mouseUpCallback);\n    element.addEventListener(EVENTS.MOUSE_CLICK, mouseUpCallback);\n    dragProbe.strategy(eventData);\n\n    e.preventDefault();\n    e.stopPropagation();\n  }\n}\n\nfunction imageRenderedCallback () {\n  if (dragEventData) {\n    dragProbe.strategy(dragEventData);\n    dragEventData = null;\n  }\n}\n\n// The strategy can't be execute at this moment because the image is rendered asynchronously\n// (requestAnimationFrame). Then the eventData that contains all information needed is being\n// Cached and the strategy will be executed once cornerstoneimagerendered is triggered.\nfunction dragCallback (e) {\n  const eventData = e.detail;\n  const element = eventData.element;\n\n  dragEventData = eventData;\n  external.cornerstone.updateImage(element);\n\n  e.preventDefault();\n  e.stopPropagation();\n}\n\nconst dragProbe = simpleMouseButtonTool(mouseDownCallback, toolType);\n\ndragProbe.strategies = {\n  default: defaultStrategy,\n  minimal: minimalStrategy\n};\n\ndragProbe.strategy = defaultStrategy;\n\nconst options = {\n  fireOnTouchStart: true\n};\n\nconst dragProbeTouch = touchDragTool(dragCallback, toolType, options);\n\nexport {\n  dragProbe,\n  dragProbeTouch\n};\n\n\n\n// WEBPACK FOOTER //\n// ./tools/image/dragProbe.js","import external from '@/externalModules.js';\nimport { mouseButtonTool, touchTool } from '@tools/base/index.js';\nimport toolStyle from '@/stateManagement/toolStyle.js';\nimport toolColors from '@/stateManagement/toolColors.js';\nimport drawHandles from '@/manipulators/drawHandles.js';\nimport drawTextBox from '@/util/drawTextBox.js';\nimport drawEllipse from '@/util/drawEllipse.js';\nimport pointInEllipse from '@/util/pointInEllipse.js';\nimport calculateEllipseStatistics from '@/util/calculateEllipseStatistics.js';\nimport calculateSUV from '@/util/calculateSUV.js';\nimport { getToolState } from '@/stateManagement/toolState.js';\n\nconst toolType = 'ellipticalRoi';\n\n// /////// BEGIN ACTIVE TOOL ///////\nfunction createNewMeasurement (mouseEventData) {\n  // Create the measurement data for this tool with the end handle activated\n  const measurementData = {\n    visible: true,\n    active: true,\n    invalidated: true,\n    handles: {\n      start: {\n        x: mouseEventData.currentPoints.image.x,\n        y: mouseEventData.currentPoints.image.y,\n        highlight: true,\n        active: false\n      },\n      end: {\n        x: mouseEventData.currentPoints.image.x,\n        y: mouseEventData.currentPoints.image.y,\n        highlight: true,\n        active: true\n      },\n      textBox: {\n        active: false,\n        hasMoved: false,\n        movesIndependently: false,\n        drawnIndependently: true,\n        allowedOutsideImage: true,\n        hasBoundingBox: true\n      }\n    }\n  };\n\n  return measurementData;\n}\n// /////// END ACTIVE TOOL ///////\n\n// /////// BEGIN IMAGE RENDERING ///////\nfunction pointNearEllipse (element, data, coords, distance) {\n  const cornerstone = external.cornerstone;\n  const startCanvas = cornerstone.pixelToCanvas(element, data.handles.start);\n  const endCanvas = cornerstone.pixelToCanvas(element, data.handles.end);\n\n  const minorEllipse = {\n    left: Math.min(startCanvas.x, endCanvas.x) + distance / 2,\n    top: Math.min(startCanvas.y, endCanvas.y) + distance / 2,\n    width: Math.abs(startCanvas.x - endCanvas.x) - distance,\n    height: Math.abs(startCanvas.y - endCanvas.y) - distance\n  };\n\n  const majorEllipse = {\n    left: Math.min(startCanvas.x, endCanvas.x) - distance / 2,\n    top: Math.min(startCanvas.y, endCanvas.y) - distance / 2,\n    width: Math.abs(startCanvas.x - endCanvas.x) + distance,\n    height: Math.abs(startCanvas.y - endCanvas.y) + distance\n  };\n\n  const pointInMinorEllipse = pointInEllipse(minorEllipse, coords);\n  const pointInMajorEllipse = pointInEllipse(majorEllipse, coords);\n\n  if (pointInMajorEllipse && !pointInMinorEllipse) {\n    return true;\n  }\n\n  return false;\n}\n\nfunction pointNearTool (element, data, coords) {\n  return pointNearEllipse(element, data, coords, 15);\n}\n\nfunction pointNearToolTouch (element, data, coords) {\n  return pointNearEllipse(element, data, coords, 25);\n}\n\nfunction numberWithCommas (x) {\n  // http://stackoverflow.com/questions/2901102/how-to-print-a-number-with-commas-as-thousands-separators-in-javascript\n  const parts = x.toString().split('.');\n\n  parts[0] = parts[0].replace(/\\B(?=(\\d{3})+(?!\\d))/g, ',');\n\n  return parts.join('.');\n}\n\nfunction onImageRendered (e) {\n  const eventData = e.detail;\n\n  // If we have no toolData for this element, return immediately as there is nothing to do\n  const toolData = getToolState(e.currentTarget, toolType);\n\n  if (!toolData) {\n    return;\n  }\n\n  const cornerstone = external.cornerstone;\n  const image = eventData.image;\n  const element = eventData.element;\n  const lineWidth = toolStyle.getToolWidth();\n  const config = ellipticalRoi.getConfiguration();\n  const context = eventData.canvasContext.canvas.getContext('2d');\n  const seriesModule = cornerstone.metaData.get('generalSeriesModule', image.imageId);\n  let modality;\n\n  if (seriesModule) {\n    modality = seriesModule.modality;\n  }\n\n  context.setTransform(1, 0, 0, 1, 0, 0);\n\n  // If we have tool data for this element - iterate over each set and draw it\n  for (let i = 0; i < toolData.data.length; i++) {\n    context.save();\n\n    const data = toolData.data[i];\n\n    // Apply any shadow settings defined in the tool configuration\n    if (config && config.shadow) {\n      context.shadowColor = config.shadowColor || '#000000';\n      context.shadowOffsetX = config.shadowOffsetX || 1;\n      context.shadowOffsetY = config.shadowOffsetY || 1;\n    }\n\n    // Check which color the rendered tool should be\n    const color = toolColors.getColorIfActive(data.active);\n\n    // Convert Image coordinates to Canvas coordinates given the element\n    const handleStartCanvas = cornerstone.pixelToCanvas(element, data.handles.start);\n    const handleEndCanvas = cornerstone.pixelToCanvas(element, data.handles.end);\n\n    // Retrieve the bounds of the ellipse (left, top, width, and height)\n    // In Canvas coordinates\n    const leftCanvas = Math.min(handleStartCanvas.x, handleEndCanvas.x);\n    const topCanvas = Math.min(handleStartCanvas.y, handleEndCanvas.y);\n    const widthCanvas = Math.abs(handleStartCanvas.x - handleEndCanvas.x);\n    const heightCanvas = Math.abs(handleStartCanvas.y - handleEndCanvas.y);\n\n    // Draw the ellipse on the canvas\n    context.beginPath();\n    context.strokeStyle = color;\n    context.lineWidth = lineWidth;\n    drawEllipse(context, leftCanvas, topCanvas, widthCanvas, heightCanvas);\n    context.closePath();\n\n    // If the tool configuration specifies to only draw the handles on hover / active,\n    // Follow this logic\n    if (config && config.drawHandlesOnHover) {\n      // Draw the handles if the tool is active\n      if (data.active === true) {\n        drawHandles(context, eventData, data.handles, color);\n      } else {\n        // If the tool is inactive, draw the handles only if each specific handle is being\n        // Hovered over\n        const handleOptions = {\n          drawHandlesIfActive: true\n        };\n\n        drawHandles(context, eventData, data.handles, color, handleOptions);\n      }\n    } else {\n      // If the tool has no configuration settings, always draw the handles\n      drawHandles(context, eventData, data.handles, color);\n    }\n\n    // Define variables for the area and mean/standard deviation\n    let area,\n      meanStdDev,\n      meanStdDevSUV;\n\n    // Perform a check to see if the tool has been invalidated. This is to prevent\n    // Unnecessary re-calculation of the area, mean, and standard deviation if the\n    // Image is re-rendered but the tool has not moved (e.g. during a zoom)\n    if (data.invalidated === false) {\n      // If the data is not invalidated, retrieve it from the toolData\n      meanStdDev = data.meanStdDev;\n      meanStdDevSUV = data.meanStdDevSUV;\n      area = data.area;\n    } else {\n      // If the data has been invalidated, we need to calculate it again\n\n      // Retrieve the bounds of the ellipse in image coordinates\n      const ellipse = {\n        left: Math.round(Math.min(data.handles.start.x, data.handles.end.x)),\n        top: Math.round(Math.min(data.handles.start.y, data.handles.end.y)),\n        width: Math.round(Math.abs(data.handles.start.x - data.handles.end.x)),\n        height: Math.round(Math.abs(data.handles.start.y - data.handles.end.y))\n      };\n\n      // First, make sure this is not a color image, since no mean / standard\n      // Deviation will be calculated for color images.\n      if (!image.color) {\n        // Retrieve the array of pixels that the ellipse bounds cover\n        const pixels = cornerstone.getPixels(element, ellipse.left, ellipse.top, ellipse.width, ellipse.height);\n\n        // Calculate the mean & standard deviation from the pixels and the ellipse details\n        meanStdDev = calculateEllipseStatistics(pixels, ellipse);\n\n        if (modality === 'PT') {\n          // If the image is from a PET scan, use the DICOM tags to\n          // Calculate the SUV from the mean and standard deviation.\n\n          // Note that because we are using modality pixel values from getPixels, and\n          // The calculateSUV routine also rescales to modality pixel values, we are first\n          // Returning the values to storedPixel values before calcuating SUV with them.\n          // TODO: Clean this up? Should we add an option to not scale in calculateSUV?\n          meanStdDevSUV = {\n            mean: calculateSUV(image, (meanStdDev.mean - image.intercept) / image.slope),\n            stdDev: calculateSUV(image, (meanStdDev.stdDev - image.intercept) / image.slope)\n          };\n        }\n\n        // If the mean and standard deviation values are sane, store them for later retrieval\n        if (meanStdDev && !isNaN(meanStdDev.mean)) {\n          data.meanStdDev = meanStdDev;\n          data.meanStdDevSUV = meanStdDevSUV;\n        }\n      }\n\n      // Retrieve the pixel spacing values, and if they are not\n      // Real non-zero values, set them to 1\n      const columnPixelSpacing = image.columnPixelSpacing || 1;\n      const rowPixelSpacing = image.rowPixelSpacing || 1;\n\n      // Calculate the image area from the ellipse dimensions and pixel spacing\n      area = Math.PI * (ellipse.width * columnPixelSpacing / 2) * (ellipse.height * rowPixelSpacing / 2);\n\n      // If the area value is sane, store it for later retrieval\n      if (!isNaN(area)) {\n        data.area = area;\n      }\n\n      // Set the invalidated flag to false so that this data won't automatically be recalculated\n      data.invalidated = false;\n    }\n\n    // Define an array to store the rows of text for the textbox\n    const textLines = [];\n\n    // If the mean and standard deviation values are present, display them\n    if (meanStdDev && meanStdDev.mean !== undefined) {\n      // If the modality is CT, add HU to denote Hounsfield Units\n      let moSuffix = '';\n\n      if (modality === 'CT') {\n        moSuffix = ' HU';\n      }\n\n      // Create a line of text to display the mean and any units that were specified (i.e. HU)\n      let meanText = `Mean: ${numberWithCommas(meanStdDev.mean.toFixed(2))}${moSuffix}`;\n      // Create a line of text to display the standard deviation and any units that were specified (i.e. HU)\n      let stdDevText = `StdDev: ${numberWithCommas(meanStdDev.stdDev.toFixed(2))}${moSuffix}`;\n\n      // If this image has SUV values to display, concatenate them to the text line\n      if (meanStdDevSUV && meanStdDevSUV.mean !== undefined) {\n        const SUVtext = ' SUV: ';\n\n        meanText += SUVtext + numberWithCommas(meanStdDevSUV.mean.toFixed(2));\n        stdDevText += SUVtext + numberWithCommas(meanStdDevSUV.stdDev.toFixed(2));\n      }\n\n      // Add these text lines to the array to be displayed in the textbox\n      textLines.push(meanText);\n      textLines.push(stdDevText);\n    }\n\n    // If the area is a sane value, display it\n    if (area) {\n      // Determine the area suffix based on the pixel spacing in the image.\n      // If pixel spacing is present, use millimeters. Otherwise, use pixels.\n      // This uses Char code 178 for a superscript 2\n      let suffix = ` mm${String.fromCharCode(178)}`;\n\n      if (!image.rowPixelSpacing || !image.columnPixelSpacing) {\n        suffix = ` pixels${String.fromCharCode(178)}`;\n      }\n\n      // Create a line of text to display the area and its units\n      const areaText = `Area: ${numberWithCommas(area.toFixed(2))}${suffix}`;\n\n      // Add this text line to the array to be displayed in the textbox\n      textLines.push(areaText);\n    }\n\n    // If the textbox has not been moved by the user, it should be displayed on the right-most\n    // Side of the tool.\n    if (!data.handles.textBox.hasMoved) {\n      // Find the rightmost side of the ellipse at its vertical center, and place the textbox here\n      // Note that this calculates it in image coordinates\n      data.handles.textBox.x = Math.max(data.handles.start.x, data.handles.end.x);\n      data.handles.textBox.y = (data.handles.start.y + data.handles.end.y) / 2;\n    }\n\n    // Convert the textbox Image coordinates into Canvas coordinates\n    const textCoords = cornerstone.pixelToCanvas(element, data.handles.textBox);\n\n    // Set options for the textbox drawing function\n    const options = {\n      centering: {\n        x: false,\n        y: true\n      }\n    };\n\n    // Draw the textbox and retrieves it's bounding box for mouse-dragging and highlighting\n    const boundingBox = drawTextBox(context, textLines, textCoords.x,\n      textCoords.y, color, options);\n\n    // Store the bounding box data in the handle for mouse-dragging and highlighting\n    data.handles.textBox.boundingBox = boundingBox;\n\n    // If the textbox has moved, we would like to draw a line linking it with the tool\n    // This section decides where to draw this line to on the Ellipse based on the location\n    // Of the textbox relative to the ellipse.\n    if (data.handles.textBox.hasMoved) {\n      // Draw dashed link line between tool and text\n\n      // The initial link position is at the center of the\n      // Textbox.\n      const link = {\n        start: {},\n        end: {\n          x: textCoords.x,\n          y: textCoords.y\n        }\n      };\n\n      // First we calculate the ellipse points (top, left, right, and bottom)\n      const ellipsePoints = [{\n        // Top middle point of ellipse\n        x: leftCanvas + widthCanvas / 2,\n        y: topCanvas\n      }, {\n        // Left middle point of ellipse\n        x: leftCanvas,\n        y: topCanvas + heightCanvas / 2\n      }, {\n        // Bottom middle point of ellipse\n        x: leftCanvas + widthCanvas / 2,\n        y: topCanvas + heightCanvas\n      }, {\n        // Right middle point of ellipse\n        x: leftCanvas + widthCanvas,\n        y: topCanvas + heightCanvas / 2\n      }];\n\n      // We obtain the link starting point by finding the closest point on the ellipse to the\n      // Center of the textbox\n      link.start = external.cornerstoneMath.point.findClosestPoint(ellipsePoints, link.end);\n\n      // Next we calculate the corners of the textbox bounding box\n      const boundingBoxPoints = [{\n        // Top middle point of bounding box\n        x: boundingBox.left + boundingBox.width / 2,\n        y: boundingBox.top\n      }, {\n        // Left middle point of bounding box\n        x: boundingBox.left,\n        y: boundingBox.top + boundingBox.height / 2\n      }, {\n        // Bottom middle point of bounding box\n        x: boundingBox.left + boundingBox.width / 2,\n        y: boundingBox.top + boundingBox.height\n      }, {\n        // Right middle point of bounding box\n        x: boundingBox.left + boundingBox.width,\n        y: boundingBox.top + boundingBox.height / 2\n      }];\n\n      // Now we recalculate the link endpoint by identifying which corner of the bounding box\n      // Is closest to the start point we just calculated.\n      link.end = external.cornerstoneMath.point.findClosestPoint(boundingBoxPoints, link.start);\n\n      // Finally we draw the dashed linking line\n      context.beginPath();\n      context.strokeStyle = color;\n      context.lineWidth = lineWidth;\n      context.setLineDash([2, 3]);\n      context.moveTo(link.start.x, link.start.y);\n      context.lineTo(link.end.x, link.end.y);\n      context.stroke();\n    }\n\n    context.restore();\n  }\n}\n// /////// END IMAGE RENDERING ///////\n\n// Module exports\nconst ellipticalRoi = mouseButtonTool({\n  createNewMeasurement,\n  onImageRendered,\n  pointNearTool,\n  toolType\n});\n\nconst ellipticalRoiTouch = touchTool({\n  createNewMeasurement,\n  onImageRendered,\n  pointNearTool: pointNearToolTouch,\n  toolType\n});\n\nexport { ellipticalRoi, ellipticalRoiTouch };\n\n\n\n// WEBPACK FOOTER //\n// ./tools/image/ellipticalRoi.js","import EVENTS from '@/events.js';\nimport external from '@/externalModules.js';\nimport toolStyle from '@/stateManagement/toolStyle.js';\nimport toolColors from '@/stateManagement/toolColors.js';\nimport drawHandles from '@/manipulators/drawHandles.js';\nimport isMouseButtonEnabled from '@/util/isMouseButtonEnabled.js';\nimport { addToolState, getToolState } from '@/stateManagement/toolState.js';\nimport { setToolOptions, getToolOptions } from '@/toolOptions.js';\n\nconst toolType = 'freehand';\nlet configuration = {\n  mouseLocation: {\n    handles: {\n      start: {\n        highlight: true,\n        active: true\n      }\n    }\n  },\n  freehand: false,\n  modifying: false,\n  currentHandle: 0,\n  currentTool: -1\n};\n\n// /////// BEGIN ACTIVE TOOL ///////\nfunction addPoint (eventData) {\n  const toolData = getToolState(eventData.element, toolType);\n\n  if (toolData === undefined) {\n    return;\n  }\n\n  const config = freehand.getConfiguration();\n\n  // Get the toolData from the last-drawn drawing\n  // (this should change when modification is added)\n  const data = toolData.data[config.currentTool];\n\n  const handleData = {\n    x: eventData.currentPoints.image.x,\n    y: eventData.currentPoints.image.y,\n    highlight: true,\n    active: true,\n    lines: []\n  };\n\n    // If this is not the first handle\n  if (data.handles.length) {\n    // Add the line from the current handle to the new handle\n    data.handles[config.currentHandle - 1].lines.push(eventData.currentPoints.image);\n  }\n\n  // Add the new handle\n  data.handles.push(handleData);\n\n  // Increment the current handle value\n  config.currentHandle += 1;\n\n  // Reset freehand value\n  config.freehand = false;\n\n  // Force onImageRendered to fire\n  external.cornerstone.updateImage(eventData.element);\n}\n\nfunction pointNearHandle (eventData, toolIndex) {\n  const toolData = getToolState(eventData.element, toolType);\n\n  if (toolData === undefined) {\n    return;\n  }\n\n  const data = toolData.data[toolIndex];\n\n  if (data.handles === undefined) {\n    return;\n  }\n\n  const mousePoint = eventData.currentPoints.canvas;\n\n  for (let i = 0; i < data.handles.length; i++) {\n    const handleCanvas = external.cornerstone.pixelToCanvas(eventData.element, data.handles[i]);\n\n    if (external.cornerstoneMath.point.distance(handleCanvas, mousePoint) < 5) {\n      return i;\n    }\n  }\n\n  return;\n}\n\nfunction pointNearHandleAllTools (eventData) {\n  const toolData = getToolState(eventData.element, toolType);\n\n  if (!toolData) {\n    return;\n  }\n\n  let handleNearby;\n\n  for (let toolIndex = 0; toolIndex < toolData.data.length; toolIndex++) {\n    handleNearby = pointNearHandle(eventData, toolIndex);\n    if (handleNearby !== undefined) {\n      return {\n        handleNearby,\n        toolIndex\n      };\n    }\n  }\n}\n\n// --- Drawing loop ---\n// On first click, add point\n// After first click, on mouse move, record location\n// If mouse comes close to previous point, snap to it\n// On next click, add another point -- continuously\n// On each click, if it intersects with a current point, end drawing loop\n\nfunction mouseUpCallback (e) {\n  const eventData = e.detail;\n  const element = eventData.element;\n\n  element.removeEventListener(EVENTS.MOUSE_UP, mouseUpCallback);\n\n  // Check if drawing is finished\n  const toolData = getToolState(eventData.element, toolType);\n\n  if (toolData === undefined) {\n    return;\n  }\n\n  const config = freehand.getConfiguration();\n\n  if (!eventData.event.shiftKey) {\n    config.freehand = false;\n  }\n\n  external.cornerstone.updateImage(eventData.element);\n}\n\nfunction mouseMoveCallback (e) {\n  const eventData = e.detail;\n  const toolData = getToolState(eventData.element, toolType);\n\n  if (!toolData) {\n    return;\n  }\n\n  const config = freehand.getConfiguration();\n\n  const data = toolData.data[config.currentTool];\n\n  // Set the mouseLocation handle\n  let x = Math.max(eventData.currentPoints.image.x, 0);\n\n  x = Math.min(x, eventData.image.width);\n  config.mouseLocation.handles.start.x = x;\n\n  let y = Math.max(eventData.currentPoints.image.y, 0);\n\n  y = Math.min(y, eventData.image.height);\n  config.mouseLocation.handles.start.y = y;\n\n  const currentHandle = config.currentHandle;\n\n  if (config.modifying) {\n    // Move the handle\n    data.active = true;\n    data.highlight = true;\n    data.handles[currentHandle].x = config.mouseLocation.handles.start.x;\n    data.handles[currentHandle].y = config.mouseLocation.handles.start.y;\n    if (currentHandle) {\n      const lastLineIndex = data.handles[currentHandle - 1].lines.length - 1;\n      const lastLine = data.handles[currentHandle - 1].lines[lastLineIndex];\n\n      lastLine.x = config.mouseLocation.handles.start.x;\n      lastLine.y = config.mouseLocation.handles.start.y;\n    }\n  }\n\n  if (config.freehand) {\n    data.handles[currentHandle - 1].lines.push(eventData.currentPoints.image);\n  } else {\n    // No snapping in freehand mode\n    const handleNearby = pointNearHandle(eventData, config.currentTool);\n\n    // If there is a handle nearby to snap to\n    // (and it's not the actual mouse handle)\n    if (handleNearby !== undefined && handleNearby < (data.handles.length - 1)) {\n      config.mouseLocation.handles.start.x = data.handles[handleNearby].x;\n      config.mouseLocation.handles.start.y = data.handles[handleNearby].y;\n    }\n  }\n\n  // Force onImageRendered\n  external.cornerstone.updateImage(eventData.element);\n}\n\nfunction startDrawing (eventData) {\n  const element = eventData.element;\n\n  element.addEventListener(EVENTS.MOUSE_MOVE, mouseMoveCallback);\n  element.addEventListener(EVENTS.MOUSE_UP, mouseUpCallback);\n\n  const measurementData = {\n    visible: true,\n    active: true,\n    handles: []\n  };\n\n  const config = freehand.getConfiguration();\n\n  config.mouseLocation.handles.start.x = eventData.currentPoints.image.x;\n  config.mouseLocation.handles.start.y = eventData.currentPoints.image.y;\n\n  addToolState(eventData.element, toolType, measurementData);\n\n  const toolData = getToolState(eventData.element, toolType);\n\n  config.currentTool = toolData.data.length - 1;\n}\n\nfunction endDrawing (eventData, handleNearby) {\n  const element = eventData.element;\n  const toolData = getToolState(eventData.element, toolType);\n\n  if (!toolData) {\n    return;\n  }\n\n  const config = freehand.getConfiguration();\n\n  const data = toolData.data[config.currentTool];\n\n  data.active = false;\n  data.highlight = false;\n\n  // Connect the end of the drawing to the handle nearest to the click\n  if (handleNearby !== undefined) {\n    // Only save x,y params from nearby handle to prevent circular reference\n    data.handles[config.currentHandle - 1].lines.push({\n      x: data.handles[handleNearby].x,\n      y: data.handles[handleNearby].y\n    });\n  }\n\n  if (config.modifying) {\n    config.modifying = false;\n  }\n\n  // Reset the current handle\n  config.currentHandle = 0;\n  config.currentTool = -1;\n\n  element.removeEventListener(EVENTS.MOUSE_MOVE, mouseMoveCallback);\n\n  external.cornerstone.updateImage(eventData.element);\n}\n\nfunction mouseDownCallback (e) {\n  const eventData = e.detail;\n  const element = eventData.element;\n  const options = getToolOptions(toolType, element);\n\n  if (isMouseButtonEnabled(eventData.which, options.mouseButtonMask)) {\n    const toolData = getToolState(eventData.element, toolType);\n\n    let handleNearby, toolIndex;\n\n    const config = freehand.getConfiguration();\n    const currentTool = config.currentTool;\n\n    if (config.modifying) {\n      endDrawing(eventData);\n\n      return;\n    }\n\n    if (currentTool < 0) {\n      const nearby = pointNearHandleAllTools(eventData);\n\n      if (nearby) {\n        handleNearby = nearby.handleNearby;\n        toolIndex = nearby.toolIndex;\n        // This means the user is trying to modify a point\n        if (handleNearby !== undefined) {\n          element.addEventListener(EVENTS.MOUSE_MOVE, mouseMoveCallback);\n          element.addEventListener(EVENTS.MOUSE_UP, mouseUpCallback);\n          config.modifying = true;\n          config.currentHandle = handleNearby;\n          config.currentTool = toolIndex;\n        }\n      } else {\n        startDrawing(eventData);\n        addPoint(eventData);\n      }\n    } else if (currentTool >= 0 && toolData.data[currentTool].active) {\n      handleNearby = pointNearHandle(eventData, currentTool);\n      if (handleNearby !== undefined) {\n        endDrawing(eventData, handleNearby);\n      } else if (eventData.event.shiftKey) {\n        config.freehand = true;\n      } else {\n        addPoint(eventData);\n      }\n    }\n\n    e.preventDefault();\n    e.stopPropagation();\n  }\n}\n\n// /////// END ACTIVE TOOL ///////\n\n// /////// BEGIN IMAGE RENDERING ///////\nfunction onImageRendered (e) {\n  const eventData = e.detail;\n\n  // If we have no toolData for this element, return immediately as there is nothing to do\n  const toolData = getToolState(e.currentTarget, toolType);\n\n  if (toolData === undefined) {\n    return;\n  }\n\n  const cornerstone = external.cornerstone;\n  const config = freehand.getConfiguration();\n\n  // We have tool data for this element - iterate over each one and draw it\n  const context = eventData.canvasContext.canvas.getContext('2d');\n\n  context.setTransform(1, 0, 0, 1, 0, 0);\n\n  let color;\n  const lineWidth = toolStyle.getToolWidth();\n  let fillColor = toolColors.getFillColor();\n\n  for (let i = 0; i < toolData.data.length; i++) {\n    context.save();\n\n    const data = toolData.data[i];\n\n    if (data.active) {\n      color = toolColors.getActiveColor();\n      fillColor = toolColors.getFillColor();\n    } else {\n      color = toolColors.getToolColor();\n      fillColor = toolColors.getToolColor();\n    }\n\n    let handleStart;\n\n    if (data.handles.length) {\n      for (let j = 0; j < data.handles.length; j++) {\n        // Draw a line between handle j and j+1\n        handleStart = data.handles[j];\n        const handleStartCanvas = cornerstone.pixelToCanvas(eventData.element, handleStart);\n\n        context.beginPath();\n        context.strokeStyle = color;\n        context.lineWidth = lineWidth;\n        context.moveTo(handleStartCanvas.x, handleStartCanvas.y);\n\n        for (let k = 0; k < data.handles[j].lines.length; k++) {\n          const lineCanvas = cornerstone.pixelToCanvas(eventData.element, data.handles[j].lines[k]);\n\n          context.lineTo(lineCanvas.x, lineCanvas.y);\n          context.stroke();\n        }\n\n        const mouseLocationCanvas = cornerstone.pixelToCanvas(eventData.element, config.mouseLocation.handles.start);\n\n        if (j === (data.handles.length - 1)) {\n          if (data.active && !config.freehand && !config.modifying) {\n            // If it's still being actively drawn, keep the last line to\n            // The mouse location\n            context.lineTo(mouseLocationCanvas.x, mouseLocationCanvas.y);\n            context.stroke();\n          }\n        }\n      }\n    }\n\n    // If the tool is active, draw a handle at the cursor location\n    const options = {\n      fill: fillColor\n    };\n\n    if (data.active) {\n      drawHandles(context, eventData, config.mouseLocation.handles, color, options);\n    }\n    // Draw the handles\n    drawHandles(context, eventData, data.handles, color, options);\n\n    context.restore();\n  }\n}\n\n// /////// END IMAGE RENDERING ///////\nfunction enable (element) {\n  element.removeEventListener(EVENTS.MOUSE_DOWN, mouseDownCallback);\n  element.removeEventListener(EVENTS.MOUSE_UP, mouseUpCallback);\n  element.removeEventListener(EVENTS.MOUSE_MOVE, mouseMoveCallback);\n  element.removeEventListener(EVENTS.IMAGE_RENDERED, onImageRendered);\n\n  element.addEventListener(EVENTS.IMAGE_RENDERED, onImageRendered);\n  external.cornerstone.updateImage(element);\n}\n\n// Disables the reference line tool for the given element\nfunction disable (element) {\n  element.removeEventListener(EVENTS.MOUSE_DOWN, mouseDownCallback);\n  element.removeEventListener(EVENTS.MOUSE_UP, mouseUpCallback);\n  element.removeEventListener(EVENTS.MOUSE_MOVE, mouseMoveCallback);\n  element.removeEventListener(EVENTS.IMAGE_RENDERED, onImageRendered);\n  external.cornerstone.updateImage(element);\n}\n\n// Visible and interactive\nfunction activate (element, mouseButtonMask) {\n  setToolOptions(toolType, element, { mouseButtonMask });\n\n  element.removeEventListener(EVENTS.MOUSE_DOWN, mouseDownCallback);\n  element.removeEventListener(EVENTS.MOUSE_UP, mouseUpCallback);\n  element.removeEventListener(EVENTS.MOUSE_MOVE, mouseMoveCallback);\n  element.removeEventListener(EVENTS.IMAGE_RENDERED, onImageRendered);\n\n  element.addEventListener(EVENTS.IMAGE_RENDERED, onImageRendered);\n  element.addEventListener(EVENTS.MOUSE_DOWN, mouseDownCallback);\n\n  external.cornerstone.updateImage(element);\n}\n\n// Visible, but not interactive\nfunction deactivate (element) {\n  element.removeEventListener(EVENTS.MOUSE_DOWN, mouseDownCallback);\n  element.removeEventListener(EVENTS.MOUSE_UP, mouseUpCallback);\n  element.removeEventListener(EVENTS.MOUSE_MOVE, mouseMoveCallback);\n  element.removeEventListener(EVENTS.IMAGE_RENDERED, onImageRendered);\n\n  element.addEventListener(EVENTS.IMAGE_RENDERED, onImageRendered);\n\n  external.cornerstone.updateImage(element);\n}\n\nfunction getConfiguration () {\n  return configuration;\n}\n\nfunction setConfiguration (config) {\n  configuration = config;\n}\n\n// Module/private exports\nconst freehand = {\n  enable,\n  disable,\n  activate,\n  deactivate,\n  getConfiguration,\n  setConfiguration\n};\n\nexport { freehand };\n\n\n\n// WEBPACK FOOTER //\n// ./tools/image/freehand.js","import external from '@/externalModules.js';\nimport { mouseButtonRectangleTool, touchTool } from '@tools/base/index.js';\nimport toolStyle from '@/stateManagement/toolStyle.js';\nimport toolColors from '@/stateManagement/toolColors.js';\nimport drawHandles from '@/manipulators/drawHandles.js';\nimport { getToolState } from '@/stateManagement/toolState.js';\n\nconst toolType = 'highlight';\n\n// /////// BEGIN ACTIVE TOOL ///////\nfunction createNewMeasurement (mouseEventData) {\n  // If already a highlight measurement, creating a new one will be useless\n  const existingToolData = getToolState(mouseEventData.event.currentTarget, toolType);\n\n  if (existingToolData && existingToolData.data && existingToolData.data.length > 0) {\n    return;\n  }\n\n  // Create the measurement data for this tool with the end handle activated\n  const measurementData = {\n    visible: true,\n    active: true,\n    handles: {\n      start: {\n        x: mouseEventData.currentPoints.image.x,\n        y: mouseEventData.currentPoints.image.y,\n        highlight: true,\n        active: false\n      },\n      end: {\n        x: mouseEventData.currentPoints.image.x,\n        y: mouseEventData.currentPoints.image.y,\n        highlight: true,\n        active: true\n      }\n    }\n  };\n\n  return measurementData;\n}\n// /////// END ACTIVE TOOL ///////\n\nfunction pointInsideRect (element, data, coords) {\n  const cornerstone = external.cornerstone;\n  const startCanvas = cornerstone.pixelToCanvas(element, data.handles.start);\n  const endCanvas = cornerstone.pixelToCanvas(element, data.handles.end);\n\n  const rect = {\n    left: Math.min(startCanvas.x, endCanvas.x),\n    top: Math.min(startCanvas.y, endCanvas.y),\n    width: Math.abs(startCanvas.x - endCanvas.x),\n    height: Math.abs(startCanvas.y - endCanvas.y)\n  };\n\n  let insideBox = false;\n\n  if ((coords.x >= rect.left && coords.x <= (rect.left + rect.width)) && coords.y >= rect.top && coords.y <= (rect.top + rect.height)) {\n    insideBox = true;\n  }\n\n  return insideBox;\n}\n\nfunction pointNearTool (element, data, coords) {\n  const cornerstone = external.cornerstone;\n  const startCanvas = cornerstone.pixelToCanvas(element, data.handles.start);\n  const endCanvas = cornerstone.pixelToCanvas(element, data.handles.end);\n\n  const rect = {\n    left: Math.min(startCanvas.x, endCanvas.x),\n    top: Math.min(startCanvas.y, endCanvas.y),\n    width: Math.abs(startCanvas.x - endCanvas.x),\n    height: Math.abs(startCanvas.y - endCanvas.y)\n  };\n\n  const distanceToPoint = external.cornerstoneMath.rect.distanceToPoint(rect, coords);\n\n\n  return (distanceToPoint < 5);\n}\n\n// /////// BEGIN IMAGE RENDERING ///////\n\nfunction onImageRendered (e) {\n  const eventData = e.detail;\n\n  // If we have no toolData for this element, return immediately as there is nothing to do\n  const toolData = getToolState(e.currentTarget, toolType);\n\n  if (toolData === undefined) {\n    return;\n  }\n\n  const cornerstone = external.cornerstone;\n  // We have tool data for this elemen\n  const context = eventData.canvasContext.canvas.getContext('2d');\n\n  context.setTransform(1, 0, 0, 1, 0, 0);\n\n  let color;\n  const lineWidth = toolStyle.getToolWidth();\n\n  context.save();\n\n  const data = toolData.data[0];\n\n  if (!data) {\n    return;\n  }\n\n  if (data.active) {\n    color = toolColors.getActiveColor();\n  } else {\n    color = toolColors.getToolColor();\n  }\n\n  const handleStartCanvas = cornerstone.pixelToCanvas(eventData.element, data.handles.start);\n  const handleEndCanvas = cornerstone.pixelToCanvas(eventData.element, data.handles.end);\n\n  const rect = {\n    left: Math.min(handleStartCanvas.x, handleEndCanvas.x),\n    top: Math.min(handleStartCanvas.y, handleEndCanvas.y),\n    width: Math.abs(handleStartCanvas.x - handleEndCanvas.x),\n    height: Math.abs(handleStartCanvas.y - handleEndCanvas.y)\n  };\n\n    // Draw dark fill outside the rectangle\n  context.beginPath();\n  context.strokeStyle = 'transparent';\n\n  context.rect(0, 0, context.canvas.clientWidth, context.canvas.clientHeight);\n\n  context.rect(rect.width + rect.left, rect.top, -rect.width, rect.height);\n  context.stroke();\n  context.fillStyle = 'rgba(0,0,0,0.7)';\n  context.fill();\n  context.closePath();\n\n  // Draw dashed stroke rectangle\n  context.beginPath();\n  context.strokeStyle = color;\n  context.lineWidth = lineWidth;\n  context.setLineDash([4]);\n  context.strokeRect(rect.left, rect.top, rect.width, rect.height);\n\n  // Strange fix, but restore doesn't seem to reset the line dashes?\n  context.setLineDash([]);\n\n  // Draw the handles last, so they will be on top of the overlay\n  drawHandles(context, eventData, data.handles, color);\n  context.restore();\n}\n// /////// END IMAGE RENDERING ///////\n\n// Module exports\nconst preventHandleOutsideImage = true;\n\nconst highlight = mouseButtonRectangleTool({\n  createNewMeasurement,\n  onImageRendered,\n  pointNearTool,\n  pointInsideRect,\n  toolType\n}, preventHandleOutsideImage);\n\nconst highlightTouch = touchTool({\n  createNewMeasurement,\n  onImageRendered,\n  pointNearTool,\n  pointInsideRect,\n  toolType\n}, preventHandleOutsideImage);\n\nexport {\n  highlight,\n  highlightTouch\n};\n\n\n\n// WEBPACK FOOTER //\n// ./tools/image/highlight.js","import displayTool from './displayTool.js';\nimport drawTextBox from '@/util/drawTextBox.js';\n\nfunction onImageRendered (e) {\n  const eventData = e.detail;\n  const image = eventData.image;\n  const stats = image.stats;\n\n  const context = eventData.canvasContext.canvas.getContext('2d');\n\n  context.setTransform(1, 0, 0, 1, 0, 0);\n\n  const textLines = [];\n\n  Object.keys(stats).forEach(function (key) {\n    const text = `${key} : ${stats[key]}`;\n\n    textLines.push(text);\n  });\n\n  drawTextBox(context, textLines, 0, 0, 'orange');\n\n  textLines.forEach(function (text) {\n    console.log(text);\n  });\n}\n\nconst imageStats = displayTool(onImageRendered);\n\nexport default imageStats;\n\n\n\n// WEBPACK FOOTER //\n// ./tools/image/imageStats.js","import external from '@/externalModules.js';\nimport { mouseButtonTool, touchTool } from '@tools/base/index.js';\nimport drawTextBox from '@/util/drawTextBox.js';\nimport toolStyle from '@/stateManagement/toolStyle.js';\nimport toolColors from '@/stateManagement/toolColors.js';\nimport drawHandles from '@/manipulators/drawHandles.js';\nimport { getToolState } from '@/stateManagement/toolState.js';\n\nconst toolType = 'length';\n\n// /////// BEGIN ACTIVE TOOL ///////\nfunction createNewMeasurement (mouseEventData) {\n  // Create the measurement data for this tool with the end handle activated\n  const measurementData = {\n    visible: true,\n    active: true,\n    handles: {\n      start: {\n        x: mouseEventData.currentPoints.image.x,\n        y: mouseEventData.currentPoints.image.y,\n        highlight: true,\n        active: false\n      },\n      end: {\n        x: mouseEventData.currentPoints.image.x,\n        y: mouseEventData.currentPoints.image.y,\n        highlight: true,\n        active: true\n      },\n      textBox: {\n        active: false,\n        hasMoved: false,\n        movesIndependently: false,\n        drawnIndependently: true,\n        allowedOutsideImage: true,\n        hasBoundingBox: true\n      }\n    }\n  };\n\n  return measurementData;\n}\n// /////// END ACTIVE TOOL ///////\n\nfunction pointNearTool (element, data, coords) {\n  const cornerstone = external.cornerstone;\n  const lineSegment = {\n    start: cornerstone.pixelToCanvas(element, data.handles.start),\n    end: cornerstone.pixelToCanvas(element, data.handles.end)\n  };\n  const distanceToPoint = external.cornerstoneMath.lineSegment.distanceToPoint(lineSegment, coords);\n\n\n  return (distanceToPoint < 25);\n}\n\n// /////// BEGIN IMAGE RENDERING ///////\nfunction onImageRendered (e) {\n  const eventData = e.detail;\n\n  // If we have no toolData for this element, return immediately as there is nothing to do\n  const toolData = getToolState(e.currentTarget, toolType);\n\n  if (!toolData) {\n    return;\n  }\n\n  const cornerstone = external.cornerstone;\n  // We have tool data for this element - iterate over each one and draw it\n  const context = eventData.canvasContext.canvas.getContext('2d');\n  const { image, element } = eventData;\n\n  context.setTransform(1, 0, 0, 1, 0, 0);\n\n  const lineWidth = toolStyle.getToolWidth();\n  const config = length.getConfiguration();\n  const imagePlane = cornerstone.metaData.get('imagePlaneModule', image.imageId);\n  let rowPixelSpacing;\n  let colPixelSpacing;\n\n  if (imagePlane) {\n    rowPixelSpacing = imagePlane.rowPixelSpacing || imagePlane.rowImagePixelSpacing;\n    colPixelSpacing = imagePlane.columnPixelSpacing || imagePlane.colImagePixelSpacing;\n  } else {\n    rowPixelSpacing = image.rowPixelSpacing;\n    colPixelSpacing = image.columnPixelSpacing;\n  }\n\n  for (let i = 0; i < toolData.data.length; i++) {\n    context.save();\n\n    // Configurable shadow\n    if (config && config.shadow) {\n      context.shadowColor = config.shadowColor || '#000000';\n      context.shadowOffsetX = config.shadowOffsetX || 1;\n      context.shadowOffsetY = config.shadowOffsetY || 1;\n    }\n\n    const data = toolData.data[i];\n    const color = toolColors.getColorIfActive(data.active);\n\n    // Get the handle positions in canvas coordinates\n    const handleStartCanvas = cornerstone.pixelToCanvas(element, data.handles.start);\n    const handleEndCanvas = cornerstone.pixelToCanvas(element, data.handles.end);\n\n    // Draw the measurement line\n    context.beginPath();\n    context.strokeStyle = color;\n    context.lineWidth = lineWidth;\n    context.moveTo(handleStartCanvas.x, handleStartCanvas.y);\n    context.lineTo(handleEndCanvas.x, handleEndCanvas.y);\n    context.stroke();\n\n    // Draw the handles\n    const handleOptions = {\n      drawHandlesIfActive: (config && config.drawHandlesOnHover)\n    };\n\n    drawHandles(context, eventData, data.handles, color, handleOptions);\n\n    // Draw the text\n    context.fillStyle = color;\n\n    // Set rowPixelSpacing and columnPixelSpacing to 1 if they are undefined (or zero)\n    const dx = (data.handles.end.x - data.handles.start.x) * (rowPixelSpacing || 1);\n    const dy = (data.handles.end.y - data.handles.start.y) * (colPixelSpacing || 1);\n\n    // Calculate the length, and create the text variable with the millimeters or pixels suffix\n    const length = Math.sqrt(dx * dx + dy * dy);\n\n    // Store the length inside the tool for outside access\n    data.length = length;\n\n    // Set the length text suffix depending on whether or not pixelSpacing is available\n    let suffix = ' mm';\n\n    if (!rowPixelSpacing || !colPixelSpacing) {\n      suffix = ' pixels';\n    }\n\n    // Store the length measurement text\n    const text = `${length.toFixed(2)}${suffix}`;\n\n    if (!data.handles.textBox.hasMoved) {\n      const coords = {\n        x: Math.max(data.handles.start.x, data.handles.end.x)\n      };\n\n      // Depending on which handle has the largest x-value,\n      // Set the y-value for the text box\n      if (coords.x === data.handles.start.x) {\n        coords.y = data.handles.start.y;\n      } else {\n        coords.y = data.handles.end.y;\n      }\n\n      data.handles.textBox.x = coords.x;\n      data.handles.textBox.y = coords.y;\n    }\n\n    const textCoords = cornerstone.pixelToCanvas(eventData.element, data.handles.textBox);\n\n    // Move the textbox slightly to the right and upwards\n    // So that it sits beside the length tool handle\n    textCoords.x += 10;\n\n    const options = {\n      centering: {\n        x: false,\n        y: true\n      }\n    };\n\n    // Draw the textbox\n    const boundingBox = drawTextBox(context, text, textCoords.x, textCoords.y, color, options);\n\n    data.handles.textBox.boundingBox = boundingBox;\n\n    if (data.handles.textBox.hasMoved) {\n      // Draw dashed link line between ellipse and text\n      const link = {\n        start: {},\n        end: {}\n      };\n\n      const midpointCanvas = {\n        x: (handleStartCanvas.x + handleEndCanvas.x) / 2,\n        y: (handleStartCanvas.y + handleEndCanvas.y) / 2\n      };\n\n      const points = [handleStartCanvas, handleEndCanvas, midpointCanvas];\n\n      link.end.x = textCoords.x;\n      link.end.y = textCoords.y;\n\n      link.start = external.cornerstoneMath.point.findClosestPoint(points, link.end);\n\n      const boundingBoxPoints = [{\n        // Top middle point of bounding box\n        x: boundingBox.left + boundingBox.width / 2,\n        y: boundingBox.top\n      }, {\n        // Left middle point of bounding box\n        x: boundingBox.left,\n        y: boundingBox.top + boundingBox.height / 2\n      }, {\n        // Bottom middle point of bounding box\n        x: boundingBox.left + boundingBox.width / 2,\n        y: boundingBox.top + boundingBox.height\n      }, {\n        // Right middle point of bounding box\n        x: boundingBox.left + boundingBox.width,\n        y: boundingBox.top + boundingBox.height / 2\n      }\n      ];\n\n      link.end = external.cornerstoneMath.point.findClosestPoint(boundingBoxPoints, link.start);\n\n      context.beginPath();\n      context.strokeStyle = color;\n      context.lineWidth = lineWidth;\n      context.setLineDash([2, 3]);\n      context.moveTo(link.start.x, link.start.y);\n      context.lineTo(link.end.x, link.end.y);\n      context.stroke();\n    }\n\n    context.restore();\n  }\n}\n// /////// END IMAGE RENDERING ///////\n\n// Module exports\nconst length = mouseButtonTool({\n  createNewMeasurement,\n  onImageRendered,\n  pointNearTool,\n  toolType\n});\n\nconst lengthTouch = touchTool({\n  createNewMeasurement,\n  onImageRendered,\n  pointNearTool,\n  toolType\n});\n\nexport {\n  length,\n  lengthTouch\n};\n\n\n\n// WEBPACK FOOTER //\n// ./tools/image/length.js","import EVENTS from '@/events.js';\nimport external from '@/externalModules.js';\nimport { touchDragTool } from '@tools/base/index.js';\nimport { getBrowserInfo } from '@/util/getMaxSimultaneousRequests.js';\nimport isMouseButtonEnabled from '@/util/isMouseButtonEnabled.js';\nimport { setToolOptions, getToolOptions } from '@/toolOptions.js';\n\nconst toolType = 'magnify';\n\nlet configuration = {\n  magnifySize: 100,\n  magnificationLevel: 2\n};\n\nlet browserName;\n\nlet currentPoints;\n\n/** Remove the magnifying glass when the mouse event ends */\nfunction mouseUpCallback (e) {\n  const eventData = e.detail;\n  const element = eventData.element;\n\n  element.removeEventListener(EVENTS.MOUSE_DRAG, dragCallback);\n  element.removeEventListener(EVENTS.MOUSE_UP, mouseUpCallback);\n  element.removeEventListener(EVENTS.MOUSE_CLICK, mouseUpCallback);\n  element.removeEventListener(EVENTS.NEW_IMAGE, newImageCallback);\n  hideTool(eventData);\n}\n\nfunction hideTool (eventData) {\n  const element = eventData.element;\n\n  element.querySelector('.magnifyTool').style.display = 'none';\n\n  // Re-enable the mouse cursor\n  document.body.style.cursor = 'default';\n}\n\n/** Draw the magnifying glass on mouseDown, and begin tracking mouse movements */\nfunction mouseDownCallback (e) {\n  const eventData = e.detail;\n  const element = eventData.element;\n  const options = getToolOptions(toolType, element);\n\n  if (isMouseButtonEnabled(eventData.which, options.mouseButtonMask)) {\n    element.addEventListener(EVENTS.MOUSE_DRAG, dragCallback);\n    element.addEventListener(EVENTS.MOUSE_UP, mouseUpCallback);\n    element.addEventListener(EVENTS.MOUSE_CLICK, mouseUpCallback);\n\n    currentPoints = eventData.currentPoints;\n    element.addEventListener(EVENTS.NEW_IMAGE, newImageCallback);\n    drawMagnificationTool(eventData);\n\n    e.preventDefault();\n    e.stopPropagation();\n  }\n}\n\nfunction newImageCallback (e) {\n  const eventData = e.detail;\n\n  eventData.currentPoints = currentPoints;\n  drawMagnificationTool(eventData);\n}\n\nfunction dragEndCallback (e) {\n  const eventData = e.detail;\n  const element = eventData.element;\n\n  element.removeEventListener(EVENTS.TOUCH_DRAG_END, dragEndCallback);\n  element.removeEventListener(EVENTS.TOUCH_END, dragEndCallback);\n  element.removeEventListener(EVENTS.NEW_IMAGE, newImageCallback);\n  hideTool(eventData);\n}\n\n/** Drag callback is triggered by both the touch and mouse magnify tools */\nfunction dragCallback (e) {\n  const eventData = e.detail;\n  const element = eventData.element;\n\n  currentPoints = eventData.currentPoints;\n\n  drawMagnificationTool(eventData);\n  if (eventData.isTouchEvent === true) {\n    element.addEventListener(EVENTS.TOUCH_DRAG_END, dragEndCallback);\n    element.addEventListener(EVENTS.TOUCH_END, dragEndCallback);\n  }\n\n  e.preventDefault();\n  e.stopPropagation();\n}\n\n/** Draws the magnifying glass */\nfunction drawMagnificationTool (eventData) {\n  const element = eventData.element;\n  const magnifyCanvas = element.querySelector('.magnifyTool');\n\n  if (!magnifyCanvas) {\n    createMagnificationCanvas(eventData.element);\n  }\n\n  const config = magnify.getConfiguration();\n\n  const magnifySize = config.magnifySize;\n  const magnificationLevel = config.magnificationLevel;\n\n  // The 'not' magnifyTool class here is necessary because cornerstone places\n  // No classes of it's own on the canvas we want to select\n  const canvas = element.querySelector('canvas:not(.magnifyTool)');\n  const context = canvas.getContext('2d');\n\n  context.setTransform(1, 0, 0, 1, 0, 0);\n\n  const zoomCtx = magnifyCanvas.getContext('2d');\n\n  zoomCtx.setTransform(1, 0, 0, 1, 0, 0);\n\n  const getSize = magnifySize / magnificationLevel;\n\n  // Calculate the on-canvas location of the mouse pointer / touch\n  const canvasLocation = external.cornerstone.pixelToCanvas(eventData.element, eventData.currentPoints.image);\n\n  if (eventData.isTouchEvent === true) {\n    canvasLocation.y -= 1.25 * getSize;\n  }\n\n  canvasLocation.x = Math.max(canvasLocation.x, 0);\n  canvasLocation.x = Math.min(canvasLocation.x, canvas.width);\n\n  canvasLocation.y = Math.max(canvasLocation.y, 0);\n  canvasLocation.y = Math.min(canvasLocation.y, canvas.height);\n\n  // Clear the rectangle\n  zoomCtx.clearRect(0, 0, magnifySize, magnifySize);\n  zoomCtx.fillStyle = 'transparent';\n\n  // Fill it with the pixels that the mouse is clicking on\n  zoomCtx.fillRect(0, 0, magnifySize, magnifySize);\n\n  const copyFrom = {\n    x: canvasLocation.x - 0.5 * getSize,\n    y: canvasLocation.y - 0.5 * getSize\n  };\n\n  if (browserName === 'Safari') {\n    // Safari breaks when trying to copy pixels with negative indices\n    // This prevents proper Magnify usage\n    copyFrom.x = Math.max(copyFrom.x, 0);\n    copyFrom.y = Math.max(copyFrom.y, 0);\n  }\n\n  copyFrom.x = Math.min(copyFrom.x, canvas.width);\n  copyFrom.y = Math.min(copyFrom.y, canvas.height);\n\n  const scaledMagnify = {\n    x: (canvas.width - copyFrom.x) * magnificationLevel,\n    y: (canvas.height - copyFrom.y) * magnificationLevel\n  };\n\n  zoomCtx.drawImage(canvas, copyFrom.x, copyFrom.y, canvas.width - copyFrom.x, canvas.height - copyFrom.y, 0, 0, scaledMagnify.x, scaledMagnify.y);\n\n  // Place the magnification tool at the same location as the pointer\n  magnifyCanvas.style.top = `${canvasLocation.y - 0.5 * magnifySize}px`;\n  magnifyCanvas.style.left = `${canvasLocation.x - 0.5 * magnifySize}px`;\n\n  magnifyCanvas.style.display = 'block';\n\n  // Hide the mouse cursor, so the user can see better\n  document.body.style.cursor = 'none';\n}\n\n/** Creates the magnifying glass canvas */\nfunction createMagnificationCanvas (element) {\n  // If the magnifying glass canvas doesn't already exist\n  if (element.querySelector('.magnifyTool') === null) {\n    // Create a canvas and append it as a child to the element\n    const magnifyCanvas = document.createElement('canvas');\n    // The magnifyTool class is used to find the canvas later on\n\n    magnifyCanvas.classList.add('magnifyTool');\n\n    const config = magnify.getConfiguration();\n\n    magnifyCanvas.width = config.magnifySize;\n    magnifyCanvas.height = config.magnifySize;\n\n    // Make sure position is absolute so the canvas can follow the mouse / touch\n    magnifyCanvas.style.position = 'absolute';\n    element.appendChild(magnifyCanvas);\n  }\n}\n\n/** Find the magnifying glass canvas and remove it */\nfunction removeMagnificationCanvas (element) {\n  const magnifyCanvas = element.querySelector('.magnifyTool');\n\n  if (magnifyCanvas) {\n    element.removeChild(magnifyCanvas);\n  }\n}\n\n// --- Mouse tool activate / disable --- //\nfunction disable (element) {\n  element.removeEventListener(EVENTS.MOUSE_DOWN, mouseDownCallback);\n  removeMagnificationCanvas(element);\n}\n\nfunction enable (element) {\n  if (!browserName) {\n    const infoString = getBrowserInfo();\n    const info = infoString.split(' ');\n\n    browserName = info[0];\n  }\n\n  createMagnificationCanvas(element);\n}\n\nfunction activate (element, mouseButtonMask) {\n  setToolOptions(toolType, element, { mouseButtonMask });\n\n  element.removeEventListener(EVENTS.MOUSE_DOWN, mouseDownCallback);\n\n  element.addEventListener(EVENTS.MOUSE_DOWN, mouseDownCallback);\n  createMagnificationCanvas(element);\n}\n\n// --- Touch tool activate / disable --- //\nfunction getConfiguration () {\n  return configuration;\n}\n\nfunction setConfiguration (config) {\n  configuration = config;\n}\n\n// Module exports\nconst magnify = {\n  enable,\n  activate,\n  deactivate: disable,\n  disable,\n  getConfiguration,\n  setConfiguration\n};\n\nconst options = {\n  fireOnTouchStart: true,\n  activateCallback: createMagnificationCanvas,\n  disableCallback: removeMagnificationCanvas\n};\n\nconst magnifyTouchDrag = touchDragTool(dragCallback, toolType, options);\n\nexport {\n  magnify,\n  magnifyTouchDrag\n};\n\n\n\n// WEBPACK FOOTER //\n// ./tools/image/magnify.js","import external from '@/externalModules.js';\nimport orientation from '@/orientation/index.js';\nimport displayTool from './displayTool.js';\nimport toolColors from '@/stateManagement/toolColors.js';\nimport drawTextBox from '@/util/drawTextBox.js';\n\nfunction getOrientationMarkers (element) {\n  const cornerstone = external.cornerstone;\n  const enabledElement = cornerstone.getEnabledElement(element);\n  const imagePlaneMetaData = cornerstone.metaData.get('imagePlaneModule', enabledElement.image.imageId);\n\n  if (!imagePlaneMetaData || !imagePlaneMetaData.rowCosines || !imagePlaneMetaData.columnCosines) {\n    return;\n  }\n\n  const rowString = orientation.getOrientationString(imagePlaneMetaData.rowCosines);\n  const columnString = orientation.getOrientationString(imagePlaneMetaData.columnCosines);\n\n  const oppositeRowString = orientation.invertOrientationString(rowString);\n  const oppositeColumnString = orientation.invertOrientationString(columnString);\n\n  return {\n    top: oppositeColumnString,\n    bottom: columnString,\n    left: oppositeRowString,\n    right: rowString\n  };\n}\n\nfunction getOrientationMarkerPositions (element) {\n  const cornerstone = external.cornerstone;\n  const enabledElement = cornerstone.getEnabledElement(element);\n  let coords;\n\n  coords = {\n    x: enabledElement.image.width / 2,\n    y: 5\n  };\n  const top = cornerstone.pixelToCanvas(element, coords);\n\n  coords = {\n    x: enabledElement.image.width / 2,\n    y: enabledElement.image.height - 5\n  };\n  const bottom = cornerstone.pixelToCanvas(element, coords);\n\n  coords = {\n    x: 5,\n    y: enabledElement.image.height / 2\n  };\n  const left = cornerstone.pixelToCanvas(element, coords);\n\n  coords = {\n    x: enabledElement.image.width - 10,\n    y: enabledElement.image.height / 2\n  };\n  const right = cornerstone.pixelToCanvas(element, coords);\n\n  return {\n    top,\n    bottom,\n    left,\n    right\n  };\n}\n\nfunction onImageRendered (e) {\n  const eventData = e.detail;\n  const element = eventData.element;\n\n  const markers = getOrientationMarkers(element);\n\n  if (!markers) {\n    return;\n  }\n\n  const coords = getOrientationMarkerPositions(element, markers);\n\n  const context = eventData.canvasContext.canvas.getContext('2d');\n\n  context.setTransform(1, 0, 0, 1, 0, 0);\n\n  const color = toolColors.getToolColor();\n\n  const textWidths = {\n    top: context.measureText(markers.top).width,\n    left: context.measureText(markers.left).width,\n    right: context.measureText(markers.right).width,\n    bottom: context.measureText(markers.bottom).width\n  };\n\n  drawTextBox(context, markers.top, coords.top.x - textWidths.top / 2, coords.top.y, color);\n  drawTextBox(context, markers.left, coords.left.x - textWidths.left / 2, coords.left.y, color);\n\n  const config = orientationMarkers.getConfiguration();\n\n  if (config && config.drawAllMarkers) {\n    drawTextBox(context, markers.right, coords.right.x - textWidths.right / 2, coords.right.y, color);\n    drawTextBox(context, markers.bottom, coords.bottom.x - textWidths.bottom / 2, coords.bottom.y, color);\n  }\n}\n// /////// END IMAGE RENDERING ///////\n\n// Module exports\nconst orientationMarkers = displayTool(onImageRendered);\n\nexport default orientationMarkers;\n\n\n\n// WEBPACK FOOTER //\n// ./tools/image/orientationMarkers.js","import EVENTS from '@/events.js';\nimport external from '@/externalModules.js';\nimport { simpleMouseButtonTool, touchDragTool } from '@tools/base/index.js';\nimport isMouseButtonEnabled from '@/util/isMouseButtonEnabled.js';\nimport { getToolOptions } from '@/toolOptions.js';\n\nconst toolType = 'pan';\n\nfunction mouseUpCallback (e) {\n  const eventData = e.detail;\n  const element = eventData.element;\n\n  element.removeEventListener(EVENTS.MOUSE_DRAG, dragCallback);\n  element.removeEventListener(EVENTS.MOUSE_UP, mouseUpCallback);\n  element.removeEventListener(EVENTS.MOUSE_CLICK, mouseUpCallback);\n}\n\nfunction mouseDownCallback (e) {\n  const eventData = e.detail;\n  const element = eventData.element;\n  const options = getToolOptions(toolType, element);\n\n  if (isMouseButtonEnabled(eventData.which, options.mouseButtonMask)) {\n    element.addEventListener(EVENTS.MOUSE_DRAG, dragCallback);\n    element.addEventListener(EVENTS.MOUSE_UP, mouseUpCallback);\n    element.addEventListener(EVENTS.MOUSE_CLICK, mouseUpCallback);\n\n    e.preventDefault();\n    e.stopPropagation();\n  }\n}\n\nfunction dragCallback (e) {\n  const eventData = e.detail;\n\n  // FIXME: Copied from Cornerstone src/internal/calculateTransform.js, should be exposed from there.\n  let widthScale = eventData.viewport.scale;\n  let heightScale = eventData.viewport.scale;\n\n  if (eventData.image.rowPixelSpacing < eventData.image.columnPixelSpacing) {\n    widthScale *= (eventData.image.columnPixelSpacing / eventData.image.rowPixelSpacing);\n  } else if (eventData.image.columnPixelSpacing < eventData.image.rowPixelSpacing) {\n    heightScale *= (eventData.image.rowPixelSpacing / eventData.image.columnPixelSpacing);\n  }\n\n  eventData.viewport.translation.x += (eventData.deltaPoints.page.x / widthScale);\n  eventData.viewport.translation.y += (eventData.deltaPoints.page.y / heightScale);\n  external.cornerstone.setViewport(eventData.element, eventData.viewport);\n\n  e.preventDefault();\n  e.stopPropagation();\n}\n\nconst pan = simpleMouseButtonTool(mouseDownCallback, toolType);\nconst panTouchDrag = touchDragTool(dragCallback, toolType);\n\nexport {\n  pan,\n  panTouchDrag\n};\n\n\n\n// WEBPACK FOOTER //\n// ./tools/image/pan.js","import external from '@/externalModules.js';\nimport { multiTouchDragTool } from '@tools/base/index.js';\n\nfunction touchPanCallback (e) {\n  const eventData = e.detail;\n  const config = panMultiTouch.getConfiguration();\n\n  if (config && config.testPointers(eventData)) {\n    eventData.viewport.translation.x += (eventData.deltaPoints.page.x / eventData.viewport.scale);\n    eventData.viewport.translation.y += (eventData.deltaPoints.page.y / eventData.viewport.scale);\n    external.cornerstone.setViewport(eventData.element, eventData.viewport);\n\n    e.preventDefault();\n    e.stopPropagation();\n  }\n}\n\nconst configuration = {\n  testPointers (eventData) {\n    return (eventData.numPointers >= 2);\n  }\n};\n\nconst panMultiTouch = multiTouchDragTool(touchPanCallback);\n\npanMultiTouch.setConfiguration(configuration);\n\nexport default panMultiTouch;\n\n\n\n// WEBPACK FOOTER //\n// ./tools/image/panMultiTouch.js","import external from '@/externalModules.js';\nimport { mouseButtonTool, touchTool } from '@tools/base/index.js';\nimport toolColors from '@/stateManagement/toolColors.js';\nimport textStyle from '@/stateManagement/textStyle.js';\nimport drawHandles from '@/manipulators/drawHandles.js';\nimport drawTextBox from '@/util/drawTextBox.js';\nimport getRGBPixels from '@/util/getRGBPixels.js';\nimport calculateSUV from '@/util/calculateSUV.js';\nimport { getToolState } from '@/stateManagement/toolState.js';\n\nconst toolType = 'probe';\n\n// /////// BEGIN ACTIVE TOOL ///////\nfunction createNewMeasurement (mouseEventData) {\n  // Create the measurement data for this tool with the end handle activated\n  const measurementData = {\n    visible: true,\n    active: true,\n    handles: {\n      end: {\n        x: mouseEventData.currentPoints.image.x,\n        y: mouseEventData.currentPoints.image.y,\n        highlight: true,\n        active: true\n      }\n    }\n  };\n\n\n  return measurementData;\n}\n// /////// END ACTIVE TOOL ///////\n\n// /////// BEGIN IMAGE RENDERING ///////\nfunction pointNearTool (element, data, coords) {\n  const endCanvas = external.cornerstone.pixelToCanvas(element, data.handles.end);\n\n\n  return external.cornerstoneMath.point.distance(endCanvas, coords) < 5;\n}\n\nfunction onImageRendered (e) {\n  const eventData = e.detail;\n\n  // If we have no toolData for this element, return immediately as there is nothing to do\n  const toolData = getToolState(e.currentTarget, toolType);\n\n  if (!toolData) {\n    return;\n  }\n\n  const cornerstone = external.cornerstone;\n  // We have tool data for this element - iterate over each one and draw it\n  const context = eventData.canvasContext.canvas.getContext('2d');\n\n  context.setTransform(1, 0, 0, 1, 0, 0);\n\n  let color;\n  const font = textStyle.getFont();\n  const fontHeight = textStyle.getFontSize();\n\n  for (let i = 0; i < toolData.data.length; i++) {\n\n    context.save();\n    const data = toolData.data[i];\n\n    if (data.active) {\n      color = toolColors.getActiveColor();\n    } else {\n      color = toolColors.getToolColor();\n    }\n\n    // Draw the handles\n    drawHandles(context, eventData, data.handles, color);\n\n    const x = Math.round(data.handles.end.x);\n    const y = Math.round(data.handles.end.y);\n    let storedPixels;\n\n    let text,\n      str;\n\n    if (x < 0 || y < 0 || x >= eventData.image.columns || y >= eventData.image.rows) {\n      return;\n    }\n\n    if (eventData.image.color) {\n      text = `${x}, ${y}`;\n      storedPixels = getRGBPixels(eventData.element, x, y, 1, 1);\n      str = `R: ${storedPixels[0]} G: ${storedPixels[1]} B: ${storedPixels[2]}`;\n    } else {\n      storedPixels = cornerstone.getStoredPixels(eventData.element, x, y, 1, 1);\n      const sp = storedPixels[0];\n      const mo = sp * eventData.image.slope + eventData.image.intercept;\n      const suv = calculateSUV(eventData.image, sp);\n\n      // Draw text\n      text = `${x}, ${y}`;\n      str = `SP: ${sp} MO: ${parseFloat(mo.toFixed(3))}`;\n      if (suv) {\n        str += ` SUV: ${parseFloat(suv.toFixed(3))}`;\n      }\n    }\n\n    const coords = {\n      // Translate the x/y away from the cursor\n      x: data.handles.end.x + 3,\n      y: data.handles.end.y - 3\n    };\n    const textCoords = cornerstone.pixelToCanvas(eventData.element, coords);\n\n    context.font = font;\n    context.fillStyle = color;\n\n    drawTextBox(context, str, textCoords.x, textCoords.y + fontHeight + 5, color);\n    drawTextBox(context, text, textCoords.x, textCoords.y, color);\n    context.restore();\n  }\n}\n// /////// END IMAGE RENDERING ///////\n\n// Module exports\nconst probe = mouseButtonTool({\n  createNewMeasurement,\n  onImageRendered,\n  pointNearTool,\n  toolType\n});\n\nconst probeTouch = touchTool({\n  createNewMeasurement,\n  onImageRendered,\n  pointNearTool,\n  toolType\n});\n\nexport {\n  probe,\n  probeTouch\n};\n\n\n\n// WEBPACK FOOTER //\n// ./tools/image/probe.js","import external from '@/externalModules.js';\nimport { mouseButtonTool, touchTool } from '@tools/base/index.js';\nimport toolStyle from '@/stateManagement/toolStyle.js';\nimport toolColors from '@/stateManagement/toolColors.js';\nimport drawHandles from '@/manipulators/drawHandles.js';\nimport drawTextBox from '@/util/drawTextBox.js';\nimport calculateSUV from '@/util/calculateSUV.js';\nimport { getToolState } from '@/stateManagement/toolState.js';\n\nconst toolType = 'rectangleRoi';\n\n// /////// BEGIN ACTIVE TOOL ///////\nfunction createNewMeasurement (mouseEventData) {\n  // Create the measurement data for this tool with the end handle activated\n  const measurementData = {\n    visible: true,\n    active: true,\n    invalidated: true,\n    handles: {\n      start: {\n        x: mouseEventData.currentPoints.image.x,\n        y: mouseEventData.currentPoints.image.y,\n        highlight: true,\n        active: false\n      },\n      end: {\n        x: mouseEventData.currentPoints.image.x,\n        y: mouseEventData.currentPoints.image.y,\n        highlight: true,\n        active: true\n      },\n      textBox: {\n        active: false,\n        hasMoved: false,\n        movesIndependently: false,\n        drawnIndependently: true,\n        allowedOutsideImage: true,\n        hasBoundingBox: true\n      }\n    }\n  };\n\n  return measurementData;\n}\n// /////// END ACTIVE TOOL ///////\n\nfunction pointNearTool (element, data, coords) {\n  const cornerstone = external.cornerstone;\n  const startCanvas = cornerstone.pixelToCanvas(element, data.handles.start);\n  const endCanvas = cornerstone.pixelToCanvas(element, data.handles.end);\n\n  const rect = {\n    left: Math.min(startCanvas.x, endCanvas.x),\n    top: Math.min(startCanvas.y, endCanvas.y),\n    width: Math.abs(startCanvas.x - endCanvas.x),\n    height: Math.abs(startCanvas.y - endCanvas.y)\n  };\n\n  const distanceToPoint = external.cornerstoneMath.rect.distanceToPoint(rect, coords);\n\n\n  return (distanceToPoint < 5);\n}\n\n// /////// BEGIN IMAGE RENDERING ///////\n\nfunction calculateMeanStdDev (sp, ellipse) {\n  // TODO: Get a real statistics library here that supports large counts\n\n  let sum = 0;\n  let sumSquared = 0;\n  let count = 0;\n  let index = 0;\n\n  for (let y = ellipse.top; y < ellipse.top + ellipse.height; y++) {\n    for (let x = ellipse.left; x < ellipse.left + ellipse.width; x++) {\n      sum += sp[index];\n      sumSquared += sp[index] * sp[index];\n      count++;\n      index++;\n    }\n  }\n\n  if (count === 0) {\n    return {\n      count,\n      mean: 0.0,\n      variance: 0.0,\n      stdDev: 0.0\n    };\n  }\n\n  const mean = sum / count;\n  const variance = sumSquared / count - mean * mean;\n\n  return {\n    count,\n    mean,\n    variance,\n    stdDev: Math.sqrt(variance)\n  };\n}\n\nfunction numberWithCommas (x) {\n  // http://stackoverflow.com/questions/2901102/how-to-print-a-number-with-commas-as-thousands-separators-in-javascript\n  const parts = x.toString().split('.');\n\n  parts[0] = parts[0].replace(/\\B(?=(\\d{3})+(?!\\d))/g, ',');\n\n  return parts.join('.');\n}\n\nfunction onImageRendered (e) {\n  const eventData = e.detail;\n\n  // If we have no toolData for this element, return immediately as there is nothing to do\n  const toolData = getToolState(e.currentTarget, toolType);\n\n  if (!toolData) {\n    return;\n  }\n\n  const cornerstone = external.cornerstone;\n  const image = eventData.image;\n  const element = eventData.element;\n  const lineWidth = toolStyle.getToolWidth();\n  const config = rectangleRoi.getConfiguration();\n  const context = eventData.canvasContext.canvas.getContext('2d');\n  const seriesModule = cornerstone.metaData.get('generalSeriesModule', image.imageId);\n  let modality;\n\n  if (seriesModule) {\n    modality = seriesModule.modality;\n  }\n\n  context.setTransform(1, 0, 0, 1, 0, 0);\n\n  // If we have tool data for this element - iterate over each set and draw it\n  for (let i = 0; i < toolData.data.length; i++) {\n    context.save();\n\n    const data = toolData.data[i];\n\n    // Apply any shadow settings defined in the tool configuration\n    if (config && config.shadow) {\n      context.shadowColor = config.shadowColor || '#000000';\n      context.shadowOffsetX = config.shadowOffsetX || 1;\n      context.shadowOffsetY = config.shadowOffsetY || 1;\n    }\n\n    // Check which color the rendered tool should be\n    const color = toolColors.getColorIfActive(data.active);\n\n    // Convert Image coordinates to Canvas coordinates given the element\n    const handleStartCanvas = cornerstone.pixelToCanvas(element, data.handles.start);\n    const handleEndCanvas = cornerstone.pixelToCanvas(element, data.handles.end);\n\n    // Retrieve the bounds of the ellipse (left, top, width, and height)\n    // In Canvas coordinates\n    const leftCanvas = Math.min(handleStartCanvas.x, handleEndCanvas.x);\n    const topCanvas = Math.min(handleStartCanvas.y, handleEndCanvas.y);\n    const widthCanvas = Math.abs(handleStartCanvas.x - handleEndCanvas.x);\n    const heightCanvas = Math.abs(handleStartCanvas.y - handleEndCanvas.y);\n\n    // Draw the rectangle on the canvas\n    context.beginPath();\n    context.strokeStyle = color;\n    context.lineWidth = lineWidth;\n    context.rect(leftCanvas, topCanvas, widthCanvas, heightCanvas);\n    context.stroke();\n\n    // If the tool configuration specifies to only draw the handles on hover / active,\n    // Follow this logic\n    if (config && config.drawHandlesOnHover) {\n      // Draw the handles if the tool is active\n      if (data.active === true) {\n        drawHandles(context, eventData, data.handles, color);\n      } else {\n        // If the tool is inactive, draw the handles only if each specific handle is being\n        // Hovered over\n        const handleOptions = {\n          drawHandlesIfActive: true\n        };\n\n        drawHandles(context, eventData, data.handles, color, handleOptions);\n      }\n    } else {\n      // If the tool has no configuration settings, always draw the handles\n      drawHandles(context, eventData, data.handles, color);\n    }\n\n    // Define variables for the area and mean/standard deviation\n    let area,\n      meanStdDev,\n      meanStdDevSUV;\n\n    // Perform a check to see if the tool has been invalidated. This is to prevent\n    // Unnecessary re-calculation of the area, mean, and standard deviation if the\n    // Image is re-rendered but the tool has not moved (e.g. during a zoom)\n    if (data.invalidated === false) {\n      // If the data is not invalidated, retrieve it from the toolData\n      meanStdDev = data.meanStdDev;\n      meanStdDevSUV = data.meanStdDevSUV;\n      area = data.area;\n    } else {\n      // If the data has been invalidated, we need to calculate it again\n\n      // Retrieve the bounds of the ellipse in image coordinates\n      const ellipse = {\n        left: Math.min(data.handles.start.x, data.handles.end.x),\n        top: Math.min(data.handles.start.y, data.handles.end.y),\n        width: Math.abs(data.handles.start.x - data.handles.end.x),\n        height: Math.abs(data.handles.start.y - data.handles.end.y)\n      };\n\n      // First, make sure this is not a color image, since no mean / standard\n      // Deviation will be calculated for color images.\n      if (!image.color) {\n        // Retrieve the array of pixels that the ellipse bounds cover\n        const pixels = cornerstone.getPixels(element, ellipse.left, ellipse.top, ellipse.width, ellipse.height);\n\n        // Calculate the mean & standard deviation from the pixels and the ellipse details\n        meanStdDev = calculateMeanStdDev(pixels, ellipse);\n\n        if (modality === 'PT') {\n          // If the image is from a PET scan, use the DICOM tags to\n          // Calculate the SUV from the mean and standard deviation.\n\n          // Note that because we are using modality pixel values from getPixels, and\n          // The calculateSUV routine also rescales to modality pixel values, we are first\n          // Returning the values to storedPixel values before calcuating SUV with them.\n          // TODO: Clean this up? Should we add an option to not scale in calculateSUV?\n          meanStdDevSUV = {\n            mean: calculateSUV(image, (meanStdDev.mean - image.intercept) / image.slope),\n            stdDev: calculateSUV(image, (meanStdDev.stdDev - image.intercept) / image.slope)\n          };\n        }\n\n        // If the mean and standard deviation values are sane, store them for later retrieval\n        if (meanStdDev && !isNaN(meanStdDev.mean)) {\n          data.meanStdDev = meanStdDev;\n          data.meanStdDevSUV = meanStdDevSUV;\n        }\n      }\n\n      // Retrieve the pixel spacing values, and if they are not\n      // Real non-zero values, set them to 1\n      const columnPixelSpacing = image.columnPixelSpacing || 1;\n      const rowPixelSpacing = image.rowPixelSpacing || 1;\n\n      // Calculate the image area from the ellipse dimensions and pixel spacing\n      area = (ellipse.width * columnPixelSpacing) * (ellipse.height * rowPixelSpacing);\n\n      // If the area value is sane, store it for later retrieval\n      if (!isNaN(area)) {\n        data.area = area;\n      }\n\n      // Set the invalidated flag to false so that this data won't automatically be recalculated\n      data.invalidated = false;\n    }\n\n    // Define an array to store the rows of text for the textbox\n    const textLines = [];\n\n    // If the mean and standard deviation values are present, display them\n    if (meanStdDev && meanStdDev.mean) {\n      // If the modality is CT, add HU to denote Hounsfield Units\n      let moSuffix = '';\n\n      if (modality === 'CT') {\n        moSuffix = ' HU';\n      }\n\n      // Create a line of text to display the mean and any units that were specified (i.e. HU)\n      let meanText = `Mean: ${numberWithCommas(meanStdDev.mean.toFixed(2))}${moSuffix}`;\n      // Create a line of text to display the standard deviation and any units that were specified (i.e. HU)\n      let stdDevText = `StdDev: ${numberWithCommas(meanStdDev.stdDev.toFixed(2))}${moSuffix}`;\n\n      // If this image has SUV values to display, concatenate them to the text line\n      if (meanStdDevSUV && meanStdDevSUV.mean !== undefined) {\n        const SUVtext = ' SUV: ';\n\n        meanText += SUVtext + numberWithCommas(meanStdDevSUV.mean.toFixed(2));\n        stdDevText += SUVtext + numberWithCommas(meanStdDevSUV.stdDev.toFixed(2));\n      }\n\n      // Add these text lines to the array to be displayed in the textbox\n      textLines.push(meanText);\n      textLines.push(stdDevText);\n    }\n\n    // If the area is a sane value, display it\n    if (area) {\n      // Determine the area suffix based on the pixel spacing in the image.\n      // If pixel spacing is present, use millimeters. Otherwise, use pixels.\n      // This uses Char code 178 for a superscript 2\n      let suffix = ` mm${String.fromCharCode(178)}`;\n\n      if (!image.rowPixelSpacing || !image.columnPixelSpacing) {\n        suffix = ` pixels${String.fromCharCode(178)}`;\n      }\n\n      // Create a line of text to display the area and its units\n      const areaText = `Area: ${numberWithCommas(area.toFixed(2))}${suffix}`;\n\n      // Add this text line to the array to be displayed in the textbox\n      textLines.push(areaText);\n    }\n\n    // If the textbox has not been moved by the user, it should be displayed on the right-most\n    // Side of the tool.\n    if (!data.handles.textBox.hasMoved) {\n      // Find the rightmost side of the ellipse at its vertical center, and place the textbox here\n      // Note that this calculates it in image coordinates\n      data.handles.textBox.x = Math.max(data.handles.start.x, data.handles.end.x);\n      data.handles.textBox.y = (data.handles.start.y + data.handles.end.y) / 2;\n    }\n\n    // Convert the textbox Image coordinates into Canvas coordinates\n    const textCoords = cornerstone.pixelToCanvas(element, data.handles.textBox);\n\n    // Set options for the textbox drawing function\n    const options = {\n      centering: {\n        x: false,\n        y: true\n      }\n    };\n\n    // Draw the textbox and retrieves it's bounding box for mouse-dragging and highlighting\n    const boundingBox = drawTextBox(context, textLines, textCoords.x,\n      textCoords.y, color, options);\n\n    // Store the bounding box data in the handle for mouse-dragging and highlighting\n    data.handles.textBox.boundingBox = boundingBox;\n\n    // If the textbox has moved, we would like to draw a line linking it with the tool\n    // This section decides where to draw this line to on the Ellipse based on the location\n    // Of the textbox relative to the ellipse.\n    if (data.handles.textBox.hasMoved) {\n      // Draw dashed link line between tool and text\n\n      // The initial link position is at the center of the\n      // Textbox.\n      const link = {\n        start: {},\n        end: {\n          x: textCoords.x,\n          y: textCoords.y\n        }\n      };\n\n      // First we calculate the ellipse points (top, left, right, and bottom)\n      const ellipsePoints = [{\n        // Top middle point of ellipse\n        x: leftCanvas + widthCanvas / 2,\n        y: topCanvas\n      }, {\n        // Left middle point of ellipse\n        x: leftCanvas,\n        y: topCanvas + heightCanvas / 2\n      }, {\n        // Bottom middle point of ellipse\n        x: leftCanvas + widthCanvas / 2,\n        y: topCanvas + heightCanvas\n      }, {\n        // Right middle point of ellipse\n        x: leftCanvas + widthCanvas,\n        y: topCanvas + heightCanvas / 2\n      }];\n\n      // We obtain the link starting point by finding the closest point on the ellipse to the\n      // Center of the textbox\n      link.start = external.cornerstoneMath.point.findClosestPoint(ellipsePoints, link.end);\n\n      // Next we calculate the corners of the textbox bounding box\n      const boundingBoxPoints = [{\n        // Top middle point of bounding box\n        x: boundingBox.left + boundingBox.width / 2,\n        y: boundingBox.top\n      }, {\n        // Left middle point of bounding box\n        x: boundingBox.left,\n        y: boundingBox.top + boundingBox.height / 2\n      }, {\n        // Bottom middle point of bounding box\n        x: boundingBox.left + boundingBox.width / 2,\n        y: boundingBox.top + boundingBox.height\n      }, {\n        // Right middle point of bounding box\n        x: boundingBox.left + boundingBox.width,\n        y: boundingBox.top + boundingBox.height / 2\n      }];\n\n      // Now we recalculate the link endpoint by identifying which corner of the bounding box\n      // Is closest to the start point we just calculated.\n      link.end = external.cornerstoneMath.point.findClosestPoint(boundingBoxPoints, link.start);\n\n      // Finally we draw the dashed linking line\n      context.beginPath();\n      context.strokeStyle = color;\n      context.lineWidth = lineWidth;\n      context.setLineDash([2, 3]);\n      context.moveTo(link.start.x, link.start.y);\n      context.lineTo(link.end.x, link.end.y);\n      context.stroke();\n    }\n\n    context.restore();\n  }\n}\n// /////// END IMAGE RENDERING ///////\n\n// Module exports\nconst rectangleRoi = mouseButtonTool({\n  createNewMeasurement,\n  onImageRendered,\n  pointNearTool,\n  toolType\n});\n\nconst rectangleRoiTouch = touchTool({\n  createNewMeasurement,\n  onImageRendered,\n  pointNearTool,\n  toolType\n});\n\nexport {\n  rectangleRoi,\n  rectangleRoiTouch\n};\n\n\n\n// WEBPACK FOOTER //\n// ./tools/image/rectangleRoi.js","import EVENTS from '@/events.js';\nimport external from '@/externalModules.js';\nimport { simpleMouseButtonTool, touchDragTool } from '@tools/base/index.js';\nimport isMouseButtonEnabled from '@/util/isMouseButtonEnabled.js';\nimport { getToolOptions } from '@/toolOptions.js';\n\nconst toolType = 'rotate';\n\n// --- Strategies --- //\nfunction defaultStrategy (eventData) {\n  // Calculate distance from the center of the image\n  const rect = eventData.element.getBoundingClientRect(eventData.element);\n\n  const points = {\n    x: eventData.currentPoints.client.x,\n    y: eventData.currentPoints.client.y\n  };\n\n  const width = eventData.element.clientWidth;\n  const height = eventData.element.clientHeight;\n\n  const pointsFromCenter = {\n    x: points.x - rect.left - width / 2,\n    // Invert the coordinate system so that up is positive\n    y: -1 * (points.y - rect.top - height / 2)\n  };\n\n  const rotationRadians = Math.atan2(pointsFromCenter.y, pointsFromCenter.x);\n  const rotationDegrees = rotationRadians * (180 / Math.PI);\n  const rotation = -1 * rotationDegrees + 90;\n\n  eventData.viewport.rotation = rotation;\n  external.cornerstone.setViewport(eventData.element, eventData.viewport);\n}\n\nfunction horizontalStrategy (eventData) {\n  eventData.viewport.rotation += (eventData.deltaPoints.page.x / eventData.viewport.scale);\n  external.cornerstone.setViewport(eventData.element, eventData.viewport);\n}\n\nfunction verticalStrategy (eventData) {\n  eventData.viewport.rotation += (eventData.deltaPoints.page.y / eventData.viewport.scale);\n  external.cornerstone.setViewport(eventData.element, eventData.viewport);\n}\n\n// --- Mouse event callbacks --- //\nfunction mouseUpCallback (e) {\n  const eventData = e.detail;\n  const element = eventData.element;\n\n  element.removeEventListener(EVENTS.MOUSE_DRAG, dragCallback);\n  element.removeEventListener(EVENTS.MOUSE_UP, mouseUpCallback);\n  element.removeEventListener(EVENTS.MOUSE_CLICK, mouseUpCallback);\n}\n\nfunction mouseDownCallback (e) {\n  const eventData = e.detail;\n  const element = eventData.element;\n  const options = getToolOptions(toolType, element);\n\n  if (isMouseButtonEnabled(eventData.which, options.mouseButtonMask)) {\n    element.addEventListener(EVENTS.MOUSE_DRAG, dragCallback);\n    element.addEventListener(EVENTS.MOUSE_UP, mouseUpCallback);\n    element.addEventListener(EVENTS.MOUSE_CLICK, mouseUpCallback);\n\n    e.preventDefault();\n    e.stopPropagation();\n  }\n}\n\nfunction dragCallback (e) {\n  const eventData = e.detail;\n\n  rotate.strategy(eventData);\n  external.cornerstone.setViewport(eventData.element, eventData.viewport);\n\n  e.preventDefault();\n  e.stopPropagation();\n}\n\nconst rotate = simpleMouseButtonTool(mouseDownCallback, toolType);\n\nrotate.strategies = {\n  default: defaultStrategy,\n  horizontal: horizontalStrategy,\n  vertical: verticalStrategy\n};\n\nrotate.strategy = defaultStrategy;\n\nconst rotateTouchDrag = touchDragTool(dragCallback, toolType);\n\nexport {\n  rotate,\n  rotateTouchDrag\n};\n\n\n\n// WEBPACK FOOTER //\n// ./tools/image/rotate.js","import EVENTS from '@/events.js';\nimport external from '@/externalModules.js';\n\nfunction touchRotateCallback (e) {\n  const eventData = e.detail;\n\n  eventData.viewport.rotation += eventData.rotation;\n  external.cornerstone.setViewport(eventData.element, eventData.viewport);\n\n  return false;\n}\n\nfunction disable (element) {\n  element.removeEventListener(EVENTS.TOUCH_ROTATE, touchRotateCallback);\n}\n\nfunction activate (element) {\n  element.removeEventListener(EVENTS.TOUCH_ROTATE, touchRotateCallback);\n  element.addEventListener(EVENTS.TOUCH_ROTATE, touchRotateCallback);\n}\n\nconst rotateTouch = {\n  activate,\n  disable\n};\n\nexport default rotateTouch;\n\n\n\n// WEBPACK FOOTER //\n// ./tools/image/rotateTouch.js","/* eslint no-alert:0 */\nimport EVENTS from '@/events.js';\nimport external from '@/externalModules.js';\nimport { mouseButtonTool, touchTool } from '@tools/base/index.js';\nimport drawTextBox from '@/util/drawTextBox.js';\nimport textStyle from '@/stateManagement/textStyle.js';\nimport toolStyle from '@/stateManagement/toolStyle.js';\nimport toolColors from '@/stateManagement/toolColors.js';\nimport anyHandlesOutsideImage from '@/manipulators/anyHandlesOutsideImage.js';\nimport moveHandle from '@/manipulators/moveHandle.js';\nimport drawHandles from '@/manipulators/drawHandles.js';\nimport drawCircle from '@/util/drawCircle.js';\nimport isMouseButtonEnabled from '@/util/isMouseButtonEnabled.js';\nimport pointInsideBoundingBox from '@/util/pointInsideBoundingBox.js';\nimport { addToolState, removeToolState, getToolState } from '@/stateManagement/toolState.js';\nimport { getToolOptions } from '@/toolOptions.js';\n\nconst toolType = 'seedAnnotate';\n\n// Define a callback to get your text annotation\n// This could be used, e.g. to open a modal\nfunction getTextCallback (doneGetTextCallback) {\n  doneGetTextCallback(prompt('Enter your annotation:'));\n}\n\nfunction changeTextCallback (data, eventData, doneChangingTextCallback) {\n  doneChangingTextCallback(prompt('Change your annotation:'));\n}\n\nconst configuration = {\n  getTextCallback,\n  changeTextCallback,\n  drawHandles: false,\n  drawHandlesOnHover: true,\n  currentLetter: 'A',\n  currentNumber: 0,\n  showCoordinates: true,\n  countUp: true\n};\n// / --- Mouse Tool --- ///\n\n// /////// BEGIN ACTIVE TOOL ///////\nfunction addNewMeasurement (mouseEventData) {\n  const cornerstone = external.cornerstone;\n  const element = mouseEventData.element;\n  const config = seedAnnotate.getConfiguration();\n  const measurementData = createNewMeasurement(mouseEventData);\n\n  function doneGetTextCallback (text) {\n    if (text === null) {\n      removeToolState(element, toolType, measurementData);\n    } else {\n      measurementData.text = text;\n    }\n\n    measurementData.active = false;\n    cornerstone.updateImage(element);\n  }\n\n  // Associate this data with this imageId so we can render it and manipulate it\n  addToolState(element, toolType, measurementData);\n\n  cornerstone.updateImage(element);\n  moveHandle(mouseEventData, toolType, measurementData, measurementData.handles.end, function () {\n    if (anyHandlesOutsideImage(mouseEventData, measurementData.handles)) {\n      // Delete the measurement\n      removeToolState(element, toolType, measurementData);\n    }\n\n    if (measurementData.text === undefined) {\n      config.getTextCallback(doneGetTextCallback);\n    }\n\n    cornerstone.updateImage(element);\n  });\n}\n\nfunction createNewMeasurement (mouseEventData) {\n  // Create the measurement data for this tool with the end handle activated\n  const measurementData = {\n    visible: true,\n    active: true,\n    handles: {\n      end: {\n        x: mouseEventData.currentPoints.image.x,\n        y: mouseEventData.currentPoints.image.y,\n        highlight: true,\n        active: false\n      },\n      textBox: {\n        active: false,\n        hasMoved: false,\n        movesIndependently: false,\n        drawnIndependently: true,\n        allowedOutsideImage: true,\n        hasBoundingBox: true\n      }\n    }\n  };\n\n\n  return measurementData;\n}\n// /////// END ACTIVE TOOL ///////\n\nfunction pointNearTool (element, data, coords) {\n  if (!data.handles.end) {\n    return;\n  }\n\n  const realCoords = external.cornerstone.pixelToCanvas(element, data.handles.end);\n  const distanceToPoint = external.cornerstoneMath.point.distance(realCoords, coords);\n\n\n  return (distanceToPoint < 25);\n}\n\n// /////// BEGIN IMAGE RENDERING ///////\nfunction onImageRendered (e) {\n  const eventData = e.detail;\n  // If we have no toolData for this element, return immediately as there is nothing to do\n  const toolData = getToolState(e.currentTarget, toolType);\n\n  if (!toolData) {\n    return;\n  }\n\n  const cornerstone = external.cornerstone;\n  const enabledElement = eventData.enabledElement;\n\n  // We have tool data for this element - iterate over each one and draw it\n  const context = eventData.canvasContext.canvas.getContext('2d');\n\n  context.setTransform(1, 0, 0, 1, 0, 0);\n\n  // We need the canvas width\n  const canvasWidth = eventData.canvasContext.canvas.width;\n\n  let color;\n  const lineWidth = toolStyle.getToolWidth();\n  const font = textStyle.getFont();\n  const config = seedAnnotate.getConfiguration();\n\n  for (let i = 0; i < toolData.data.length; i++) {\n    context.save();\n\n    if (config && config.shadow) {\n      context.shadowColor = config.shadowColor || '#000000';\n      context.shadowOffsetX = config.shadowOffsetX || 1;\n      context.shadowOffsetY = config.shadowOffsetY || 1;\n    }\n\n    const data = toolData.data[i];\n\n    if (data.active) {\n      color = toolColors.getActiveColor();\n    } else {\n      color = toolColors.getToolColor();\n    }\n\n    // Draw\n    const handleCanvas = cornerstone.pixelToCanvas(eventData.element, data.handles.end);\n\n    // Draw the circle always at the end of the handle\n    drawCircle(context, handleCanvas, color, lineWidth);\n\n    const handleOptions = {\n      drawHandlesIfActive: (config && config.drawHandlesOnHover)\n    };\n\n    if (config.drawHandles) {\n      drawHandles(context, eventData, handleCanvas, color, handleOptions);\n    }\n\n    // Draw the text\n    if (data.text && data.text !== '') {\n      context.font = font;\n\n      let textPlusCoords = '';\n\n      if (config.showCoordinates) {\n        textPlusCoords = `${data.text} x: ${Math.round(data.handles.end.x)\n        } y: ${Math.round(data.handles.end.y)}`;\n      } else {\n        textPlusCoords = data.text;\n      }\n\n      // Calculate the text coordinates.\n      const textWidth = context.measureText(textPlusCoords).width + 10;\n      const textHeight = textStyle.getFontSize() + 10;\n\n      let distance = Math.max(textWidth, textHeight) / 2 + 5;\n\n      if (handleCanvas.x > (canvasWidth / 2)) {\n        distance = -distance;\n      }\n\n      let textCoords;\n\n      if (!data.handles.textBox.hasMoved) {\n        textCoords = {\n          x: handleCanvas.x - textWidth / 2 + distance,\n          y: handleCanvas.y - textHeight / 2\n        };\n\n        const transform = cornerstone.internal.getTransform(enabledElement);\n\n        transform.invert();\n\n        const coords = transform.transformPoint(textCoords.x, textCoords.y);\n\n        data.handles.textBox.x = coords.x;\n        data.handles.textBox.y = coords.y;\n      }\n\n      textCoords = cornerstone.pixelToCanvas(eventData.element, data.handles.textBox);\n\n      const boundingBox = drawTextBox(context, textPlusCoords, textCoords.x, textCoords.y, color);\n\n      data.handles.textBox.boundingBox = boundingBox;\n\n      if (data.handles.textBox.hasMoved) {\n        // Draw dashed link line between tool and text\n        const link = {\n          start: {},\n          end: {}\n        };\n\n        link.end.x = textCoords.x;\n        link.end.y = textCoords.y;\n\n        link.start = handleCanvas;\n\n        const boundingBoxPoints = [\n          {\n            // Top middle point of bounding box\n            x: boundingBox.left + boundingBox.width / 2,\n            y: boundingBox.top\n          }, {\n            // Left middle point of bounding box\n            x: boundingBox.left,\n            y: boundingBox.top + boundingBox.height / 2\n          }, {\n            // Bottom middle point of bounding box\n            x: boundingBox.left + boundingBox.width / 2,\n            y: boundingBox.top + boundingBox.height\n          }, {\n            // Right middle point of bounding box\n            x: boundingBox.left + boundingBox.width,\n            y: boundingBox.top + boundingBox.height / 2\n          }\n        ];\n\n        link.end = external.cornerstoneMath.point.findClosestPoint(boundingBoxPoints, link.start);\n\n        context.beginPath();\n        context.strokeStyle = color;\n        context.lineWidth = lineWidth;\n        context.setLineDash([2, 3]);\n        context.moveTo(link.start.x, link.start.y);\n        context.lineTo(link.end.x, link.end.y);\n        context.stroke();\n      }\n    }\n\n    context.restore();\n  }\n}\n// ---- Touch tool ----\n\n// /////// BEGIN ACTIVE TOOL ///////\nfunction addNewMeasurementTouch (touchEventData) {\n  const cornerstone = external.cornerstone;\n  const element = touchEventData.element;\n  const config = seedAnnotate.getConfiguration();\n  const measurementData = createNewMeasurement(touchEventData);\n\n  function doneGetTextCallback (text) {\n    if (text === null) {\n      removeToolState(element, toolType, measurementData);\n    } else {\n      measurementData.text = text;\n    }\n\n    measurementData.active = false;\n    cornerstone.updateImage(element);\n  }\n\n  // Associate this data with this imageId so we can render it and manipulate it\n  addToolState(element, toolType, measurementData);\n\n  cornerstone.updateImage(element);\n  moveHandle(touchEventData, toolType, measurementData, measurementData.handles.end, function () {\n    if (anyHandlesOutsideImage(touchEventData, measurementData.handles)) {\n      // Delete the measurement\n      removeToolState(element, toolType, measurementData);\n    }\n\n    if (measurementData.text === undefined) {\n      config.getTextCallback(doneGetTextCallback);\n    }\n\n    cornerstone.updateImage(element);\n  });\n}\n\nfunction doubleClickCallback (e) {\n  const eventData = e.detail;\n  const cornerstone = external.cornerstone;\n  const element = eventData.element;\n  let data;\n  const options = getToolOptions(toolType, element);\n\n  if (!isMouseButtonEnabled(eventData.which, options.mouseButtonMask)) {\n    return;\n  }\n\n  function doneChangingTextCallback (data, updatedText, deleteTool) {\n    if (deleteTool === true) {\n      removeToolState(element, toolType, data);\n    } else {\n      data.text = updatedText;\n    }\n\n    data.active = false;\n    cornerstone.updateImage(element);\n  }\n\n  const config = seedAnnotate.getConfiguration();\n\n  const coords = eventData.currentPoints.canvas;\n  const toolData = getToolState(element, toolType);\n\n  // Now check to see if there is a handle we can move\n  if (!toolData) {\n    return;\n  }\n\n  for (let i = 0; i < toolData.data.length; i++) {\n    data = toolData.data[i];\n    if (pointNearTool(element, data, coords) ||\n            pointInsideBoundingBox(data.handles.textBox, coords)) {\n\n      data.active = true;\n      cornerstone.updateImage(element);\n      // Allow relabelling via a callback\n      config.changeTextCallback(data, eventData, doneChangingTextCallback);\n\n      e.stopImmediatePropagation();\n\n      return false;\n    }\n  }\n\n  e.preventDefault();\n  e.stopPropagation();\n}\n\nfunction pressCallback (e) {\n  const eventData = e.detail;\n  const cornerstone = external.cornerstone;\n  const element = eventData.element;\n  let data;\n\n  function doneChangingTextCallback (data, updatedText, deleteTool) {\n    console.log('pressCallback doneChangingTextCallback');\n    if (deleteTool === true) {\n      removeToolState(element, toolType, data);\n    } else {\n      data.text = updatedText;\n    }\n\n    data.active = false;\n    cornerstone.updateImage(element);\n\n    element.addEventListener(EVENTS.TOUCH_START, seedAnnotateTouch.touchStartCallback);\n    element.addEventListener(EVENTS.TOUCH_START_ACTIVE, seedAnnotateTouch.touchDownActivateCallback);\n    element.addEventListener(EVENTS.TAP, seedAnnotateTouch.tapCallback);\n  }\n\n  const config = seedAnnotate.getConfiguration();\n\n  const coords = eventData.currentPoints.canvas;\n  const toolData = getToolState(element, toolType);\n\n  // Now check to see if there is a handle we can move\n  if (!toolData) {\n    return false;\n  }\n\n  if (eventData.handlePressed) {\n    element.removeEventListener(EVENTS.TOUCH_START, seedAnnotateTouch.touchStartCallback);\n    element.removeEventListener(EVENTS.TOUCH_START_ACTIVE, seedAnnotateTouch.touchDownActivateCallback);\n    element.removeEventListener(EVENTS.TAP, seedAnnotateTouch.tapCallback);\n\n    // Allow relabelling via a callback\n    config.changeTextCallback(eventData.handlePressed, eventData, doneChangingTextCallback);\n\n    e.stopImmediatePropagation();\n\n    return false;\n  }\n\n  for (let i = 0; i < toolData.data.length; i++) {\n    data = toolData.data[i];\n    if (pointNearTool(element, data, coords) ||\n          pointInsideBoundingBox(data.handles.textBox, coords)) {\n      data.active = true;\n      cornerstone.updateImage(element);\n\n      element.removeEventListener(EVENTS.TOUCH_START, seedAnnotateTouch.touchStartCallback);\n      element.removeEventListener(EVENTS.TOUCH_START_ACTIVE, seedAnnotateTouch.touchDownActivateCallback);\n      element.removeEventListener(EVENTS.TAP, seedAnnotateTouch.tapCallback);\n\n      // Allow relabelling via a callback\n      config.changeTextCallback(data, eventData, doneChangingTextCallback);\n\n      e.stopImmediatePropagation();\n\n      return false;\n    }\n  }\n\n  e.preventDefault();\n  e.stopPropagation();\n}\n\nconst seedAnnotate = mouseButtonTool({\n  addNewMeasurement,\n  createNewMeasurement,\n  onImageRendered,\n  pointNearTool,\n  toolType,\n  mouseDoubleClickCallback: doubleClickCallback\n});\n\nseedAnnotate.setConfiguration(configuration);\n\nconst seedAnnotateTouch = touchTool({\n  addNewMeasurement: addNewMeasurementTouch,\n  createNewMeasurement,\n  onImageRendered,\n  pointNearTool,\n  toolType,\n  pressCallback\n});\n\nexport {\n  seedAnnotate,\n  seedAnnotateTouch\n};\n\n\n\n// WEBPACK FOOTER //\n// ./tools/image/seedAnnotate.js","import EVENTS from '@/events.js';\nimport external from '@/externalModules.js';\nimport drawTextBox from '@/util/drawTextBox.js';\nimport roundToDecimal from '@/util/roundToDecimal.js';\nimport textStyle from '@/stateManagement/textStyle.js';\nimport toolStyle from '@/stateManagement/toolStyle.js';\nimport toolColors from '@/stateManagement/toolColors.js';\nimport anyHandlesOutsideImage from '@/manipulators/anyHandlesOutsideImage.js';\nimport moveNewHandle from '@/manipulators/moveNewHandle.js';\nimport moveNewHandleTouch from '@/manipulators/moveNewHandleTouch.js';\nimport drawHandles from '@/manipulators/drawHandles.js';\nimport { mouseButtonTool, touchTool } from '@tools/base/index.js';\nimport { addToolState, removeToolState, getToolState } from '@/stateManagement/toolState.js';\n\n\nconst toolType = 'simpleAngle';\n\n// /////// BEGIN ACTIVE TOOL ///////\nfunction createNewMeasurement (mouseEventData) {\n  // Create the measurement data for this tool with the end handle activated\n  const angleData = {\n    visible: true,\n    active: true,\n    handles: {\n      start: {\n        x: mouseEventData.currentPoints.image.x,\n        y: mouseEventData.currentPoints.image.y,\n        highlight: true,\n        active: false\n      },\n      middle: {\n        x: mouseEventData.currentPoints.image.x,\n        y: mouseEventData.currentPoints.image.y,\n        highlight: true,\n        active: true\n      },\n      end: {\n        x: mouseEventData.currentPoints.image.x,\n        y: mouseEventData.currentPoints.image.y,\n        highlight: true,\n        active: false\n      },\n      textBox: {\n        active: false,\n        hasMoved: false,\n        movesIndependently: false,\n        drawnIndependently: true,\n        allowedOutsideImage: true,\n        hasBoundingBox: true\n      }\n    }\n  };\n\n  return angleData;\n}\n// /////// END ACTIVE TOOL ///////\n\nfunction pointNearTool (element, data, coords) {\n  const cornerstone = external.cornerstone;\n  const lineSegment = {\n    start: cornerstone.pixelToCanvas(element, data.handles.start),\n    end: cornerstone.pixelToCanvas(element, data.handles.middle)\n  };\n\n  let distanceToPoint = external.cornerstoneMath.lineSegment.distanceToPoint(lineSegment, coords);\n\n  if (distanceToPoint < 25) {\n    return true;\n  }\n\n  lineSegment.start = cornerstone.pixelToCanvas(element, data.handles.middle);\n  lineSegment.end = cornerstone.pixelToCanvas(element, data.handles.end);\n\n  distanceToPoint = external.cornerstoneMath.lineSegment.distanceToPoint(lineSegment, coords);\n\n  return (distanceToPoint < 25);\n}\n\nfunction length (vector) {\n  return Math.sqrt(Math.pow(vector.x, 2) + Math.pow(vector.y, 2));\n}\n\n// /////// BEGIN IMAGE RENDERING ///////\nfunction onImageRendered (e) {\n  const eventData = e.detail;\n  // If we have no toolData for this element, return immediately as there is nothing to do\n  const toolData = getToolState(e.currentTarget, toolType);\n\n  if (!toolData) {\n    return;\n  }\n\n  const cornerstone = external.cornerstone;\n  const enabledElement = eventData.enabledElement;\n\n  // We have tool data for this element - iterate over each one and draw it\n  const context = eventData.canvasContext.canvas.getContext('2d');\n\n  context.setTransform(1, 0, 0, 1, 0, 0);\n\n  // Activation color\n  let color;\n  const lineWidth = toolStyle.getToolWidth();\n  const font = textStyle.getFont();\n  const config = simpleAngle.getConfiguration();\n\n  for (let i = 0; i < toolData.data.length; i++) {\n    context.save();\n\n    if (config && config.shadow) {\n      context.shadowColor = config.shadowColor || '#000000';\n      context.shadowOffsetX = config.shadowOffsetX || 1;\n      context.shadowOffsetY = config.shadowOffsetY || 1;\n    }\n\n    const data = toolData.data[i];\n\n    // Differentiate the color of activation tool\n    if (data.active) {\n      color = toolColors.getActiveColor();\n    } else {\n      color = toolColors.getToolColor();\n    }\n\n    const handleStartCanvas = cornerstone.pixelToCanvas(eventData.element, data.handles.start);\n    const handleMiddleCanvas = cornerstone.pixelToCanvas(eventData.element, data.handles.middle);\n    const handleEndCanvas = cornerstone.pixelToCanvas(eventData.element, data.handles.end);\n\n    // Draw the line\n    context.beginPath();\n    context.strokeStyle = color;\n    context.lineWidth = lineWidth;\n    context.moveTo(handleStartCanvas.x, handleStartCanvas.y);\n    context.lineTo(handleMiddleCanvas.x, handleMiddleCanvas.y);\n    context.lineTo(handleEndCanvas.x, handleEndCanvas.y);\n    context.stroke();\n\n    // Draw the handles\n    const handleOptions = {\n      drawHandlesIfActive: (config && config.drawHandlesOnHover)\n    };\n\n    drawHandles(context, eventData, data.handles, color, handleOptions);\n\n    // Draw the text\n    context.fillStyle = color;\n\n    // Default to isotropic pixel size, update suffix to reflect this\n    const columnPixelSpacing = eventData.image.columnPixelSpacing || 1;\n    const rowPixelSpacing = eventData.image.rowPixelSpacing || 1;\n    let suffix = '';\n\n    if (!eventData.image.rowPixelSpacing || !eventData.image.columnPixelSpacing) {\n      suffix = ' (isotropic)';\n    }\n\n    const sideA = {\n      x: (Math.ceil(data.handles.middle.x) - Math.ceil(data.handles.start.x)) * columnPixelSpacing,\n      y: (Math.ceil(data.handles.middle.y) - Math.ceil(data.handles.start.y)) * rowPixelSpacing\n    };\n\n    const sideB = {\n      x: (Math.ceil(data.handles.end.x) - Math.ceil(data.handles.middle.x)) * columnPixelSpacing,\n      y: (Math.ceil(data.handles.end.y) - Math.ceil(data.handles.middle.y)) * rowPixelSpacing\n    };\n\n    const sideC = {\n      x: (Math.ceil(data.handles.end.x) - Math.ceil(data.handles.start.x)) * columnPixelSpacing,\n      y: (Math.ceil(data.handles.end.y) - Math.ceil(data.handles.start.y)) * rowPixelSpacing\n    };\n\n    const sideALength = length(sideA);\n    const sideBLength = length(sideB);\n    const sideCLength = length(sideC);\n\n    // Cosine law\n    let angle = Math.acos((Math.pow(sideALength, 2) + Math.pow(sideBLength, 2) - Math.pow(sideCLength, 2)) / (2 * sideALength * sideBLength));\n\n    angle *= (180 / Math.PI);\n\n    const rAngle = roundToDecimal(angle, 2);\n\n    if (rAngle) {\n      const str = '00B0'; // Degrees symbol\n      const text = rAngle.toString() + String.fromCharCode(parseInt(str, 16)) + suffix;\n\n      const distance = 15;\n\n      let textCoords;\n\n      if (data.handles.textBox.hasMoved) {\n        textCoords = cornerstone.pixelToCanvas(eventData.element, data.handles.textBox);\n      } else {\n        textCoords = {\n          x: handleMiddleCanvas.x,\n          y: handleMiddleCanvas.y\n        };\n\n        context.font = font;\n        const textWidth = context.measureText(text).width;\n\n        if (handleMiddleCanvas.x < handleStartCanvas.x) {\n          textCoords.x -= distance + textWidth + 10;\n        } else {\n          textCoords.x += distance;\n        }\n\n        const transform = cornerstone.internal.getTransform(enabledElement);\n\n        transform.invert();\n\n        const coords = transform.transformPoint(textCoords.x, textCoords.y);\n\n        data.handles.textBox.x = coords.x;\n        data.handles.textBox.y = coords.y;\n      }\n\n      const options = {\n        centering: {\n          x: false,\n          y: true\n        }\n      };\n\n      const boundingBox = drawTextBox(context, text, textCoords.x, textCoords.y, color, options);\n\n      data.handles.textBox.boundingBox = boundingBox;\n\n      if (data.handles.textBox.hasMoved) {\n        // Draw dashed link line between tool and text\n        const link = {\n          start: {},\n          end: {}\n        };\n\n        const points = [handleStartCanvas, handleEndCanvas, handleMiddleCanvas];\n\n        link.end.x = textCoords.x;\n        link.end.y = textCoords.y;\n\n        link.start = external.cornerstoneMath.point.findClosestPoint(points, link.end);\n\n        const boundingBoxPoints = [{\n          // Top middle point of bounding box\n          x: boundingBox.left + boundingBox.width / 2,\n          y: boundingBox.top\n        }, {\n          // Left middle point of bounding box\n          x: boundingBox.left,\n          y: boundingBox.top + boundingBox.height / 2\n        }, {\n          // Bottom middle point of bounding box\n          x: boundingBox.left + boundingBox.width / 2,\n          y: boundingBox.top + boundingBox.height\n        }, {\n          // Right middle point of bounding box\n          x: boundingBox.left + boundingBox.width,\n          y: boundingBox.top + boundingBox.height / 2\n        }\n        ];\n\n        link.end = external.cornerstoneMath.point.findClosestPoint(boundingBoxPoints, link.start);\n\n        context.beginPath();\n        context.strokeStyle = color;\n        context.lineWidth = lineWidth;\n        context.setLineDash([2, 3]);\n        context.moveTo(link.start.x, link.start.y);\n        context.lineTo(link.end.x, link.end.y);\n        context.stroke();\n      }\n    }\n\n    context.restore();\n  }\n}\n// /////// END IMAGE RENDERING ///////\n\n// /////// BEGIN ACTIVE TOOL ///////\nfunction addNewMeasurement (mouseEventData) {\n  const cornerstone = external.cornerstone;\n  const measurementData = createNewMeasurement(mouseEventData);\n  const element = mouseEventData.element;\n\n  // Associate this data with this imageId so we can render it and manipulate it\n  addToolState(element, toolType, measurementData);\n\n  // Since we are dragging to another place to drop the end point, we can just activate\n  // The end point and let the moveHandle move it for us.\n  element.removeEventListener(EVENTS.MOUSE_MOVE, simpleAngle.mouseMoveCallback);\n  element.removeEventListener(EVENTS.MOUSE_DRAG, simpleAngle.mouseMoveCallback);\n  element.removeEventListener(EVENTS.MOUSE_DOWN, simpleAngle.mouseDownCallback);\n  element.removeEventListener(EVENTS.MOUSE_DOWN_ACTIVATE, simpleAngle.mouseDownActivateCallback);\n  cornerstone.updateImage(element);\n\n  moveNewHandle(mouseEventData, toolType, measurementData, measurementData.handles.middle, function () {\n    measurementData.active = false;\n    if (anyHandlesOutsideImage(mouseEventData, measurementData.handles)) {\n      // Delete the measurement\n      removeToolState(element, toolType, measurementData);\n\n      element.addEventListener(EVENTS.MOUSE_MOVE, simpleAngle.mouseMoveCallback);\n      element.addEventListener(EVENTS.MOUSE_DRAG, simpleAngle.mouseMoveCallback);\n      element.addEventListener(EVENTS.MOUSE_DOWN, simpleAngle.mouseDownCallback);\n      element.addEventListener(EVENTS.MOUSE_DOWN_ACTIVATE, simpleAngle.mouseDownActivateCallback);\n      cornerstone.updateImage(element);\n\n      return;\n    }\n\n    measurementData.handles.end.active = true;\n    cornerstone.updateImage(element);\n\n    moveNewHandle(mouseEventData, toolType, measurementData, measurementData.handles.end, function () {\n      measurementData.active = false;\n      if (anyHandlesOutsideImage(mouseEventData, measurementData.handles)) {\n        // Delete the measurement\n        removeToolState(element, toolType, measurementData);\n      }\n\n      element.addEventListener(EVENTS.MOUSE_MOVE, simpleAngle.mouseMoveCallback);\n      element.addEventListener(EVENTS.MOUSE_DRAG, simpleAngle.mouseMoveCallback);\n      element.addEventListener(EVENTS.MOUSE_DOWN, simpleAngle.mouseDownCallback);\n      element.addEventListener(EVENTS.MOUSE_DOWN_ACTIVATE, simpleAngle.mouseDownActivateCallback);\n      cornerstone.updateImage(element);\n    });\n  });\n}\n\nfunction addNewMeasurementTouch (touchEventData) {\n  const cornerstone = external.cornerstone;\n  const measurementData = createNewMeasurement(touchEventData);\n  const element = touchEventData.element;\n\n  // Associate this data with this imageId so we can render it and manipulate it\n  addToolState(element, toolType, measurementData);\n\n  // Since we are dragging to another place to drop the end point, we can just activate\n  // The end point and let the moveHandle move it for us.\n  element.removeEventListener(EVENTS.TOUCH_DRAG, simpleAngleTouch.touchMoveCallback);\n  element.removeEventListener(EVENTS.TOUCH_START_ACTIVE, simpleAngleTouch.touchDownActivateCallback);\n  element.removeEventListener(EVENTS.TOUCH_START, simpleAngleTouch.touchStartCallback);\n  element.removeEventListener(EVENTS.TAP, simpleAngleTouch.tapCallback);\n  cornerstone.updateImage(element);\n\n  moveNewHandleTouch(touchEventData, toolType, measurementData, measurementData.handles.middle, function () {\n    if (anyHandlesOutsideImage(touchEventData, measurementData.handles)) {\n      // Delete the measurement\n      removeToolState(element, toolType, measurementData);\n      element.addEventListener(EVENTS.TOUCH_DRAG, simpleAngleTouch.touchMoveCallback);\n      element.addEventListener(EVENTS.TOUCH_START, simpleAngleTouch.touchStartCallback);\n      element.addEventListener(EVENTS.TOUCH_START_ACTIVE, simpleAngleTouch.touchDownActivateCallback);\n      element.addEventListener(EVENTS.TAP, simpleAngleTouch.tapCallback);\n      cornerstone.updateImage(element);\n\n      return;\n    }\n\n    moveNewHandleTouch(touchEventData, toolType, measurementData, measurementData.handles.end, function () {\n      if (anyHandlesOutsideImage(touchEventData, measurementData.handles)) {\n        // Delete the measurement\n        removeToolState(element, toolType, measurementData);\n        cornerstone.updateImage(element);\n      }\n\n      element.addEventListener(EVENTS.TOUCH_DRAG, simpleAngleTouch.touchMoveCallback);\n      element.addEventListener(EVENTS.TOUCH_START, simpleAngleTouch.touchStartCallback);\n      element.addEventListener(EVENTS.TOUCH_START_ACTIVE, simpleAngleTouch.touchDownActivateCallback);\n      element.addEventListener(EVENTS.TAP, simpleAngleTouch.tapCallback);\n    });\n  });\n}\n\nconst simpleAngle = mouseButtonTool({\n  createNewMeasurement,\n  addNewMeasurement,\n  onImageRendered,\n  pointNearTool,\n  toolType\n});\n\nconst simpleAngleTouch = touchTool({\n  createNewMeasurement,\n  addNewMeasurement: addNewMeasurementTouch,\n  onImageRendered,\n  pointNearTool,\n  toolType\n});\n\nexport {\n  simpleAngle,\n  simpleAngleTouch\n};\n\n\n\n// WEBPACK FOOTER //\n// ./tools/image/simpleAngle.js","import EVENTS from '@/events.js';\nimport external from '@/externalModules.js';\nimport { mouseButtonTool, touchTool } from '@tools/base/index.js';\nimport pointInsideBoundingBox from '@/util/pointInsideBoundingBox.js';\nimport toolColors from '@/stateManagement/toolColors.js';\nimport isMouseButtonEnabled from '@/util/isMouseButtonEnabled.js';\nimport drawTextBox from '@/util/drawTextBox.js';\nimport { removeToolState, getToolState } from '@/stateManagement/toolState.js';\nimport { getToolOptions } from '@/toolOptions.js';\n\nconst toolType = 'textMarker';\n\n// /////// BEGIN ACTIVE TOOL ///////\nfunction createNewMeasurement (mouseEventData) {\n  const config = textMarker.getConfiguration();\n\n  if (!config.current) {\n    return;\n  }\n\n  // Create the measurement data for this tool with the end handle activated\n  const measurementData = {\n    visible: true,\n    active: true,\n    text: config.current,\n    handles: {\n      end: {\n        x: mouseEventData.currentPoints.image.x,\n        y: mouseEventData.currentPoints.image.y,\n        highlight: true,\n        active: true,\n        hasBoundingBox: true\n      }\n    }\n  };\n\n    // Create a rectangle representing the image\n  const imageRect = {\n    left: 0,\n    top: 0,\n    width: mouseEventData.image.width,\n    height: mouseEventData.image.height\n  };\n\n    // Check if the current handle is outside the image,\n    // If it is, prevent the handle creation\n  if (!external.cornerstoneMath.point.insideRect(measurementData.handles.end, imageRect)) {\n    return;\n  }\n\n  // Update the current marker for the next marker\n  let currentIndex = config.markers.indexOf(config.current);\n\n  if (config.ascending) {\n    currentIndex += 1;\n    if (currentIndex >= config.markers.length) {\n      if (config.loop) {\n        currentIndex -= config.markers.length;\n      } else {\n        currentIndex = -1;\n      }\n    }\n  } else {\n    currentIndex -= 1;\n    if (currentIndex < 0) {\n      if (config.loop) {\n        currentIndex += config.markers.length;\n      } else {\n        currentIndex = -1;\n      }\n    }\n  }\n\n  config.current = config.markers[currentIndex];\n\n  return measurementData;\n}\n// /////// END ACTIVE TOOL ///////\n\n// /////// BEGIN IMAGE RENDERING ///////\nfunction pointNearTool (element, data, coords) {\n  if (!data.handles.end.boundingBox) {\n    return;\n  }\n\n  const distanceToPoint = external.cornerstoneMath.rect.distanceToPoint(data.handles.end.boundingBox, coords);\n  const insideBoundingBox = pointInsideBoundingBox(data.handles.end, coords);\n\n\n  return (distanceToPoint < 10) || insideBoundingBox;\n}\n\nfunction onImageRendered (e) {\n  const eventData = e.detail;\n\n  // If we have no toolData for this element, return immediately as there is nothing to do\n  const toolData = getToolState(eventData.element, toolType);\n\n  if (!toolData) {\n    return;\n  }\n\n  // We have tool data for this element - iterate over each one and draw it\n  const context = eventData.canvasContext.canvas.getContext('2d');\n\n  context.setTransform(1, 0, 0, 1, 0, 0);\n\n  const config = textMarker.getConfiguration();\n\n  for (let i = 0; i < toolData.data.length; i++) {\n    const data = toolData.data[i];\n\n    let color = toolColors.getToolColor();\n\n    if (data.active) {\n      color = toolColors.getActiveColor();\n    }\n\n    context.save();\n\n    if (config && config.shadow) {\n      context.shadowColor = config.shadowColor || '#000000';\n      context.shadowOffsetX = config.shadowOffsetX || 1;\n      context.shadowOffsetY = config.shadowOffsetY || 1;\n    }\n\n    // Draw text\n    context.fillStyle = color;\n    const measureText = context.measureText(data.text);\n\n    data.textWidth = measureText.width + 10;\n\n    const textCoords = external.cornerstone.pixelToCanvas(eventData.element, data.handles.end);\n\n    const options = {\n      centering: {\n        x: true,\n        y: true\n      }\n    };\n\n    data.handles.end.boundingBox = drawTextBox(context, data.text, textCoords.x, textCoords.y - 10, color, options);\n\n    context.restore();\n  }\n}\n\nfunction doubleClickCallback (e) {\n  const eventData = e.detail;\n  const cornerstone = external.cornerstone;\n  const element = eventData.element;\n  let data;\n  const options = getToolOptions(toolType, element);\n\n  if (!isMouseButtonEnabled(eventData.which, options.mouseButtonMask)) {\n    return;\n  }\n\n  function doneChangingTextCallback (data, updatedText, deleteTool) {\n    if (deleteTool === true) {\n      removeToolState(element, toolType, data);\n    } else {\n      data.text = updatedText;\n    }\n\n    data.active = false;\n    cornerstone.updateImage(element);\n\n    element.addEventListener(EVENTS.MOUSE_MOVE, textMarker.mouseMoveCallback);\n    element.addEventListener(EVENTS.MOUSE_DOWN, textMarker.mouseDownCallback);\n    element.addEventListener(EVENTS.MOUSE_DOWN_ACTIVATE, textMarker.mouseDownActivateCallback);\n    element.addEventListener(EVENTS.MOUSE_DOUBLE_CLICK, textMarker.mouseDoubleClickCallback);\n  }\n\n  const config = textMarker.getConfiguration();\n  const coords = eventData.currentPoints.canvas;\n  const toolData = getToolState(element, toolType);\n\n  // Now check to see if there is a handle we can move\n  if (!toolData) {\n    return;\n  }\n\n  for (let i = 0; i < toolData.data.length; i++) {\n    data = toolData.data[i];\n    if (pointNearTool(element, data, coords)) {\n      data.active = true;\n      cornerstone.updateImage(element);\n\n      element.removeEventListener(EVENTS.MOUSE_MOVE, textMarker.mouseMoveCallback);\n      element.removeEventListener(EVENTS.MOUSE_DOWN, textMarker.mouseDownCallback);\n      element.removeEventListener(EVENTS.MOUSE_DOWN_ACTIVATE, textMarker.mouseDownActivateCallback);\n      element.removeEventListener(EVENTS.MOUSE_DOUBLE_CLICK, textMarker.mouseDoubleClickCallback);\n      // Allow relabelling via a callback\n      config.changeTextCallback(data, eventData, doneChangingTextCallback);\n\n      e.stopImmediatePropagation();\n      e.preventDefault();\n      e.stopPropagation();\n\n      return;\n    }\n  }\n\n  e.preventDefault();\n  e.stopPropagation();\n}\n\nfunction touchPressCallback (e) {\n  const eventData = e.detail;\n  const cornerstone = external.cornerstone;\n  const element = eventData.element;\n  let data;\n\n  function doneChangingTextCallback (data, updatedText, deleteTool) {\n    if (deleteTool === true) {\n      removeToolState(element, toolType, data);\n    } else {\n      data.text = updatedText;\n    }\n\n    data.active = false;\n    cornerstone.updateImage(element);\n\n    element.addEventListener(EVENTS.TOUCH_DRAG, textMarkerTouch.touchMoveCallback);\n    element.addEventListener(EVENTS.TOUCH_START_ACTIVE, textMarkerTouch.touchDownActivateCallback);\n    element.addEventListener(EVENTS.TOUCH_START, textMarkerTouch.touchStartCallback);\n    element.addEventListener(EVENTS.TAP, textMarkerTouch.tapCallback);\n    element.addEventListener(EVENTS.TOUCH_PRESS, textMarkerTouch.pressCallback);\n  }\n\n  const config = textMarker.getConfiguration();\n\n  const coords = eventData.currentPoints.canvas;\n  const toolData = getToolState(element, toolType);\n\n  // Now check to see if there is a handle we can move\n  if (!toolData) {\n    return false;\n  }\n\n  if (eventData.handlePressed) {\n    eventData.handlePressed.active = true;\n    cornerstone.updateImage(element);\n\n    element.removeEventListener(EVENTS.TOUCH_DRAG, textMarkerTouch.touchMoveCallback);\n    element.removeEventListener(EVENTS.TOUCH_START_ACTIVE, textMarkerTouch.touchDownActivateCallback);\n    element.removeEventListener(EVENTS.TOUCH_START, textMarkerTouch.touchStartCallback);\n    element.removeEventListener(EVENTS.TAP, textMarkerTouch.tapCallback);\n    element.removeEventListener(EVENTS.TOUCH_PRESS, textMarkerTouch.pressCallback);\n\n    // Allow relabelling via a callback\n    config.changeTextCallback(eventData.handlePressed, eventData, doneChangingTextCallback);\n\n    e.stopImmediatePropagation();\n    e.preventDefault();\n    e.stopPropagation();\n\n    return;\n  }\n\n  for (let i = 0; i < toolData.data.length; i++) {\n    data = toolData.data[i];\n    if (pointNearTool(element, data, coords)) {\n      data.active = true;\n      cornerstone.updateImage(element);\n\n      element.removeEventListener(EVENTS.TOUCH_DRAG, textMarkerTouch.touchMoveCallback);\n      element.removeEventListener(EVENTS.TOUCH_START_ACTIVE, textMarkerTouch.touchDownActivateCallback);\n      element.removeEventListener(EVENTS.TOUCH_START, textMarkerTouch.touchStartCallback);\n      element.removeEventListener(EVENTS.TAP, textMarkerTouch.tapCallback);\n      element.removeEventListener(EVENTS.TOUCH_PRESS, textMarkerTouch.pressCallback);\n      // Allow relabelling via a callback\n      config.changeTextCallback(data, eventData, doneChangingTextCallback);\n\n      e.stopImmediatePropagation();\n      e.preventDefault();\n      e.stopPropagation();\n\n      return;\n    }\n  }\n\n  e.preventDefault();\n  e.stopPropagation();\n}\n\nconst textMarker = mouseButtonTool({\n  createNewMeasurement,\n  onImageRendered,\n  pointNearTool,\n  toolType,\n  mouseDoubleClickCallback: doubleClickCallback\n});\n\nconst textMarkerTouch = touchTool({\n  createNewMeasurement,\n  onImageRendered,\n  pointNearTool,\n  toolType,\n  pressCallback: touchPressCallback\n});\n\nexport {\n  textMarker,\n  textMarkerTouch\n};\n\n\n\n// WEBPACK FOOTER //\n// ./tools/image/textMarker.js","import EVENTS from '@/events.js';\nimport external from '@/externalModules.js';\nimport { simpleMouseButtonTool,\n  touchDragTool } from '@tools/base/index.js';\nimport isMouseButtonEnabled from '@/util/isMouseButtonEnabled.js';\nimport { getToolOptions } from '@/toolOptions.js';\n\nconst toolType = 'wwwc';\n\nfunction mouseUpCallback (e) {\n  const eventData = e.detail;\n  const element = eventData.element;\n\n  element.removeEventListener(EVENTS.MOUSE_DRAG, mouseDragCallback);\n  element.removeEventListener(EVENTS.MOUSE_UP, mouseUpCallback);\n  element.removeEventListener(EVENTS.MOUSE_CLICK, mouseUpCallback);\n}\n\nfunction mouseDownCallback (e) {\n  const eventData = e.detail;\n  const element = eventData.element;\n  const options = getToolOptions(toolType, element);\n\n  if (isMouseButtonEnabled(eventData.which, options.mouseButtonMask)) {\n    element.addEventListener(EVENTS.MOUSE_DRAG, mouseDragCallback);\n    element.addEventListener(EVENTS.MOUSE_UP, mouseUpCallback);\n    element.addEventListener(EVENTS.MOUSE_CLICK, mouseUpCallback);\n\n    e.preventDefault();\n    e.stopPropagation();\n  }\n}\n\nfunction defaultStrategy (eventData) {\n  // Here we normalize the ww/wc adjustments so the same number of on screen pixels\n  // Adjusts the same percentage of the dynamic range of the image.  This is needed to\n  // Provide consistency for the ww/wc tool regardless of the dynamic range (e.g. an 8 bit\n  // Image will feel the same as a 16 bit image would)\n  const maxVOI = eventData.image.maxPixelValue * eventData.image.slope + eventData.image.intercept;\n  const minVOI = eventData.image.minPixelValue * eventData.image.slope + eventData.image.intercept;\n  const imageDynamicRange = maxVOI - minVOI;\n  const multiplier = imageDynamicRange / 1024;\n\n  const deltaX = eventData.deltaPoints.page.x * multiplier;\n  const deltaY = eventData.deltaPoints.page.y * multiplier;\n\n  eventData.viewport.voi.windowWidth += (deltaX);\n  eventData.viewport.voi.windowCenter += (deltaY);\n}\n\nfunction mouseDragCallback (e) {\n  const eventData = e.detail;\n\n  wwwc.strategy(eventData);\n  external.cornerstone.setViewport(eventData.element, eventData.viewport);\n}\n\nfunction touchDragCallback (e) {\n  const eventData = e.detail;\n\n  e.stopImmediatePropagation(); // Prevent CornerstoneToolsTouchStartActive from killing any press events\n  const dragData = eventData;\n\n  const maxVOI = dragData.image.maxPixelValue * dragData.image.slope + dragData.image.intercept;\n  const minVOI = dragData.image.minPixelValue * dragData.image.slope + dragData.image.intercept;\n  const imageDynamicRange = maxVOI - minVOI;\n  const multiplier = imageDynamicRange / 1024;\n  const deltaX = dragData.deltaPoints.page.x * multiplier;\n  const deltaY = dragData.deltaPoints.page.y * multiplier;\n\n  const config = wwwc.getConfiguration();\n\n  if (config.orientation) {\n    if (config.orientation === 0) {\n      dragData.viewport.voi.windowWidth += (deltaX);\n      dragData.viewport.voi.windowCenter += (deltaY);\n    } else {\n      dragData.viewport.voi.windowWidth += (deltaY);\n      dragData.viewport.voi.windowCenter += (deltaX);\n    }\n  } else {\n    dragData.viewport.voi.windowWidth += (deltaX);\n    dragData.viewport.voi.windowCenter += (deltaY);\n  }\n\n  external.cornerstone.setViewport(dragData.element, dragData.viewport);\n}\n\nconst wwwc = simpleMouseButtonTool(mouseDownCallback, toolType);\n\nwwwc.strategies = {\n  default: defaultStrategy\n};\n\nwwwc.strategy = defaultStrategy;\n\nconst wwwcTouchDrag = touchDragTool(touchDragCallback);\n\nexport {\n  wwwc,\n  wwwcTouchDrag\n};\n\n\n\n// WEBPACK FOOTER //\n// ./tools/image/wwwc.js","import EVENTS from '@/events.js';\nimport external from '@/externalModules.js';\nimport toolStyle from '@/stateManagement/toolStyle.js';\nimport toolColors from '@/stateManagement/toolColors.js';\nimport { getToolState, addToolState } from '@/stateManagement/toolState.js';\nimport getLuminance from '@/util/getLuminance.js';\nimport isMouseButtonEnabled from '@/util/isMouseButtonEnabled.js';\nimport { setToolOptions, getToolOptions } from '@/toolOptions.js';\n\nconst toolType = 'wwwcRegion';\n\nlet configuration = {\n  minWindowWidth: 10\n};\n\n/** Calculates the minimum, maximum, and mean value in the given pixel array */\nfunction calculateMinMaxMean (storedPixelLuminanceData, globalMin, globalMax) {\n  const numPixels = storedPixelLuminanceData.length;\n\n  if (numPixels < 2) {\n    return {\n      min: globalMin,\n      max: globalMax,\n      mean: (globalMin + globalMax) / 2\n    };\n  }\n\n  let min = globalMax;\n  let max = globalMin;\n  let sum = 0;\n\n  for (let index = 0; index < numPixels; index++) {\n    const spv = storedPixelLuminanceData[index];\n\n    min = Math.min(min, spv);\n    max = Math.max(max, spv);\n    sum += spv;\n  }\n\n  return {\n    min,\n    max,\n    mean: sum / numPixels\n  };\n}\n\n/* Erases the toolData and rebinds the handlers when the image changes */\nfunction newImageCallback (e) {\n  const eventData = e.detail;\n  const element = eventData.element;\n  const toolData = getToolState(element, toolType);\n\n  if (toolData && toolData.data) {\n    toolData.data = [];\n  }\n\n  element.removeEventListener(EVENTS.MOUSE_MOVE, dragCallback);\n  element.removeEventListener(EVENTS.MOUSE_DRAG, dragCallback);\n\n  element.removeEventListener(EVENTS.MOUSE_UP, dragEndCallback);\n  element.removeEventListener(EVENTS.MOUSE_CLICK, dragEndCallback);\n\n  element.addEventListener(EVENTS.MOUSE_DOWN, mouseDownCallback);\n}\n\n/* Applies the windowing procedure when the mouse drag ends */\nfunction dragEndCallback (e) {\n  const eventData = e.detail;\n  const element = eventData.element;\n\n  element.removeEventListener(EVENTS.MOUSE_MOVE, dragCallback);\n  element.removeEventListener(EVENTS.MOUSE_DRAG, dragCallback);\n\n  element.removeEventListener(EVENTS.MOUSE_UP, dragEndCallback);\n  element.removeEventListener(EVENTS.MOUSE_CLICK, dragEndCallback);\n\n  element.addEventListener(EVENTS.MOUSE_DOWN, mouseDownCallback);\n\n  const toolData = getToolState(eventData.element, toolType);\n\n  if (!toolData || !toolData.data || !toolData.data.length) {\n    return;\n  }\n\n  // Update the endpoint as the mouse/touch is dragged\n  toolData.data[0].endPoint = {\n    x: eventData.currentPoints.image.x,\n    y: eventData.currentPoints.image.y\n  };\n\n  applyWWWCRegion(eventData);\n}\n\n/** Calculates the minimum and maximum value in the given pixel array */\nfunction applyWWWCRegion (eventData) {\n  const cornerstone = external.cornerstone;\n  const toolData = getToolState(eventData.element, toolType);\n\n  if (!toolData || !toolData.data || !toolData.data.length) {\n    return;\n  }\n\n  const startPoint = toolData.data[0].startPoint;\n  const endPoint = toolData.data[0].endPoint;\n\n  // Get the rectangular region defined by the handles\n  let width = Math.abs(startPoint.x - endPoint.x);\n  let height = Math.abs(startPoint.y - endPoint.y);\n\n  let left = Math.min(startPoint.x, endPoint.x);\n  let top = Math.min(startPoint.y, endPoint.y);\n\n  // Bound the rectangle so we don't get undefined pixels\n  left = Math.max(left, 0);\n  left = Math.min(left, eventData.image.width);\n  top = Math.max(top, 0);\n  top = Math.min(top, eventData.image.height);\n  width = Math.floor(Math.min(width, Math.abs(eventData.image.width - left)));\n  height = Math.floor(Math.min(height, Math.abs(eventData.image.height - top)));\n\n  // Get the pixel data in the rectangular region\n  const pixelLuminanceData = getLuminance(eventData.element, left, top, width, height);\n\n  // Calculate the minimum and maximum pixel values\n  const minMaxMean = calculateMinMaxMean(pixelLuminanceData, eventData.image.minPixelValue, eventData.image.maxPixelValue);\n\n  // Adjust the viewport window width and center based on the calculated values\n  const config = wwwcRegion.getConfiguration();\n  const viewport = cornerstone.getViewport(eventData.element);\n\n  if (config.minWindowWidth === undefined) {\n    config.minWindowWidth = 10;\n  }\n\n  viewport.voi.windowWidth = Math.max(Math.abs(minMaxMean.max - minMaxMean.min), config.minWindowWidth);\n  viewport.voi.windowCenter = minMaxMean.mean;\n  cornerstone.setViewport(eventData.element, viewport);\n\n  // Clear the toolData\n  toolData.data = [];\n\n  cornerstone.updateImage(eventData.element);\n}\n\nfunction whichMovement (e) {\n  const eventData = e.detail;\n  const element = eventData.element;\n\n  element.removeEventListener(EVENTS.MOUSE_MOVE, whichMovement);\n  element.removeEventListener(EVENTS.MOUSE_DRAG, whichMovement);\n\n  element.addEventListener(EVENTS.MOUSE_MOVE, dragCallback);\n  element.addEventListener(EVENTS.MOUSE_DRAG, dragCallback);\n\n  element.addEventListener(EVENTS.MOUSE_CLICK, dragEndCallback);\n  if (e.type === EVENTS.MOUSE_DRAG) {\n    element.addEventListener(EVENTS.MOUSE_UP, dragEndCallback);\n  }\n}\n\n/** Records the start point and attaches the drag event handler */\nfunction mouseDownCallback (e) {\n  const eventData = e.detail;\n  const element = eventData.element;\n  const options = getToolOptions(toolType, element);\n\n  if (isMouseButtonEnabled(eventData.which, options.mouseButtonMask)) {\n    element.addEventListener(EVENTS.MOUSE_DRAG, whichMovement);\n    element.addEventListener(EVENTS.MOUSE_MOVE, whichMovement);\n\n    element.removeEventListener(EVENTS.MOUSE_DOWN, mouseDownCallback);\n    recordStartPoint(eventData);\n\n    return false;\n  }\n}\n\n/** Records the start point of the click or touch */\nfunction recordStartPoint (eventData) {\n  const toolData = getToolState(eventData.element, toolType);\n\n  if (toolData && toolData.data) {\n    toolData.data = [];\n  }\n\n  const measurementData = {\n    startPoint: {\n      x: eventData.currentPoints.image.x,\n      y: eventData.currentPoints.image.y\n    }\n  };\n\n  addToolState(eventData.element, toolType, measurementData);\n}\n\n/** Draws the rectangular region while the touch or mouse event drag occurs */\nfunction dragCallback (e) {\n  const eventData = e.detail;\n  const element = eventData.element;\n\n  // If we have no toolData for this element, return immediately as there is nothing to do\n  const toolData = getToolState(element, toolType);\n\n  if (!toolData || !toolData.data || !toolData.data.length) {\n    return;\n  }\n\n  // Update the endpoint as the mouse/touch is dragged\n  toolData.data[0].endPoint = {\n    x: eventData.currentPoints.image.x,\n    y: eventData.currentPoints.image.y\n  };\n\n  external.cornerstone.updateImage(element);\n}\n\nfunction onImageRendered (e) {\n  const eventData = e.detail;\n  const element = eventData.element;\n  const context = eventData.canvasContext;\n  const cornerstone = external.cornerstone;\n  const toolData = getToolState(eventData.element, toolType);\n\n  if (!toolData || !toolData.data || !toolData.data.length) {\n    return;\n  }\n\n  const startPoint = toolData.data[0].startPoint;\n  const endPoint = toolData.data[0].endPoint;\n\n  if (!startPoint || !endPoint) {\n    return;\n  }\n\n  context.setTransform(1, 0, 0, 1, 0, 0);\n\n  // Set to the active tool color\n  const color = toolColors.getActiveColor();\n\n  // Calculate the rectangle parameters\n  const startPointCanvas = cornerstone.pixelToCanvas(element, startPoint);\n  const endPointCanvas = cornerstone.pixelToCanvas(element, endPoint);\n\n  const left = Math.min(startPointCanvas.x, endPointCanvas.x);\n  const top = Math.min(startPointCanvas.y, endPointCanvas.y);\n  const width = Math.abs(startPointCanvas.x - endPointCanvas.x);\n  const height = Math.abs(startPointCanvas.y - endPointCanvas.y);\n\n  const lineWidth = toolStyle.getToolWidth();\n  const config = wwwcRegion.getConfiguration();\n\n  // Draw the rectangle\n  context.save();\n\n  if (config && config.shadow) {\n    context.shadowColor = config.shadowColor || '#000000';\n    context.shadowOffsetX = config.shadowOffsetX || 1;\n    context.shadowOffsetY = config.shadowOffsetY || 1;\n  }\n\n  context.beginPath();\n  context.strokeStyle = color;\n  context.lineWidth = lineWidth;\n  context.rect(left, top, width, height);\n  context.stroke();\n\n  context.restore();\n}\n\n// --- Mouse tool enable / disable --- ///\nfunction disable (element) {\n  element.removeEventListener(EVENTS.MOUSE_DOWN, mouseDownCallback);\n\n  element.removeEventListener(EVENTS.MOUSE_UP, dragEndCallback);\n  element.removeEventListener(EVENTS.MOUSE_CLICK, dragEndCallback);\n\n  element.removeEventListener(EVENTS.MOUSE_DRAG, dragCallback);\n  element.removeEventListener(EVENTS.MOUSE_MOVE, dragCallback);\n\n  element.removeEventListener(EVENTS.IMAGE_RENDERED, onImageRendered);\n  element.removeEventListener(EVENTS.NEW_IMAGE, newImageCallback);\n\n  external.cornerstone.updateImage(element);\n}\n\nfunction activate (element, mouseButtonMask) {\n  setToolOptions(toolType, element, { mouseButtonMask });\n\n  const toolData = getToolState(element, toolType);\n\n  if (!toolData) {\n    const data = [];\n\n    addToolState(element, toolType, data);\n  }\n\n  element.removeEventListener(EVENTS.MOUSE_DOWN, mouseDownCallback);\n\n  element.removeEventListener(EVENTS.MOUSE_UP, dragEndCallback);\n  element.removeEventListener(EVENTS.MOUSE_CLICK, dragEndCallback);\n\n  element.removeEventListener(EVENTS.MOUSE_DRAG, dragCallback);\n  element.removeEventListener(EVENTS.MOUSE_MOVE, dragCallback);\n\n  element.removeEventListener(EVENTS.IMAGE_RENDERED, onImageRendered);\n  element.removeEventListener(EVENTS.NEW_IMAGE, newImageCallback);\n\n  element.addEventListener(EVENTS.MOUSE_DOWN, mouseDownCallback);\n  element.addEventListener(EVENTS.IMAGE_RENDERED, onImageRendered);\n\n  // If the displayed image changes after the user has started clicking, we should\n  // Cancel the handlers and prepare for another click\n  element.addEventListener(EVENTS.NEW_IMAGE, newImageCallback);\n\n  external.cornerstone.updateImage(element);\n}\n\n// --- Touch tool enable / disable --- //\nfunction disableTouchDrag (element) {\n  element.removeEventListener(EVENTS.TOUCH_DRAG, dragCallback);\n  element.removeEventListener(EVENTS.TOUCH_START, recordStartPoint);\n  element.removeEventListener(EVENTS.TOUCH_DRAG_END, applyWWWCRegion);\n  element.removeEventListener(EVENTS.IMAGE_RENDERED, onImageRendered);\n}\n\nfunction activateTouchDrag (element) {\n  const toolData = getToolState(element, toolType);\n\n  if (!toolData) {\n    const data = [];\n\n    addToolState(element, toolType, data);\n  }\n\n  element.removeEventListener(EVENTS.TOUCH_DRAG, dragCallback);\n  element.removeEventListener(EVENTS.TOUCH_START, recordStartPoint);\n  element.removeEventListener(EVENTS.TOUCH_DRAG_END, applyWWWCRegion);\n  element.removeEventListener(EVENTS.IMAGE_RENDERED, onImageRendered);\n\n  element.addEventListener(EVENTS.TOUCH_DRAG, dragCallback);\n  element.addEventListener(EVENTS.TOUCH_START, recordStartPoint);\n  element.addEventListener(EVENTS.TOUCH_DRAG_END, applyWWWCRegion);\n  element.addEventListener(EVENTS.IMAGE_RENDERED, onImageRendered);\n}\n\nfunction getConfiguration () {\n  return configuration;\n}\n\nfunction setConfiguration (config) {\n  configuration = config;\n}\n\n// Module exports\nconst wwwcRegion = {\n  activate,\n  deactivate: disable,\n  disable,\n  setConfiguration,\n  getConfiguration\n};\n\nconst wwwcRegionTouch = {\n  activate: activateTouchDrag,\n  deactivate: disableTouchDrag,\n  disable: disableTouchDrag\n};\n\nexport {\n  wwwcRegion,\n  wwwcRegionTouch\n};\n\n\n\n// WEBPACK FOOTER //\n// ./tools/image/wwwcRegion.js","import EVENTS from '@/events.js';\nimport external from '@/externalModules.js';\nimport isMouseButtonEnabled from '@/util/isMouseButtonEnabled.js';\nimport {\n  mouseWheelTool,\n  simpleMouseButtonTool,\n  touchDragTool,\n  touchPinchTool } from '@tools/base/index.js';\nimport { getToolOptions } from '@/toolOptions.js';\n\nconst toolType = 'zoom';\nlet startPoints;\n\nfunction changeViewportScale (viewport, ticks) {\n  const config = zoom.getConfiguration();\n  const pow = 1.7;\n\n  const oldFactor = Math.log(viewport.scale) / Math.log(pow);\n  const factor = oldFactor + ticks;\n\n  const scale = Math.pow(pow, factor);\n\n  if (config.maxScale && scale > config.maxScale) {\n    viewport.scale = config.maxScale;\n  } else if (config.minScale && scale < config.minScale) {\n    viewport.scale = config.minScale;\n  } else {\n    viewport.scale = scale;\n  }\n\n  return viewport;\n}\n\nfunction boundPosition (position, width, height) {\n  position.x = Math.max(position.x, 0);\n  position.y = Math.max(position.y, 0);\n  position.x = Math.min(position.x, width);\n  position.y = Math.min(position.y, height);\n\n  return position;\n}\n\nfunction correctShift (shift, viewport) {\n  // Apply Flips\n  if (viewport.hflip) {\n    shift.x *= -1;\n  }\n\n  if (viewport.vflip) {\n    shift.y *= -1;\n  }\n\n  // Apply rotations\n  if (viewport.rotation !== 0) {\n    const angle = viewport.rotation * Math.PI / 180;\n\n    const cosA = Math.cos(angle);\n    const sinA = Math.sin(angle);\n\n    const newX = shift.x * cosA - shift.y * sinA;\n    const newY = shift.x * sinA + shift.y * cosA;\n\n    shift.x = newX;\n    shift.y = newY;\n  }\n\n  return shift;\n}\n\nfunction defaultStrategy (eventData, ticks) {\n  const cornerstone = external.cornerstone;\n  const element = eventData.element;\n\n  // Calculate the new scale factor based on how far the mouse has changed\n  const viewport = changeViewportScale(eventData.viewport, ticks);\n\n  cornerstone.setViewport(element, viewport);\n\n  // Now that the scale has been updated, determine the offset we need to apply to the center so we can\n  // Keep the original start location in the same position\n  const newCoords = cornerstone.pageToPixel(element, eventData.startPoints.page.x, eventData.startPoints.page.y);\n\n  // The shift we will use is the difference between the original image coordinates of the point we've selected\n  // And the image coordinates of the same point on the page after the viewport scaling above has been performed\n  // This shift is in image coordinates, and is designed to keep the target location fixed on the page.\n  let shift = {\n    x: eventData.startPoints.image.x - newCoords.x,\n    y: eventData.startPoints.image.y - newCoords.y\n  };\n\n    // Correct the required shift using the viewport rotation and flip parameters\n  shift = correctShift(shift, viewport);\n\n  // Apply the shift to the Viewport's translation setting\n  viewport.translation.x -= shift.x;\n  viewport.translation.y -= shift.y;\n\n  // Update the Viewport with the new translation value\n  cornerstone.setViewport(element, viewport);\n}\n\nfunction translateStrategy (eventData, ticks) {\n  const element = eventData.element;\n  const image = eventData.image;\n  const config = zoom.getConfiguration();\n\n  // Calculate the new scale factor based on how far the mouse has changed\n  // Note that in this case we don't need to update the viewport after the initial\n  // Zoom step since we aren't don't intend to keep the target position static on\n  // The page\n  const viewport = changeViewportScale(eventData.viewport, ticks);\n\n  // Define the default shift to take place during this zoom step\n  const shift = {\n    x: 0,\n    y: 0\n  };\n\n    // Define the parameters for the translate strategy\n  const translateSpeed = 8;\n  const outwardsMinScaleToTranslate = 3;\n  const minTranslation = 0.01;\n\n  if (ticks < 0) {\n    // Zoom outwards from the image center\n    if (viewport.scale < outwardsMinScaleToTranslate) {\n      // If the current translation is smaller than the minimum desired translation,\n      // Set the translation to zero\n      if (Math.abs(viewport.translation.x) < minTranslation) {\n        viewport.translation.x = 0;\n      } else {\n        shift.x = viewport.translation.x / translateSpeed;\n      }\n\n      // If the current translation is smaller than the minimum desired translation,\n      // Set the translation to zero\n      if (Math.abs(viewport.translation.y) < minTranslation) {\n        viewport.translation.y = 0;\n      } else {\n        shift.y = viewport.translation.y / translateSpeed;\n      }\n    }\n  } else {\n    // Zoom inwards to the current image point\n\n    // Identify the coordinates of the point the user is trying to zoom into\n    // If we are not allowed to zoom outside the image, bound the user-selected position to\n    // A point inside the image\n    if (config && config.preventZoomOutsideImage) {\n      startPoints.image = boundPosition(startPoints.image, image.width, image.height);\n    }\n\n    // Calculate the translation value that would place the desired image point in the center\n    // Of the viewport\n    let desiredTranslation = {\n      x: image.width / 2 - startPoints.image.x,\n      y: image.height / 2 - startPoints.image.y\n    };\n\n    // Correct the target location using the viewport rotation and flip parameters\n    desiredTranslation = correctShift(desiredTranslation, viewport);\n\n    // Calculate the difference between the current viewport translation value and the\n    // Final desired translation values\n    const distanceToDesired = {\n      x: viewport.translation.x - desiredTranslation.x,\n      y: viewport.translation.y - desiredTranslation.y\n    };\n\n    // If the current translation is smaller than the minimum desired translation,\n    // Stop translating in the x-direction\n    if (Math.abs(distanceToDesired.x) < minTranslation) {\n      viewport.translation.x = desiredTranslation.x;\n    } else {\n      // Otherwise, shift the viewport by one step\n      shift.x = distanceToDesired.x / translateSpeed;\n    }\n\n    // If the current translation is smaller than the minimum desired translation,\n    // Stop translating in the y-direction\n    if (Math.abs(distanceToDesired.y) < minTranslation) {\n      viewport.translation.y = desiredTranslation.y;\n    } else {\n      // Otherwise, shift the viewport by one step\n      shift.y = distanceToDesired.y / translateSpeed;\n    }\n  }\n\n  // Apply the shift to the Viewport's translation setting\n  viewport.translation.x -= shift.x;\n  viewport.translation.y -= shift.y;\n\n  // Update the Viewport with the new translation value\n  external.cornerstone.setViewport(element, viewport);\n}\n\nfunction zoomToCenterStrategy (eventData, ticks) {\n  const element = eventData.element;\n\n  // Calculate the new scale factor based on how far the mouse has changed\n  const viewport = changeViewportScale(eventData.viewport, ticks);\n\n  external.cornerstone.setViewport(element, viewport);\n}\n\nfunction mouseUpCallback (e) {\n  const eventData = e.detail;\n  const element = eventData.element;\n\n  element.removeEventListener(EVENTS.MOUSE_DRAG, dragCallback);\n  element.removeEventListener(EVENTS.MOUSE_UP, mouseUpCallback);\n  element.removeEventListener(EVENTS.MOUSE_CLICK, mouseUpCallback);\n}\n\nfunction mouseDownCallback (e) {\n  const eventData = e.detail;\n  const element = eventData.element;\n  const options = getToolOptions(toolType, element);\n\n  if (isMouseButtonEnabled(eventData.which, options.mouseButtonMask)) {\n    startPoints = eventData.startPoints; // Used for translateStrategy\n    element.addEventListener(EVENTS.MOUSE_DRAG, dragCallback);\n    element.addEventListener(EVENTS.MOUSE_UP, mouseUpCallback);\n    element.addEventListener(EVENTS.MOUSE_CLICK, mouseUpCallback);\n\n    e.preventDefault();\n    e.stopPropagation();\n  }\n}\n\nfunction dragCallback (e) {\n  const eventData = e.detail;\n\n  if (!eventData.deltaPoints.page.y) {\n    return false;\n  }\n\n  const ticks = eventData.deltaPoints.page.y / 100;\n\n  zoom.strategy(eventData, ticks);\n\n  e.preventDefault();\n  e.stopPropagation();\n}\n\nfunction mouseWheelCallback (e) {\n  const eventData = e.detail;\n  let ticks = -eventData.direction / 4;\n\n  // Allow inversion of the mouse wheel scroll via a configuration option\n  const config = zoom.getConfiguration();\n\n  if (config && config.invert) {\n    ticks *= -1;\n  }\n\n  const viewport = changeViewportScale(eventData.viewport, ticks);\n\n  external.cornerstone.setViewport(eventData.element, viewport);\n}\n\nfunction touchPinchCallback (e) {\n  const eventData = e.detail;\n  const cornerstone = external.cornerstone;\n  const config = zoom.getConfiguration();\n  const viewport = eventData.viewport;\n  const element = eventData.element;\n\n  // Change the scale based on the pinch gesture's scale change\n  viewport.scale += eventData.scaleChange * viewport.scale;\n  if (config.maxScale && viewport.scale > config.maxScale) {\n    viewport.scale = config.maxScale;\n  } else if (config.minScale && viewport.scale < config.minScale) {\n    viewport.scale = config.minScale;\n  }\n\n  cornerstone.setViewport(element, viewport);\n\n  // Now that the scale has been updated, determine the offset we need to apply to the center so we can\n  // Keep the original start location in the same position\n  const newCoords = cornerstone.pageToPixel(element, eventData.startPoints.page.x, eventData.startPoints.page.y);\n  let shift = {\n    x: eventData.startPoints.image.x - newCoords.x,\n    y: eventData.startPoints.image.y - newCoords.y\n  };\n\n  shift = correctShift(shift, viewport);\n  viewport.translation.x -= shift.x;\n  viewport.translation.y -= shift.y;\n  cornerstone.setViewport(element, viewport);\n}\n\nconst zoom = simpleMouseButtonTool(mouseDownCallback, toolType);\n\nzoom.strategies = {\n  default: defaultStrategy,\n  translate: translateStrategy,\n  zoomToCenter: zoomToCenterStrategy\n};\n\nzoom.strategy = defaultStrategy;\n\nconst zoomWheel = mouseWheelTool(mouseWheelCallback);\nconst zoomTouchPinch = touchPinchTool(touchPinchCallback);\nconst zoomTouchDrag = touchDragTool(dragCallback, toolType);\n\nexport {\n  zoom,\n  zoomWheel,\n  zoomTouchPinch,\n  zoomTouchDrag\n};\n\n\n\n// WEBPACK FOOTER //\n// ./tools/image/zoom.js","/* eslint no-bitwise:0 */\nimport EVENTS from '@/events.js';\nimport external from '@/externalModules.js';\nimport loadHandlerManager from '@/stateManagement/loadHandlerManager.js';\nimport { addToolState, getToolState } from '@/stateManagement/toolState.js';\nimport triggerEvent from '@/util/triggerEvent.js';\n\nconst toolType = 'playClip';\n\n/**\n * [private] Turns a Frame Time Vector (0018,1065) array into a normalized array of timeouts. Each element\n * ... of the resulting array represents the amount of time each frame will remain on the screen.\n * @param {Array} vector A Frame Time Vector (0018,1065) as specified in section C.7.6.5.1.2 of DICOM standard.\n * @param {Number} speed A speed factor which will be applied to each element of the resulting array.\n * @return {Array} An array with timeouts for each animation frame.\n */\nfunction getPlayClipTimeouts (vector, speed) {\n\n  let i;\n  let sample;\n  let delay;\n  let sum = 0;\n  const limit = vector.length;\n  const timeouts = [];\n\n  // Initialize time varying to false\n  timeouts.isTimeVarying = false;\n\n  if (typeof speed !== 'number' || speed <= 0) {\n    speed = 1;\n  }\n\n  // First element of a frame time vector must be discarded\n  for (i = 1; i < limit; i++) {\n    delay = (Number(vector[i]) / speed) | 0; // Integral part only\n    timeouts.push(delay);\n    if (i === 1) { // Use first item as a sample for comparison\n      sample = delay;\n    } else if (delay !== sample) {\n      timeouts.isTimeVarying = true;\n    }\n\n    sum += delay;\n  }\n\n  if (timeouts.length > 0) {\n    if (timeouts.isTimeVarying) {\n      // If it's a time varying vector, make the last item an average...\n      delay = (sum / timeouts.length) | 0;\n    } else {\n      delay = timeouts[0];\n    }\n\n    timeouts.push(delay);\n  }\n\n  return timeouts;\n\n}\n\n/**\n * [private] Performs the heavy lifting of stopping an ongoing animation.\n * @param {Object} playClipData The data from playClip that needs to be stopped.\n * @return void\n */\nfunction stopClipWithData (playClipData) {\n  const id = playClipData.intervalId;\n\n  if (typeof id !== 'undefined') {\n    playClipData.intervalId = undefined;\n    if (playClipData.usingFrameTimeVector) {\n      clearTimeout(id);\n    } else {\n      clearInterval(id);\n    }\n  }\n}\n\n/**\n * [private] Trigger playClip tool stop event.\n * @param element\n * @return void\n */\nfunction triggerStopEvent (element) {\n  const eventDetail = {\n    element\n  };\n\n  triggerEvent(element, EVENTS.CLIP_STOPPED, eventDetail);\n}\n\n/**\n * Starts playing a clip or adjusts the frame rate of an already playing clip.  framesPerSecond is\n * optional and defaults to 30 if not specified.  A negative framesPerSecond will play the clip in reverse.\n * The element must be a stack of images\n * @param element\n * @param framesPerSecond\n */\nfunction playClip (element, framesPerSecond) {\n  let playClipData;\n  let playClipTimeouts;\n\n  if (element === undefined) {\n    throw new Error('playClip: element must not be undefined');\n  }\n\n  const stackToolData = getToolState(element, 'stack');\n\n  if (!stackToolData || !stackToolData.data || !stackToolData.data.length) {\n    return;\n  }\n\n  const cornerstone = external.cornerstone;\n  // If we have more than one stack, check if we have a stack renderer defined\n  let stackRenderer;\n\n  if (stackToolData.data.length > 1) {\n    const stackRendererData = getToolState(element, 'stackRenderer');\n\n    if (stackRendererData && stackRendererData.data && stackRendererData.data.length) {\n      stackRenderer = stackRendererData.data[0];\n    }\n  }\n\n  const stackData = stackToolData.data[0];\n\n  const playClipToolData = getToolState(element, toolType);\n\n  if (!playClipToolData || !playClipToolData.data || !playClipToolData.data.length) {\n    playClipData = {\n      intervalId: undefined,\n      framesPerSecond: 30,\n      lastFrameTimeStamp: undefined,\n      frameRate: 0,\n      frameTimeVector: undefined,\n      ignoreFrameTimeVector: false,\n      usingFrameTimeVector: false,\n      speed: 1,\n      reverse: false,\n      loop: true\n    };\n    addToolState(element, toolType, playClipData);\n  } else {\n    playClipData = playClipToolData.data[0];\n    // Make sure the specified clip is not running before any property update\n    stopClipWithData(playClipData);\n  }\n\n  // If a framesPerSecond is specified and is valid, update the playClipData now\n  if (framesPerSecond < 0 || framesPerSecond > 0) {\n    playClipData.framesPerSecond = Number(framesPerSecond);\n    playClipData.reverse = playClipData.framesPerSecond < 0;\n    // If framesPerSecond is given, frameTimeVector will be ignored...\n    playClipData.ignoreFrameTimeVector = true;\n  }\n\n  // Determine if frame time vector should be used instead of a fixed frame rate...\n  if (\n    playClipData.ignoreFrameTimeVector !== true &&\n        playClipData.frameTimeVector &&\n        playClipData.frameTimeVector.length === stackData.imageIds.length\n  ) {\n    playClipTimeouts = getPlayClipTimeouts(playClipData.frameTimeVector, playClipData.speed);\n  }\n\n  // This function encapsulates the frame rendering logic...\n  const playClipAction = () => {\n\n    // Hoisting of context variables\n    let loader,\n      startLoadingHandler,\n      endLoadingHandler,\n      errorLoadingHandler,\n      newImageIdIndex = stackData.currentImageIdIndex;\n\n    const imageCount = stackData.imageIds.length;\n\n    if (playClipData.reverse) {\n      newImageIdIndex--;\n    } else {\n      newImageIdIndex++;\n    }\n\n    if (!playClipData.loop && (newImageIdIndex < 0 || newImageIdIndex >= imageCount)) {\n      stopClipWithData(playClipData);\n      triggerStopEvent(element);\n\n      return;\n    }\n\n    // Loop around if we go outside the stack\n    if (newImageIdIndex >= imageCount) {\n      newImageIdIndex = 0;\n    }\n\n    if (newImageIdIndex < 0) {\n      newImageIdIndex = imageCount - 1;\n    }\n\n    if (newImageIdIndex !== stackData.currentImageIdIndex) {\n\n      startLoadingHandler = loadHandlerManager.getStartLoadHandler();\n      endLoadingHandler = loadHandlerManager.getEndLoadHandler();\n      errorLoadingHandler = loadHandlerManager.getErrorLoadingHandler();\n\n      if (startLoadingHandler) {\n        startLoadingHandler(element);\n      }\n\n      if (stackData.preventCache === true) {\n        loader = cornerstone.loadImage(stackData.imageIds[newImageIdIndex]);\n      } else {\n        loader = cornerstone.loadAndCacheImage(stackData.imageIds[newImageIdIndex]);\n      }\n\n      loader.then(function (image) {\n        try {\n          stackData.currentImageIdIndex = newImageIdIndex;\n          if (stackRenderer) {\n            stackRenderer.currentImageIdIndex = newImageIdIndex;\n            stackRenderer.render(element, stackToolData.data);\n          } else {\n            cornerstone.displayImage(element, image);\n          }\n          if (endLoadingHandler) {\n            endLoadingHandler(element, image);\n          }\n        } catch (error) {\n          return;\n        }\n      }, function (error) {\n        const imageId = stackData.imageIds[newImageIdIndex];\n\n        if (errorLoadingHandler) {\n          errorLoadingHandler(element, imageId, error);\n        }\n      });\n\n    }\n\n  };\n\n    // If playClipTimeouts array is available, not empty and its elements are NOT uniform ...\n    // ... (at least one timeout is different from the others), use alternate setTimeout implementation\n  if (playClipTimeouts && playClipTimeouts.length > 0 && playClipTimeouts.isTimeVarying) {\n    playClipData.usingFrameTimeVector = true;\n    playClipData.intervalId = setTimeout(function playClipTimeoutHandler () {\n      playClipData.intervalId = setTimeout(playClipTimeoutHandler, playClipTimeouts[stackData.currentImageIdIndex]);\n      playClipAction();\n    }, 0);\n  } else {\n    // ... otherwise user setInterval implementation which is much more efficient.\n    playClipData.usingFrameTimeVector = false;\n    playClipData.intervalId = setInterval(playClipAction, 1000 / Math.abs(playClipData.framesPerSecond));\n  }\n\n}\n\n/**\n * Stops an already playing clip.\n * * @param element\n */\nfunction stopClip (element) {\n\n  const playClipToolData = getToolState(element, toolType);\n\n  if (!playClipToolData || !playClipToolData.data || !playClipToolData.data.length) {\n    return;\n  }\n\n  stopClipWithData(playClipToolData.data[0]);\n\n}\n\nexport {\n  playClip,\n  stopClip\n};\n\n\n\n// WEBPACK FOOTER //\n// ./tools/stack/playClip.js","import displayTool from '@/tools/image/displayTool.js';\nimport { getToolState } from '@/stateManagement/toolState.js';\n\n/*\nDisplay scroll progress bar across bottom of image.\n */\nconst scrollBarHeight = 6;\n\nconst configuration = {\n  backgroundColor: 'rgb(19, 63, 141)',\n  fillColor: 'white',\n  orientation: 'horizontal'\n};\n\nfunction onImageRendered (e) {\n  const eventData = e.detail;\n  const element = eventData.element;\n  const width = eventData.enabledElement.canvas.width;\n  const height = eventData.enabledElement.canvas.height;\n\n  if (!width || !height) {\n    return false;\n  }\n\n  const context = eventData.enabledElement.canvas.getContext('2d');\n\n  context.setTransform(1, 0, 0, 1, 0, 0);\n  context.save();\n\n  const config = scrollIndicator.getConfiguration();\n\n  // Draw indicator background\n  context.fillStyle = config.backgroundColor;\n  if (config.orientation === 'horizontal') {\n    context.fillRect(0, height - scrollBarHeight, width, scrollBarHeight);\n  } else {\n    context.fillRect(0, 0, scrollBarHeight, height);\n  }\n\n  // Get current image index\n  const stackData = getToolState(element, 'stack');\n\n  if (!stackData || !stackData.data || !stackData.data.length) {\n    return;\n  }\n\n  const imageIds = stackData.data[0].imageIds;\n  const currentImageIdIndex = stackData.data[0].currentImageIdIndex;\n\n  // Draw current image cursor\n  const cursorWidth = width / imageIds.length;\n  const cursorHeight = height / imageIds.length;\n  const xPosition = cursorWidth * currentImageIdIndex;\n  const yPosition = cursorHeight * currentImageIdIndex;\n\n  context.fillStyle = config.fillColor;\n  if (config.orientation === 'horizontal') {\n    context.fillRect(xPosition, height - scrollBarHeight, cursorWidth, scrollBarHeight);\n  } else {\n    context.fillRect(0, yPosition, scrollBarHeight, cursorHeight);\n  }\n\n  context.restore();\n}\n\nconst scrollIndicator = displayTool(onImageRendered);\n\nscrollIndicator.setConfiguration(configuration);\n\nexport default scrollIndicator;\n\n\n\n// WEBPACK FOOTER //\n// ./tools/stack/scrollIndicator.js","import EVENTS from '@/events.js';\nimport external from '@/externalModules.js';\nimport requestPoolManager from '@/requestPool/requestPoolManager.js';\nimport loadHandlerManager from '@/stateManagement/loadHandlerManager.js';\nimport { addToolState, getToolState } from '@/stateManagement/toolState.js';\nimport { setMaxSimultaneousRequests } from '@/util/getMaxSimultaneousRequests.js';\n\nconst toolType = 'stackPrefetch';\nconst requestType = 'prefetch';\n\nlet configuration = {\n  maxImagesToPrefetch: Infinity\n};\n\nlet resetPrefetchTimeout;\nconst resetPrefetchDelay = 10;\n\nfunction range (lowEnd, highEnd) {\n  // Javascript version of Python's range function\n  // http://stackoverflow.com/questions/3895478/does-javascript-have-a-method-like-range-to-generate-an-array-based-on-suppl\n  lowEnd = Math.round(lowEnd) || 0;\n  highEnd = Math.round(highEnd) || 0;\n\n  const arr = [];\n  let c = highEnd - lowEnd + 1;\n\n  if (c <= 0) {\n    return arr;\n  }\n\n  while (c--) {\n    arr[c] = highEnd--;\n  }\n\n  return arr;\n}\n\nconst max = function (arr) {\n  return Math.max.apply(null, arr);\n};\n\nconst min = function (arr) {\n  return Math.min.apply(null, arr);\n};\n\nfunction nearestIndex (arr, x) {\n  // Return index of nearest values in array\n  // http://stackoverflow.com/questions/25854212/return-index-of-nearest-values-in-an-array\n  const l = [];\n  const h = [];\n\n  arr.forEach(function (v) {\n    if (v < x) {\n      l.push(v);\n    } else if (v > x) {\n      h.push(v);\n    }\n  });\n\n  return {\n    low: arr.indexOf(max(l)),\n    high: arr.indexOf(min(h))\n  };\n}\n\nfunction prefetch (element) {\n  // Check to make sure stack data exists\n  const stackData = getToolState(element, 'stack');\n\n  if (!stackData || !stackData.data || !stackData.data.length) {\n    return;\n  }\n\n  const stack = stackData.data[0];\n\n  // Get the stackPrefetch tool data\n  const stackPrefetchData = getToolState(element, toolType);\n\n  if (!stackPrefetchData) {\n    return;\n  }\n\n  const stackPrefetch = stackPrefetchData.data[0] || {};\n\n  // If all the requests are complete, disable the stackPrefetch tool\n  if (!stackPrefetch.indicesToRequest || !stackPrefetch.indicesToRequest.length) {\n    stackPrefetch.enabled = false;\n  }\n\n  // Make sure the tool is still enabled\n  if (stackPrefetch.enabled === false) {\n    return;\n  }\n\n  // Remove an imageIdIndex from the list of indices to request\n  // This fires when the individual image loading deferred is resolved\n  function removeFromList (imageIdIndex) {\n    const index = stackPrefetch.indicesToRequest.indexOf(imageIdIndex);\n\n    if (index > -1) { // Don't remove last element if imageIdIndex not found\n      stackPrefetch.indicesToRequest.splice(index, 1);\n    }\n  }\n\n  // Remove all already cached images from the\n  // IndicesToRequest array\n  stackPrefetchData.data[0].indicesToRequest.sort((a, b) => (a - b));\n  const indicesToRequestCopy = stackPrefetch.indicesToRequest.slice();\n\n  indicesToRequestCopy.forEach(function (imageIdIndex) {\n    const imageId = stack.imageIds[imageIdIndex];\n\n    if (!imageId) {\n      return;\n    }\n\n    const imageLoadObject = external.cornerstone.imageCache.getImageLoadObject(imageId);\n\n    if (imageLoadObject) {\n      removeFromList(imageIdIndex);\n    }\n  });\n\n  // Stop here if there are no images left to request\n  // After those in the cache have been removed\n  if (!stackPrefetch.indicesToRequest.length) {\n    return;\n  }\n\n  // Clear the requestPool of prefetch requests\n  requestPoolManager.clearRequestStack(requestType);\n\n  // Identify the nearest imageIdIndex to the currentImageIdIndex\n  const nearest = nearestIndex(stackPrefetch.indicesToRequest, stack.currentImageIdIndex);\n\n  let imageId;\n  let nextImageIdIndex;\n  const preventCache = false;\n\n  function doneCallback (image) {\n    // Console.log('prefetch done: ' + image.imageId);\n    const imageIdIndex = stack.imageIds.indexOf(image.imageId);\n\n    removeFromList(imageIdIndex);\n  }\n\n  // Retrieve the errorLoadingHandler if one exists\n  const errorLoadingHandler = loadHandlerManager.getErrorLoadingHandler();\n\n  function failCallback (error) {\n    console.log(`prefetch errored: ${error}`);\n    if (errorLoadingHandler) {\n      errorLoadingHandler(element, imageId, error, 'stackPrefetch');\n    }\n  }\n\n  // Prefetch images around the current image (before and after)\n  let lowerIndex = nearest.low;\n  let higherIndex = nearest.high;\n\n  while (lowerIndex >= 0 || higherIndex < stackPrefetch.indicesToRequest.length) {\n    const currentIndex = stack.currentImageIdIndex;\n    const shouldSkipLower = currentIndex - stackPrefetch.indicesToRequest[lowerIndex] > configuration.maxImagesToPrefetch;\n    const shouldSkipHigher = stackPrefetch.indicesToRequest[higherIndex] - currentIndex > configuration.maxImagesToPrefetch;\n\n    const shouldLoadLower = !shouldSkipLower && lowerIndex >= 0;\n    const shouldLoadHigher = !shouldSkipHigher && higherIndex < stackPrefetch.indicesToRequest.length;\n\n    if (!shouldLoadHigher && !shouldLoadLower) {\n      break;\n    }\n\n    if (shouldLoadLower) {\n      nextImageIdIndex = stackPrefetch.indicesToRequest[lowerIndex--];\n      imageId = stack.imageIds[nextImageIdIndex];\n      requestPoolManager.addRequest(element, imageId, requestType, preventCache, doneCallback, failCallback);\n    }\n\n    if (shouldLoadHigher) {\n      nextImageIdIndex = stackPrefetch.indicesToRequest[higherIndex++];\n      imageId = stack.imageIds[nextImageIdIndex];\n      requestPoolManager.addRequest(element, imageId, requestType, preventCache, doneCallback, failCallback);\n    }\n\n  }\n\n  // Try to start the requestPool's grabbing procedure\n  // In case it isn't already running\n  requestPoolManager.startGrabbing();\n}\n\nfunction getPromiseRemovedHandler (element) {\n  return function (e) {\n    const eventData = e.detail;\n\n    // When an imagePromise has been pushed out of the cache, re-add its index\n    // It to the indicesToRequest list so that it will be retrieved later if the\n    // CurrentImageIdIndex is changed to an image nearby\n    let stackData;\n\n    try {\n      // It will throw an exception in some cases (eg: thumbnails)\n      stackData = getToolState(element, 'stack');\n    } catch(error) {\n      return;\n    }\n\n    if (!stackData || !stackData.data || !stackData.data.length) {\n      return;\n    }\n\n    const stack = stackData.data[0];\n    const imageIdIndex = stack.imageIds.indexOf(eventData.imageId);\n\n    // Make sure the image that was removed is actually in this stack\n    // Before adding it to the indicesToRequest array\n    if (imageIdIndex < 0) {\n      return;\n    }\n\n    const stackPrefetchData = getToolState(element, toolType);\n\n    if (!stackPrefetchData || !stackPrefetchData.data || !stackPrefetchData.data.length) {\n      return;\n    }\n\n    stackPrefetchData.data[0].indicesToRequest.push(imageIdIndex);\n  };\n}\n\nfunction onImageUpdated (e) {\n  // Start prefetching again (after a delay)\n  // When the user has scrolled to a new image\n  clearTimeout(resetPrefetchTimeout);\n  resetPrefetchTimeout = setTimeout(function () {\n    const element = e.target;\n\n    // If playClip is enabled and the user loads a different series in the viewport\n    // An exception will be thrown because the element will not be enabled anymore\n    try {\n      prefetch(element);\n    } catch(error) {\n      return;\n    }\n\n  }, resetPrefetchDelay);\n}\n\nfunction enable (element) {\n  // Clear old prefetch data. Skipping this can cause problems when changing the series inside an element\n  const stackPrefetchDataArray = getToolState(element, toolType);\n\n  stackPrefetchDataArray.data = [];\n\n  // First check that there is stack data available\n  const stackData = getToolState(element, 'stack');\n\n  if (!stackData || !stackData.data || !stackData.data.length) {\n    return;\n  }\n\n  const stack = stackData.data[0];\n\n  // Check if we are allowed to cache images in this stack\n  if (stack.preventCache === true) {\n    console.warn('A stack that should not be cached was given the stackPrefetch');\n\n    return;\n  }\n\n  // Use the currentImageIdIndex from the stack as the initalImageIdIndex\n  const stackPrefetchData = {\n    indicesToRequest: range(0, stack.imageIds.length - 1),\n    enabled: true,\n    direction: 1\n  };\n\n    // Remove the currentImageIdIndex from the list to request\n  const indexOfCurrentImage = stackPrefetchData.indicesToRequest.indexOf(stack.currentImageIdIndex);\n\n  stackPrefetchData.indicesToRequest.splice(indexOfCurrentImage, 1);\n\n  addToolState(element, toolType, stackPrefetchData);\n\n  prefetch(element);\n\n  element.removeEventListener(EVENTS.NEW_IMAGE, onImageUpdated);\n  element.addEventListener(EVENTS.NEW_IMAGE, onImageUpdated);\n\n  const promiseRemovedHandler = getPromiseRemovedHandler(element);\n\n  external.cornerstone.events.removeEventListener(EVENTS.IMAGE_CACHE_PROMISE_REMOVED, promiseRemovedHandler);\n  external.cornerstone.events.addEventListener(EVENTS.IMAGE_CACHE_PROMISE_REMOVED, promiseRemovedHandler);\n}\n\nfunction disable (element) {\n  clearTimeout(resetPrefetchTimeout);\n  element.removeEventListener(EVENTS.NEW_IMAGE, onImageUpdated);\n\n  const promiseRemovedHandler = getPromiseRemovedHandler(element);\n\n  external.cornerstone.events.removeEventListener(EVENTS.IMAGE_CACHE_PROMISE_REMOVED, promiseRemovedHandler);\n\n  const stackPrefetchData = getToolState(element, toolType);\n  // If there is actually something to disable, disable it\n\n  if (stackPrefetchData && stackPrefetchData.data.length) {\n    stackPrefetchData.data[0].enabled = false;\n\n    // Clear current prefetch requests from the requestPool\n    requestPoolManager.clearRequestStack(requestType);\n  }\n}\n\nfunction getConfiguration () {\n  return configuration;\n}\n\nfunction setConfiguration (config) {\n  configuration = config;\n\n  if (config.maxSimultaneousRequests) {\n    setMaxSimultaneousRequests(config.maxSimultaneousRequests);\n  }\n}\n\n// Module/private exports\nconst stackPrefetch = {\n  enable,\n  disable,\n  getConfiguration,\n  setConfiguration\n};\n\nexport default stackPrefetch;\n\n\n\n// WEBPACK FOOTER //\n// ./tools/stack/stackPrefetch.js","import FusionRenderer from './fusionRenderer.js';\n\nconst stackRenderers = {};\n\nstackRenderers.FusionRenderer = FusionRenderer;\n\nexport default stackRenderers;\n\n\n\n// WEBPACK FOOTER //\n// ./tools/stack/stackRenderers.js","import external from '@/externalModules.js';\nimport { getToolState } from '@/stateManagement/toolState.js';\n\nexport default class FusionRenderer {\n  constructor () {\n    this.currentImageIdIndex = 0;\n    this.layerIds = [];\n    this.findImageFn = undefined;\n  }\n\n  render (element, imageStacks) {\n    // Move this to base Renderer class\n    if (!Number.isInteger(this.currentImageIdIndex)) {\n      throw new Error('FusionRenderer: render - Image ID Index is not an integer');\n    }\n\n    if (!this.findImageFn) {\n      throw new Error('No findImage function has been defined');\n    }\n\n    if (!imageStacks) {\n      const toolData = getToolState(element, 'stack');\n\n      imageStacks = toolData.data;\n    }\n    // TODO: Figure out what to do with LoadHandlers in this scenario...\n\n    const cornerstone = external.cornerstone;\n\n    // For the base layer, go to the currentImageIdIndex\n    const baseImageObject = imageStacks[0];\n    const currentImageId = baseImageObject.imageIds[this.currentImageIdIndex];\n    const overlayImageStacks = imageStacks.slice(1, imageStacks.length);\n\n    cornerstone.loadAndCacheImage(currentImageId).then((baseImage) => {\n      let baseLayerId = this.layerIds[0];\n\n      // Get the base layer if one exists\n      if (baseLayerId) {\n        cornerstone.setLayerImage(element, baseImage, baseLayerId);\n      } else {\n        // Otherwise, create a new layer with the base layer's image\n        baseLayerId = cornerstone.addLayer(element, baseImage, baseImageObject.options);\n        this.layerIds.push(baseLayerId);\n      }\n\n      // Display the image immediately while the overlay images are identified\n      cornerstone.displayImage(element, baseImage);\n\n      // Loop through the remaining 'overlay' image stacks\n      overlayImageStacks.forEach((imgObj, overlayLayerIndex) => {\n        const imageId = this.findImageFn(imgObj.imageIds, currentImageId);\n        const layerIndex = overlayLayerIndex + 1;\n        let currentLayerId = this.layerIds[layerIndex];\n\n        // If no layer exists yet for this overlaid stack, create\n        // One and add it to the layerIds property for this instance\n        // Of the fusion renderer.\n        if (!currentLayerId) {\n          currentLayerId = cornerstone.addLayer(element, undefined, imgObj.options);\n          this.layerIds.push(currentLayerId);\n        }\n\n        if (imageId) {\n          // If an imageId was returned from the findImage function,\n          // Load it, make sure it's visible and update the layer\n          // With the new image object.\n          cornerstone.loadAndCacheImage(imageId).then((image) => {\n            cornerstone.setLayerImage(element, image, currentLayerId);\n            cornerstone.updateImage(element);\n          });\n        } else {\n          // If no imageId was returned from the findImage function.\n          // This means that there is no relevant image to display.\n          cornerstone.setLayerImage(element, undefined, currentLayerId);\n          cornerstone.setActiveLayer(element, baseLayerId);\n          cornerstone.updateImage(element);\n        }\n      });\n    });\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./tools/stack/fusionRenderer.js","import scroll from '@/util/scroll.js';\nimport { keyboardTool } from '@/tools/base/index.js';\n\nconst keys = {\n  UP: 38,\n  DOWN: 40\n};\n\nfunction keyDownCallback (e) {\n  const eventData = e.detail;\n  const keyCode = eventData.keyCode;\n\n  if (keyCode !== keys.UP && keyCode !== keys.DOWN) {\n    return;\n  }\n\n  let images = 1;\n\n  if (keyCode === keys.DOWN) {\n    images = -1;\n  }\n\n  scroll(eventData.element, images);\n}\n\n// Module/private exports\nconst stackScrollKeyboard = keyboardTool(keyDownCallback);\n\nexport default stackScrollKeyboard;\n\n\n\n// WEBPACK FOOTER //\n// ./tools/stack/stackScrollKeyboard.js","import EVENTS from '@/events.js';\nimport { mouseWheelTool,\n  multiTouchDragTool,\n  simpleMouseButtonTool,\n  touchDragTool } from '@/tools/base/index.js';\nimport isMouseButtonEnabled from '@/util/isMouseButtonEnabled.js';\nimport scroll from '@/util/scroll.js';\nimport { getToolState } from '@/stateManagement/toolState.js';\nimport { setToolOptions, getToolOptions } from '@/toolOptions.js';\n\nconst toolType = 'stackScroll';\nconst toolTypeTouchDrag = 'stackScrollTouchDrag';\n\nfunction mouseUpCallback (e) {\n  const eventData = e.detail;\n  const element = eventData.element;\n\n  element.removeEventListener(EVENTS.MOUSE_DRAG, dragCallback);\n  element.removeEventListener(EVENTS.MOUSE_UP, mouseUpCallback);\n  element.removeEventListener(EVENTS.MOUSE_CLICK, mouseUpCallback);\n}\n\nfunction mouseDownCallback (e) {\n  const eventData = e.detail;\n  const element = eventData.element;\n  const options = getToolOptions(toolType, element);\n\n  if (isMouseButtonEnabled(eventData.which, options.mouseButtonMask)) {\n    options.deltaY = 0;\n\n    setToolOptions(toolType, element, options);\n\n    element.addEventListener(EVENTS.MOUSE_DRAG, dragCallback);\n    element.addEventListener(EVENTS.MOUSE_UP, mouseUpCallback);\n    element.addEventListener(EVENTS.MOUSE_CLICK, mouseUpCallback);\n    e.stopImmediatePropagation();\n\n    return false;\n  }\n}\n\nfunction mouseWheelCallback (e) {\n  const eventData = e.detail;\n  const images = -eventData.direction;\n\n  const config = stackScroll.getConfiguration();\n\n  let loop = false;\n  let allowSkipping = true;\n\n  if (config) {\n    loop = config.loop === undefined ? false : config.loop;\n    allowSkipping = config.allowSkipping === undefined ? true : config.allowSkipping;\n  }\n\n  scroll(eventData.element, images, loop, allowSkipping);\n}\n\nfunction dragCallback (e) {\n  const eventData = e.detail;\n  const element = eventData.element;\n\n  const toolData = getToolState(element, 'stack');\n\n  if (!toolData || !toolData.data || !toolData.data.length) {\n    return;\n  }\n\n  const stackData = toolData.data[0];\n\n  const config = stackScroll.getConfiguration();\n\n  let allowSkipping = true;\n\n  if (config && config.allowSkipping !== undefined) {\n    allowSkipping = config.allowSkipping;\n  }\n\n  // The Math.max here makes it easier to mouseDrag-scroll small or really large image stacks\n  let pixelsPerImage = Math.max(2, element.offsetHeight / Math.max(stackData.imageIds.length, 8));\n\n  if (config && config.stackScrollSpeed) {\n    pixelsPerImage = config.stackScrollSpeed;\n  }\n\n  const options = getToolOptions(toolType, element);\n  let deltaY = options.deltaY || 0;\n\n  deltaY += eventData.deltaPoints.page.y;\n\n  if (Math.abs(deltaY) >= pixelsPerImage) {\n    const imageIdIndexOffset = Math.round(deltaY / pixelsPerImage);\n\n    scroll(element, imageIdIndexOffset, false, allowSkipping);\n\n    options.deltaY = deltaY % pixelsPerImage;\n  } else {\n    options.deltaY = deltaY;\n  }\n\n  setToolOptions(toolType, element, options);\n\n  e.preventDefault();\n  e.stopPropagation();\n}\n\n// Module/private exports\nconst stackScroll = simpleMouseButtonTool(mouseDownCallback, toolType);\nconst stackScrollWheel = mouseWheelTool(mouseWheelCallback);\n\nconst options = {\n  eventData: {\n    deltaY: 0\n  }\n};\nconst stackScrollTouchDrag = touchDragTool(dragCallback, toolTypeTouchDrag, options);\n\nfunction multiTouchDragCallback (e) {\n  const eventData = e.detail;\n  const config = stackScrollMultiTouch.getConfiguration();\n\n  if (config && config.testPointers(eventData)) {\n    dragCallback(e);\n  }\n}\n\nconst configuration = {\n  testPointers (eventData) {\n    return (eventData.numPointers >= 3);\n  }\n};\n\nconst stackScrollMultiTouch = multiTouchDragTool(multiTouchDragCallback, options);\n\nstackScrollMultiTouch.setConfiguration(configuration);\n\nexport {\n  stackScroll,\n  stackScrollWheel,\n  stackScrollTouchDrag,\n  stackScrollMultiTouch\n};\n\n\n\n// WEBPACK FOOTER //\n// ./tools/stack/stackScroll.js","import external from '@/externalModules.js';\nimport { mouseButtonTool } from '@/tools/base/index.js';\nimport drawHandles from '@/manipulators/drawHandles.js';\nimport { getToolState } from '@/stateManagement/toolState.js';\nimport MeasurementManager from '@/measurementManager/measurementManager.js';\nimport LineSampleMeasurement from '@/measurementManager/lineSampleMeasurement.js';\nimport textStyle from '@/stateManagement/textStyle.js';\nimport drawTextBox from '@/util/drawTextBox.js';\n\nconst toolType = 'probe4D';\n\nfunction updateLineSample (measurementData) {\n  const cornerstone = external.cornerstone;\n  const samples = [];\n\n  measurementData.timeSeries.stacks.forEach(function (stack) {\n    let loader;\n\n    if (stack.preventCache === true) {\n      loader = cornerstone.loadImage(stack.imageIds[measurementData.imageIdIndex]);\n    } else {\n      loader = cornerstone.loadAndCacheImage(stack.imageIds[measurementData.imageIdIndex]);\n    }\n\n    loader.then(function (image) {\n      const offset = Math.round(measurementData.handles.end.x) + Math.round(measurementData.handles.end.y) * image.width;\n      const sample = image.getPixelData()[offset];\n\n      samples.push(sample);\n    });\n  });\n  measurementData.lineSample.set(samples);\n}\n\n// /////// BEGIN ACTIVE TOOL ///////\nfunction createNewMeasurement (mouseEventData) {\n  const timeSeriestoolData = getToolState(mouseEventData.element, 'timeSeries');\n\n  if (timeSeriestoolData === undefined || timeSeriestoolData.data === undefined || timeSeriestoolData.data.length === 0) {\n    return;\n  }\n\n  const timeSeries = timeSeriestoolData.data[0];\n\n  // Create the measurement data for this tool with the end handle activated\n  const measurementData = {\n    timeSeries,\n    lineSample: new LineSampleMeasurement(),\n    imageIdIndex: timeSeries.stacks[timeSeries.currentStackIndex].currentImageIdIndex,\n    visible: true,\n    handles: {\n      end: {\n        x: mouseEventData.currentPoints.image.x,\n        y: mouseEventData.currentPoints.image.y,\n        highlight: true,\n        active: true\n      }\n    }\n  };\n\n  updateLineSample(measurementData);\n  MeasurementManager.add(measurementData);\n\n  return measurementData;\n}\n// /////// END ACTIVE TOOL ///////\n\n// /////// BEGIN IMAGE RENDERING ///////\n\nfunction onImageRendered (e) {\n  const cornerstone = external.cornerstone;\n  const eventData = e.detail;\n  // If we have no toolData for this element, return immediately as there is nothing to do\n  const toolData = getToolState(e.currentTarget, toolType);\n\n  if (!toolData) {\n    return;\n  }\n\n  // We have tool data for this element - iterate over each one and draw it\n  const context = eventData.canvasContext;\n\n  context.setTransform(1, 0, 0, 1, 0, 0);\n\n  const color = 'white';\n  const font = textStyle.getFont();\n\n  for (let i = 0; i < toolData.data.length; i++) {\n    context.save();\n    const data = toolData.data[i];\n\n    // Draw the handles\n    context.beginPath();\n    drawHandles(context, eventData, data.handles, color);\n    context.stroke();\n\n    context.font = font;\n\n    const coords = {\n      // Translate the x/y away from the cursor\n      x: data.handles.end.x + 3,\n      y: data.handles.end.y - 3\n    };\n\n    const textCoords = cornerstone.pixelToCanvas(eventData.element, coords);\n\n    context.fillStyle = color;\n\n    drawTextBox(context, `${data.handles.end.x}, ${data.handles.end.y}`, textCoords.x, textCoords.y, color);\n\n    context.restore();\n  }\n}\n// /////// END IMAGE RENDERING ///////\n\n// Module exports\nconst probeTool4D = mouseButtonTool({\n  createNewMeasurement,\n  onImageRendered,\n  toolType\n});\n\nexport default probeTool4D;\n\n\n\n// WEBPACK FOOTER //\n// ./tools/timeSeries/probeTool4D.js","import EVENTS from '@/events.js';\nimport external from '@/externalModules.js';\nimport triggerEvent from '@/util/triggerEvent.js';\n\n// This object manages a collection of measurements\nfunction MeasurementManager () {\n  const cornerstone = external.cornerstone;\n  const that = this;\n\n  that.measurements = [];\n\n  // Adds an element as both a source and a target\n  this.add = function (measurement) {\n    const index = that.measurements.push(measurement);\n    // Fire event\n    const eventDetail = {\n      index,\n      measurement\n    };\n\n    triggerEvent(cornerstone.events, EVENTS.MEASUREMENT_ADDED, eventDetail);\n  };\n\n  this.remove = function (index) {\n    const measurement = that.measurements[index];\n\n    that.measurements.splice(index, 1);\n    // Fire event\n    const eventDetail = {\n      index,\n      measurement\n    };\n\n    triggerEvent(cornerstone.events, EVENTS.MEASUREMENT_REMOVED, eventDetail);\n  };\n\n}\n\n// Module/private exports\nconst manager = new MeasurementManager();\n\nexport default manager;\n\n\n\n// WEBPACK FOOTER //\n// ./measurementManager/measurementManager.js","import EVENTS from '@/events.js';\nimport external from '@/externalModules.js';\nimport triggerEvent from '@/util/triggerEvent.js';\n\n// This object manages a collection of measurements\nexport default function () {\n  const cornerstone = external.cornerstone;\n  const that = this;\n\n  that.samples = [];\n\n  this.set = function (samples) {\n    that.samples = samples;\n    // Fire event\n    triggerEvent(cornerstone.events, EVENTS.LINE_SAMPLE_UPDATED);\n  };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./measurementManager/lineSampleMeasurement.js","import { addToolState, getToolState } from '@/stateManagement/toolState.js';\nimport incrementTimePoint from './incrementTimePoint.js';\n\nconst toolType = 'timeSeriesPlayer';\n\n/**\n * Starts playing a clip of different time series of the same image or adjusts the frame rate of an\n * already playing clip. framesPerSecond is optional and defaults to 30 if not specified. A negative\n * framesPerSecond will play the clip in reverse.\n * The element must have time series\n * @param element\n * @param framesPerSecond\n */\nfunction playClip (element, framesPerSecond) {\n  if (element === undefined) {\n    throw new Error('playClip: element must not be undefined');\n  }\n\n  if (framesPerSecond === undefined) {\n    framesPerSecond = 30;\n  }\n\n  const timeSeriesToolData = getToolState(element, 'timeSeries');\n\n  if (timeSeriesToolData === undefined || timeSeriesToolData.data === undefined || timeSeriesToolData.data.length === 0) {\n    return;\n  }\n\n  const playClipToolData = getToolState(element, toolType);\n  let playClipData;\n\n  if (playClipToolData === undefined || playClipToolData.data.length === 0) {\n    playClipData = {\n      intervalId: undefined,\n      framesPerSecond,\n      lastFrameTimeStamp: undefined,\n      frameRate: 0\n    };\n    addToolState(element, toolType, playClipData);\n  } else {\n    playClipData = playClipToolData.data[0];\n    playClipData.framesPerSecond = framesPerSecond;\n  }\n\n  // If already playing, do not set a new interval\n  if (playClipData.intervalId !== undefined) {\n    return;\n  }\n\n  playClipData.intervalId = setInterval(function () {\n    if (playClipData.framesPerSecond > 0) {\n      incrementTimePoint(element, 1, true);\n    } else {\n      incrementTimePoint(element, -1, true);\n    }\n  }, 1000 / Math.abs(playClipData.framesPerSecond));\n}\n\n/**\n * Stops an already playing clip.\n * * @param element\n */\nfunction stopClip (element) {\n  const playClipToolData = getToolState(element, toolType);\n\n  if (!playClipToolData || !playClipToolData.data || !playClipToolData.data.length) {\n    return;\n  }\n  const playClipData = playClipToolData.data[0];\n\n\n  clearInterval(playClipData.intervalId);\n  playClipData.intervalId = undefined;\n}\n\n// Module/private exports\nconst timeSeriesPlayer = {\n  start: playClip,\n  stop: stopClip\n};\n\nexport default timeSeriesPlayer;\n\n\n\n// WEBPACK FOOTER //\n// ./tools/timeSeries/timeSeriesPlayer.js","import EVENTS from '@/events.js';\nimport { mouseWheelTool,\n  simpleMouseButtonTool,\n  touchDragTool } from '@/tools/base/index.js';\nimport incrementTimePoint from './incrementTimePoint.js';\nimport isMouseButtonEnabled from '@/util/isMouseButtonEnabled.js';\nimport { getToolState } from '@/stateManagement/toolState.js';\nimport { setToolOptions, getToolOptions } from '@/toolOptions.js';\n\nconst toolType = 'timeSeriesScroll';\n\nfunction mouseUpCallback (e) {\n  const eventData = e.detail;\n  const element = eventData.element;\n\n  element.removeEventListener(EVENTS.MOUSE_DRAG, mouseDragCallback);\n  element.removeEventListener(EVENTS.MOUSE_UP, mouseUpCallback);\n  element.removeEventListener(EVENTS.MOUSE_CLICK, mouseUpCallback);\n}\n\nfunction mouseDownCallback (e) {\n  const eventData = e.detail;\n  const element = eventData.element;\n  const options = getToolOptions(toolType, element);\n\n  if (isMouseButtonEnabled(eventData.which, options.mouseButtonMask)) {\n    options.deltaY = 0;\n\n    setToolOptions(toolType, element, options);\n\n    element.addEventListener(EVENTS.MOUSE_DRAG, mouseDragCallback);\n    element.addEventListener(EVENTS.MOUSE_UP, mouseUpCallback);\n    element.addEventListener(EVENTS.MOUSE_CLICK, mouseUpCallback);\n    e.stopImmediatePropagation();\n\n    return false;\n  }\n}\n\nfunction mouseDragCallback (e) {\n  const eventData = e.detail;\n  const element = eventData.element;\n\n  e.data.deltaY += eventData.deltaPoints.page.y;\n\n  const toolData = getToolState(eventData.element, 'timeSeries');\n\n  if (toolData === undefined || toolData.data === undefined || toolData.data.length === 0) {\n    return;\n  }\n\n  const timeSeriesData = toolData.data[0];\n\n  let pixelsPerTimeSeries = element.offsetHeight / timeSeriesData.stacks.length;\n\n  if (e.data.options !== undefined && e.data.options.timeSeriesScrollSpeed !== undefined) {\n    pixelsPerTimeSeries = e.data.options.timeSeriesScrollSpeed;\n  }\n\n  if (e.data.deltaY >= pixelsPerTimeSeries || e.data.deltaY <= -pixelsPerTimeSeries) {\n    const timeSeriesDelta = Math.round(e.data.deltaY / pixelsPerTimeSeries);\n    const timeSeriesDeltaMod = e.data.deltaY % pixelsPerTimeSeries;\n\n    incrementTimePoint(eventData.element, timeSeriesDelta);\n    e.data.deltaY = timeSeriesDeltaMod;\n  }\n\n  return false;\n}\n\nfunction mouseWheelCallback (e) {\n  const eventData = e.detail;\n  const images = -eventData.direction;\n\n  incrementTimePoint(eventData.element, images);\n}\n\nfunction dragCallback (e) {\n  const mouseMoveData = e.originalEvent.detail;\n  const eventData = {\n    deltaY: 0\n  };\n\n  eventData.deltaY += mouseMoveData.deltaPoints.page.y;\n\n  const toolData = getToolState(mouseMoveData.element, 'stack');\n\n  if (toolData === undefined || toolData.data === undefined || toolData.data.length === 0) {\n    return;\n  }\n\n  if (eventData.deltaY >= 3 || eventData.deltaY <= -3) {\n    const timeSeriesDelta = eventData.deltaY / 3;\n    const timeSeriesDeltaMod = eventData.deltaY % 3;\n\n    incrementTimePoint(eventData.element, timeSeriesDelta);\n    eventData.deltaY = timeSeriesDeltaMod;\n  }\n\n  return false;\n}\n\n// Module/private exports\nconst timeSeriesScroll = simpleMouseButtonTool(mouseDownCallback, toolType);\nconst timeSeriesScrollWheel = mouseWheelTool(mouseWheelCallback);\nconst timeSeriesScrollTouchDrag = touchDragTool(dragCallback);\n\nexport {\n  timeSeriesScroll,\n  timeSeriesScrollWheel,\n  timeSeriesScrollTouchDrag\n};\n\n\n\n// WEBPACK FOOTER //\n// ./tools/timeSeries/timeSeriesScroll.js","import external from '@/externalModules.js';\nimport { getToolState } from '@/stateManagement/toolState.js';\nimport brushTool from './brushTool.js';\nimport getCircle from './getCircle.js';\nimport { drawBrushPixels, drawBrushOnCanvas } from './drawBrush.js';\n\n// This module is for creating segmentation overlays\nconst TOOL_STATE_TOOL_TYPE = 'brush';\nconst toolType = 'adaptiveBrush';\nconst configuration = {\n  draw: 1,\n  radius: 3,\n  tolerance: 5,\n  minRadius: 1,\n  hoverColor: 'green',\n  dragColor: 'yellow'\n};\n\nlet lastImageCoords;\nlet thrMax;\nlet thrMin;\nlet currentRadius;\nlet dragging;\n\nfunction getGreyValues (pointerArray, pixelData, imageColumns) {\n  const configuration = adaptiveBrush.getConfiguration();\n  const tolerance = configuration.tolerance;\n  let minValue = Number.MAX_VALUE;\n  let maxValue = -Number.MAX_VALUE;\n\n  pointerArray.forEach((point) => {\n    const pixelIndex = point[1] * imageColumns + point[0];\n    const greyValue = pixelData[pixelIndex];\n\n    minValue = Math.min(greyValue, minValue);\n    maxValue = Math.max(greyValue, maxValue);\n  });\n\n  thrMin = minValue - tolerance;\n  thrMax = maxValue + tolerance;\n}\n\n// Draws the pointer with overlap calculation - Used on mouse clicked\nfunction paintAdaptiveBrush (imagePixelData, brushPixelData, rows, columns) {\n  const configuration = adaptiveBrush.getConfiguration();\n  const brushPixelValue = configuration.draw;\n  const mouseX = Math.round(lastImageCoords.x);\n  const mouseY = Math.round(lastImageCoords.y);\n  let numPixelsOutsideThresholdWindow = null;\n  let pointerArray = [];\n  let radius = configuration.radius;\n\n  /*\n   * Find pixels within the brush area. If within the brush area there are pixels outside the threshold min / max,\n   * decrease the brush radius until there are no sub/supra threshold pixels left (or until you reach the minimum radius).\n   */\n  while (numPixelsOutsideThresholdWindow !== 0 && radius > configuration.minRadius) {\n    numPixelsOutsideThresholdWindow = 0;\n    pointerArray = getCircle(radius, rows, columns, mouseX, mouseY);\n\n    // Loop through each of the relative pixel coordinates for the brush\n    for (let j = 0; j < pointerArray.length; j++) {\n      // Calculate the x / y image coordinates using the brush and the current mouse position\n      const xCoord = pointerArray[j][0];\n      const yCoord = pointerArray[j][1];\n\n      // Otherwise, retrieve the image pixel value in this location\n      const pixelIndex = yCoord * columns + xCoord;\n      const pixelValue = imagePixelData[pixelIndex];\n\n      /*\n        If the image pixel value is outside of the thresholds,\n        increase the numPixelsOutsideThresholdWindow counter\n      */\n      if (pixelValue > thrMax || pixelValue < thrMin) {\n        numPixelsOutsideThresholdWindow++;\n        break;\n      }\n    }\n\n    radius--;\n  }\n\n  if (numPixelsOutsideThresholdWindow === 0) {\n    drawBrushPixels(pointerArray, brushPixelData, brushPixelValue, columns);\n  }\n\n  return radius;\n}\n\nfunction paint (eventData) {\n  const configuration = adaptiveBrush.getConfiguration();\n  const element = eventData.element;\n  const layer = external.cornerstone.getLayer(element, configuration.brushLayerId);\n  const baseLayer = external.cornerstone.getLayers(element)[0];\n  const { rows, columns } = layer.image;\n  const toolData = getToolState(element, TOOL_STATE_TOOL_TYPE);\n  const brushData = toolData.data[0];\n\n  currentRadius = paintAdaptiveBrush(baseLayer.image.getPixelData(), brushData.pixelData, rows, columns);\n  layer.invalid = true;\n\n  external.cornerstone.updateImage(element);\n}\n\nfunction erase (eventData) {\n  const configuration = adaptiveBrush.getConfiguration();\n  const element = eventData.element;\n  const layer = external.cornerstone.getLayer(element, configuration.brushLayerId);\n  const { rows, columns } = layer.image;\n  const { x, y } = eventData.currentPoints.image;\n  const toolData = getToolState(element, TOOL_STATE_TOOL_TYPE);\n  const pixelData = toolData.data[0].pixelData;\n  const brushPixelValue = configuration.draw;\n  const radius = configuration.radius;\n\n  if (x < 0 || x > columns ||\n    y < 0 || y > rows) {\n    return;\n  }\n\n  const pointerArray = getCircle(radius, rows, columns, x, y);\n\n  drawBrushPixels(pointerArray, pixelData, brushPixelValue, columns);\n\n  layer.invalid = true;\n\n  external.cornerstone.updateImage(element);\n}\n\nfunction onMouseUp (e) {\n  const eventData = e.detail;\n\n  lastImageCoords = eventData.currentPoints.image;\n  const configuration = adaptiveBrush.getConfiguration();\n\n  dragging = false;\n  currentRadius = configuration.radius;\n  external.cornerstone.updateImage(eventData.element);\n}\n\nfunction onMouseDown (e) {\n  const eventData = e.detail;\n\n  const element = eventData.element;\n  const configuration = adaptiveBrush.getConfiguration();\n  const layer = external.cornerstone.getLayer(element, configuration.brushLayerId);\n  const baseLayer = external.cornerstone.getLayers(element)[0];\n  const { x, y } = eventData.currentPoints.image;\n  const { rows, columns } = layer.image;\n  const pointerArray = getCircle(configuration.radius, rows, columns, x, y);\n\n  if (configuration.draw === 0) {\n    erase(eventData);\n  } else {\n    getGreyValues(pointerArray, baseLayer.image.getPixelData(), columns);\n    paint(eventData);\n  }\n\n  dragging = true;\n  lastImageCoords = eventData.currentPoints.image;\n}\n\nfunction onMouseMove (e) {\n  const eventData = e.detail;\n\n  lastImageCoords = eventData.currentPoints.image;\n  external.cornerstone.updateImage(eventData.element);\n}\n\nfunction onDrag (e) {\n  const eventData = e.detail;\n\n  if (configuration.draw === 0) {\n    erase(eventData);\n  } else {\n    paint(eventData);\n  }\n\n  dragging = true;\n  lastImageCoords = eventData.currentPoints.image;\n}\n\nfunction onImageRendered (e) {\n  const eventData = e.detail;\n\n  if (!lastImageCoords) {\n    return;\n  }\n\n  const { rows, columns } = eventData.image;\n  const { x, y } = lastImageCoords;\n\n  if (x < 0 || x > columns ||\n    y < 0 || y > rows) {\n    return;\n  }\n\n  // Draw the hover overlay on top of the pixel data\n  const configuration = adaptiveBrush.getConfiguration();\n  const context = eventData.canvasContext;\n  const color = dragging ? configuration.dragColor : configuration.hoverColor;\n  const element = eventData.element;\n\n  currentRadius = currentRadius || configuration.radius;\n\n  context.setTransform(1, 0, 0, 1, 0, 0);\n\n  const pointerArray = getCircle(currentRadius, rows, columns, x, y);\n\n  drawBrushOnCanvas(pointerArray, context, color, element);\n}\n\nconst adaptiveBrush = brushTool({\n  onMouseMove,\n  onMouseDown,\n  onMouseUp,\n  onDrag,\n  toolType,\n  onImageRendered\n});\n\nadaptiveBrush.setConfiguration(configuration);\n\nexport { adaptiveBrush };\n\n\n\n// WEBPACK FOOTER //\n// ./tools/painting/adaptiveBrush.js","import external from '@/externalModules.js';\nimport { getToolState } from '@/stateManagement/toolState.js';\nimport brushTool from './brushTool.js';\nimport getCircle from './getCircle.js';\nimport { drawBrushPixels, drawBrushOnCanvas } from './drawBrush.js';\n\n// This module is for creating segmentation overlays\nconst TOOL_STATE_TOOL_TYPE = 'brush';\nconst toolType = 'brush';\nconst configuration = {\n  draw: 1,\n  radius: 3,\n  hoverColor: 'green',\n  dragColor: 'yellow'\n};\n\nlet lastImageCoords;\nlet dragging = false;\n\nfunction paint (eventData) {\n  const configuration = brush.getConfiguration();\n  const element = eventData.element;\n  const layer = external.cornerstone.getLayer(element, configuration.brushLayerId);\n  const { rows, columns } = layer.image;\n  const { x, y } = eventData.currentPoints.image;\n  const toolData = getToolState(element, TOOL_STATE_TOOL_TYPE);\n  const pixelData = toolData.data[0].pixelData;\n  const brushPixelValue = configuration.draw;\n  const radius = configuration.radius;\n\n  if (x < 0 || x > columns ||\n    y < 0 || y > rows) {\n    return;\n  }\n\n  const pointerArray = getCircle(radius, rows, columns, x, y);\n\n  drawBrushPixels(pointerArray, pixelData, brushPixelValue, columns);\n\n  layer.invalid = true;\n\n  external.cornerstone.updateImage(element);\n}\n\nfunction onMouseUp (e) {\n  const eventData = e.detail;\n\n  lastImageCoords = eventData.currentPoints.image;\n  dragging = false;\n}\n\nfunction onMouseDown (e) {\n  const eventData = e.detail;\n\n  paint(eventData);\n  dragging = true;\n  lastImageCoords = eventData.currentPoints.image;\n}\n\nfunction onMouseMove (e) {\n  const eventData = e.detail;\n\n  lastImageCoords = eventData.currentPoints.image;\n  external.cornerstone.updateImage(eventData.element);\n}\n\nfunction onDrag (e) {\n  const eventData = e.detail;\n\n  paint(eventData);\n  dragging = true;\n  lastImageCoords = eventData.currentPoints.image;\n}\n\nfunction onImageRendered (e) {\n  const eventData = e.detail;\n\n  if (!lastImageCoords) {\n    return;\n  }\n\n  const { rows, columns } = eventData.image;\n  const { x, y } = lastImageCoords;\n\n  if (x < 0 || x > columns ||\n    y < 0 || y > rows) {\n    return;\n  }\n\n  // Draw the hover overlay on top of the pixel data\n  const configuration = brush.getConfiguration();\n  const radius = configuration.radius;\n  const context = eventData.canvasContext;\n  const color = dragging ? configuration.dragColor : configuration.hoverColor;\n  const element = eventData.element;\n\n  context.setTransform(1, 0, 0, 1, 0, 0);\n  const pointerArray = getCircle(radius, rows, columns, x, y);\n\n  drawBrushOnCanvas(pointerArray, context, color, element);\n}\n\nconst brush = brushTool({\n  onMouseMove,\n  onMouseDown,\n  onMouseUp,\n  onDrag,\n  toolType,\n  onImageRendered\n});\n\nbrush.setConfiguration(configuration);\n\nexport { brush };\n\n\n\n// WEBPACK FOOTER //\n// ./tools/painting/brush.js"],"sourceRoot":""}